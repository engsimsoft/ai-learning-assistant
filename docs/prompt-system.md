# AI Agent Prompt System

> –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI Learning Agent (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –¥–æ–±–∞–≤–ª–µ–Ω—ã Boundaries –∏ Canvas Demo Rules)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

–í—Å–µ –ø—Ä–æ–º–ø—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `backend/prompts/` (SSOT ‚Äî —Å–º. –£—Ä–æ–∫ 1.7):

```
backend/prompts/
‚îú‚îÄ‚îÄ README.md              # –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã –ø—Ä–æ–º–ø—Ç–æ–≤
‚îú‚îÄ‚îÄ system_prompt.md       # –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è AI tutor (+ Canvas Demo Rules + {boundaries})
‚îú‚îÄ‚îÄ boundaries.md          # –ì—Ä–∞–Ω–∏—Ü—ã –∑–Ω–∞–Ω–∏–π (—á—Ç–æ –º–æ–∂–Ω–æ/–Ω–µ–ª—å–∑—è)
‚îî‚îÄ‚îÄ model_settings.md      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–¥–µ–ª–µ–π
```

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1) –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –∏ —Å–±–æ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

–ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ backend:
1. PromptLoader —Å—á–∏—Ç—ã–≤–∞–µ—Ç Markdown –∏–∑ `backend/prompts/`
2. –ö—ç—à–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
3. –ü—Ä–∏ —á–∞—Ç–µ:
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç `system_prompt.md`
   - –ü–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `{context}` (–≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏)
   - –ü–æ–¥–º–µ—à–∏–≤–∞–µ—Ç `boundaries.md` —á–µ—Ä–µ–∑ `{boundaries}` –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–∫—Ü–∏—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- –°–±–æ—Ä–∫–∞ –ø—Ä–æ–º–ø—Ç–∞: [PromptLoader.build_full_prompt()](backend/services/prompt_loader.py:43)
- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: [PromptLoader.load_system_prompt()](backend/services/prompt_loader.py:25)
- –ó–∞–≥—Ä—É–∑–∫–∞ –≥—Ä–∞–Ω–∏—Ü: [PromptLoader.load_boundaries()](backend/services/prompt_loader.py:34)
- –ü–µ—Ä–µ–¥–∞—á–∞ –≤ LLM: [OpenRouterService._build_system_prompt()](backend/services/openrouter_service.py:238) ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ [openrouter_service._send_request()](backend/services/openrouter_service.py:100)

### 2) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—Å–ª–µ–¥—É–µ—Ç –£—Ä–æ–∫—É 1.7)

```
User Question
    ‚Üì
OpenRouterService (—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç messages)
    ‚Üì
PromptLoader.build_full_prompt(context)
    ‚îú‚îÄ‚îÄ —á–∏—Ç–∞–µ—Ç backend/prompts/system_prompt.md
    ‚îú‚îÄ‚îÄ –∑–∞–º–µ–Ω—è–µ—Ç {context} ‚Üí –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —É—Ä–æ–∫–∏
    ‚îî‚îÄ‚îÄ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç {boundaries} (–∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–µ–∫—Ü–∏—é –∏–∑ boundaries.md)
    ‚Üì
OpenRouter API ‚Üí AI Response
```

## ‚úèÔ∏è –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ system_prompt.md

–ù–∞—Ä—è–¥—É —Å –±–ª–æ–∫–æ–º —Ä—É–∫–æ–≤–æ–¥—è—â–∏—Ö –ø—Ä–∞–≤–∏–ª –∏ `{context}`, –≤ –ø—Ä–æ–º–ø—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª **Canvas Demo Rules** ‚Äî —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç —Ü–µ–ª–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–ª –∫–æ—Ä–æ—Ç–∫–∏–µ, —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ HTML‚Äë–¥–µ–º–æ –¥–ª—è Canvas (iframe sandbox –≤ –ø—Ä–∞–≤–æ–π –ø–∞–Ω–µ–ª–∏ UI). –°–º. [system_prompt.md](../backend/prompts/system_prompt.md).

–ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã Canvas Demo Rules:
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–æ–≤–Ω–æ –û–î–ò–ù fenced-–±–ª–æ–∫ —Å —è–∑—ã–∫–æ–º `html`
- –°–Ω–∏–ø–ø–µ—Ç —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π: –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∏–º–ø–æ—Ä—Ç–æ–≤ –∏ —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä—ë–º, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –ö–æ–¥ –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ (–ø–æ—è—Å–Ω–µ–Ω–∏—è ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –±–ª–æ–∫–∞)

## üß© –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã) –≤ –ø—Ä–æ–º–ø—Ç–∞—Ö

- `{context}` ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç —É—Ä–æ–∫–æ–≤ –∏–∑ `backend/data/lessons/` —Å–æ–≥–ª–∞—Å–Ω–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Ä–µ–∂–∏–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Current Lesson, Module, All, Custom)
- `{boundaries}` ‚Äî –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `backend/prompts/boundaries.md` (–µ—Å–ª–∏ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ `system_prompt.md`, –≥—Ä–∞–Ω–∏—Ü—ã –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ–∫—Ü–∏–µ–π –≤ –∫–æ–Ω–µ—Ü —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞)

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ —Å–º. [PromptLoader.build_full_prompt()](backend/services/prompt_loader.py:43).

## üîê Boundaries (–≥—Ä–∞–Ω–∏—Ü—ã –∑–Ω–∞–Ω–∏–π)

–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã: [backend/prompts/boundaries.md](../backend/prompts/boundaries.md)
- –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—Ä–æ–∫–æ–≤ (SSOT, –±–µ–∑ –∂—ë—Å—Ç–∫–æ–≥–æ ¬´72 —É—Ä–æ–∫–∞¬ª)
- –®–∞–±–ª–æ–Ω –≤–µ–∂–ª–∏–≤–æ–≥–æ –æ—Ç–∫–∞–∑–∞ –¥–ª—è –æ—Ñ—Ñ—Ç–æ–ø–∞
- –°–ø–∏—Å–æ–∫ —Ç–µ–º–∞—Ç–∏–∫, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –∞–≥–µ–Ω—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

Boundaries –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –ª–∏–±–æ —á–µ—Ä–µ–∑ `{boundaries}`, –ª–∏–±–æ –∞–≤—Ç–æ-–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å–µ–∫—Ü–∏–∏.

## ‚öôÔ∏è –ú–æ–¥–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π: [backend/config.py](../backend/config.py)
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ–∫–µ–Ω—ã –∏ —Ü–µ–Ω—ã: `AVAILABLE_MODELS`
- –í—ã–±—Ä–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ OpenRouter —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏: [openrouter_service._send_request()](backend/services/openrouter_service.py:100)

–ü—Ä–∏–º–µ—Ä (—Ñ—Ä–∞–≥–º–µ–Ω—Ç):
```
AVAILABLE_MODELS = [
  {
    "id": "google/gemini-2.5-flash-preview-09-2025",
    "temperature": 0.7,
    "max_tokens": 4000,
    "top_p": 1.0
  },
  ...
]
```

## ‚úçÔ∏è –ö–∞–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç—ã

1) –û—Ç–∫—Ä–æ–π –Ω—É–∂–Ω—ã–π —Ñ–∞–π–ª:
```
nano backend/prompts/system_prompt.md
nano backend/prompts/boundaries.md
```
2) –ò–∑–º–µ–Ω–∏ Markdown, —Å–æ—Ö—Ä–∞–Ω–∏
3) Backend —Å `--reload` –ø—Ä–∏–º–µ–Ω–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

1) –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
```
uvicorn main:app --reload
# –õ–æ–≥–∏:
# Loading prompts from: .../backend/prompts
# PromptLoader initialized ...
# Prompts loaded successfully
```

2) –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä–∞–Ω–∏—Ü
- –í–æ–ø—Ä–æ—Å: ¬´–ö–∞–∫ –ª–µ—á–∏—Ç—å –ø—Ä–æ—Å—Ç—É–¥—É?¬ª
- –û–∂–∏–¥–∞–Ω–∏–µ: –≤–µ–∂–ª–∏–≤—ã–π –æ—Ç–∫–∞–∑ –ø–æ —à–∞–±–ª–æ–Ω—É –∏–∑ Boundaries, —Ä–µ–¥–∏—Ä–µ–∫—Ç –∫ —Ç–µ–º–∞–º –≤–µ–±‚Äë—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

3) –ü—Ä–æ–≤–µ—Ä–∫–∞ Canvas Demo Rules
- –í–æ–ø—Ä–æ—Å: ¬´–°–¥–µ–ª–∞–π –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –¥–µ–º–æ‚Äë–∫–Ω–æ–ø–∫—É, –ø—Ä–∏ –∫–ª–∏–∫–µ –≤—ã–≤–æ–¥–∏—Ç –≤—Ä–µ–º—è. –í–µ—Ä–Ω–∏ –æ–¥–∏–Ω self‚Äëcontained HTML –±–ª–æ–∫.¬ª
- –û–∂–∏–¥–∞–Ω–∏–µ: –æ–¥–∏–Ω fenced‚Äë–±–ª–æ–∫ ```html ‚Ä¶```; –∫–Ω–æ–ø–∫–∞ ¬´üß© Canvas¬ª –≤ UI –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–µ–º–æ –±–µ–∑ –¥–æ—Ä–∞–±–æ—Ç–æ–∫

4) –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–¥–µ–ª–∏
- –í—ã–±–æ—Ä –æ—Ç–ª–∏—á–Ω–æ–π –æ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –≤ UI ‚Üí –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤—è—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ `temperature`, `max_tokens`

## üß≠ –°–≤—è–∑—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π (SSOT)

- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤: `backend/prompts/` (–∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã)
- –ú–µ—Ö–∞–Ω–∏–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏/—Å–±–æ—Ä–∫–∏: [PromptLoader](../backend/services/prompt_loader.py)
- –í—ã–∑–æ–≤ –º–æ–¥–µ–ª–µ–π: [OpenRouterService](../backend/services/openrouter_service.py)
- –≠—Ç–æ—Ç —Ñ–∞–π–ª (`docs/prompt-system.md`) ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∏ —Å—Å—ã–ª–∫–∏, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–∫—Ç–æ–≤

## üìå –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–∏–∑ DOCUMENTATION_GUIDE)

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ–º–ø—Ç‚Äë—Å–∏—Å—Ç–µ–º–µ –Ω—É–∂–Ω–æ:
- –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (—ç—Ç–æ—Ç —Ñ–∞–π–ª) ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ [CHANGELOG.md](../CHANGELOG.md)
- –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–º–µ—Ç–∏—Ç—å –≤ [roadmap.md](../roadmap.md)

## üóÇÔ∏è –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫—Ä–∞—Ç–∫–æ)

- –î–æ–±–∞–≤–ª–µ–Ω—ã Canvas Demo Rules –≤ `system_prompt.md`
- –í–∫–ª—é—á–µ–Ω—ã Boundaries –≤ —Å–±–æ—Ä–∫—É —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ `{boundaries}` –∏–ª–∏ —Å–µ–∫—Ü–∏—é
- `boundaries.md` –ø—Ä–∏–≤–µ–¥—ë–Ω –∫ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–º —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º (–±–µ–∑ –∂—ë—Å—Ç–∫–æ–≥–æ —á–∏—Å–ª–∞ —É—Ä–æ–∫–æ–≤)

## üîó –°–º. —Ç–∞–∫–∂–µ

- [architecture.md](architecture.md) ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã
- [ai-web-learning-structure.md](ai-web-learning-structure.md) ‚Äî –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫—É—Ä—Å–∞ "AI Web Learning"
- [ARTIFACTS_SPEC.md](artifacts/ARTIFACTS_SPEC.md) ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Canvas/Artifacts
