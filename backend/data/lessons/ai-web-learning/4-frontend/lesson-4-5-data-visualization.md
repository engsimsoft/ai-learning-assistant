# Урок 4.5: Визуализация данных - Графики и Charts

> **Модуль 4:** Frontend разработка  
> **Урок:** 4.5  
> **Длительность:** 50-60 минут  
> **Prerequisite:** Урок 4.4 (Компоненты и State)

---

## 🎯 Цели урока

После этого урока ты сможешь:
- ✅ Понимать зачем нужна визуализация данных
- ✅ Знать популярные библиотеки для графиков в React
- ✅ Выбирать правильный тип графика для разных данных
- ✅ Понимать как интегрировать Chart.js в React
- ✅ Сформулировать задачу для Claude Code на создание графиков
- ✅ Применить визуализацию для профилей кулачков в EngineCamPro v2

---

## 📖 Концепция: Зачем нужна визуализация

### Простое определение

**Визуализация данных** - представление числовых данных в виде графиков, диаграмм и charts для лучшего понимания.

### Зачем это нужно

Без визуализации:
- ❌ Таблица из 1000 чисел - невозможно понять
- ❌ Тренды и закономерности незаметны
- ❌ Сравнение данных затруднено
- ❌ Принятие решений медленное

С визуализацией:
- ✅ Видишь картину целиком за секунды
- ✅ Тренды и аномалии очевидны
- ✅ Легко сравнивать данные
- ✅ Быстрые и обоснованные решения

### 📊 Аналогия: Карта vs Координаты

```
┌─────────────────────────────────────────────────┐
│     БЕЗ ВИЗУАЛИЗАЦИИ = СПИСОК КООРДИНАТ          │
├─────────────────────────────────────────────────┤
│                                                 │
│  Координаты городов:                            │
│  • Москва: 55.7558° N, 37.6173° E               │
│  • Санкт-Петербург: 59.9311° N, 30.3609° E      │
│  • Екатеринбург: 56.8389° N, 60.6057° E         │
│  • Новосибирск: 55.0084° N, 82.9357° E          │
│  • Владивосток: 43.1056° N, 131.8735° E         │
│                                                 │
│  ❌ Непонятно где города относительно друг друга │
│  ❌ Не видно расстояний                         │
│  ❌ Трудно планировать маршрут                  │
│                                                 │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│        С ВИЗУАЛИЗАЦИЕЙ = КАРТА                   │
├─────────────────────────────────────────────────┤
│                                                 │
│              🗺️ КАРТА РОССИИ                     │
│                                                 │
│   СПб •                                         │
│        Москва •                                 │
│              Екатеринбург •                     │
│                    Новосибирск •                │
│                                  Владивосток •  │
│                                                 │
│  ✅ Сразу видно расположение                    │
│  ✅ Понятны расстояния                          │
│  ✅ Легко планировать маршрут                   │
│                                                 │
└─────────────────────────────────────────────────┘

ТО ЖЕ С ДАННЫМИ КУЛАЧКА:

Таблица координат профиля:
angle: 0°, radius: 50mm
angle: 10°, radius: 51.2mm
angle: 20°, radius: 54.8mm
...
angle: 180°, radius: 60mm
❌ Непонятна форма профиля

График профиля:
       📈
     /    \
   /        \
 /            \
──────────────────
✅ Сразу видна форма кулачка!
```

---

## 📊 Типы графиков и когда их использовать

### 1. Line Chart (Линейный график)

```
    ▲
 60 │         ╱─╲
    │       ╱     ╲
 55 │     ╱         ╲
    │   ╱             ╲
 50 │─╱─────────────────╲─►
    0°   90°   180°  270° 360°
```

**Когда использовать:**
- ✅ Изменение во времени (температура, скорость)
- ✅ Непрерывные данные (профиль кулачка)
- ✅ Тренды и закономерности

**Для EngineCamPro:**
- Профиль кулачка (radius vs angle)
- Скорость толкателя (velocity vs angle)
- Ускорение (acceleration vs angle)

### 2. Bar Chart (Столбчатая диаграмма)

```
    ▲
    │   ██
 40 │   ██    ██
    │   ██    ██    ██
 20 │   ██    ██    ██
    │   ██    ██    ██    ██
  0 └───┴─────┴─────┴─────┴──►
      Q1    Q2    Q3    Q4
```

**Когда использовать:**
- ✅ Сравнение категорий (продажи по регионам)
- ✅ Дискретные значения
- ✅ Рейтинги и rankings

**Для EngineCamPro:**
- Сравнение характеристик разных кулачков
- Количество кулачков по проектам

### 3. Pie Chart (Круговая диаграмма)

```
        ╱───╲
       │ 40% │
      ╱───────╲
     │   30%   │
     │─────────│
      ╲  30% ╱
       ╲───╱
```

**Когда использовать:**
- ✅ Доли от целого (процентное соотношение)
- ✅ Небольшое количество категорий (2-6)
- ⚠️ НЕ для точных сравнений (трудно различить)

**Для EngineCamPro:**
- Распределение типов кулачков в проекте
- Статистика использования функций

### 4. Scatter Plot (Точечная диаграмма)

```
    ▲
    │     •    •
 60 │   •    •
    │ •   •      •
 40 │   •   •  •
    │ •  •   •
 20 │•  •
    └────────────────►
```

**Когда использовать:**
- ✅ Корреляция между двумя переменными
- ✅ Распределение данных
- ✅ Поиск аномалий

**Для EngineCamPro:**
- Зависимость max_velocity от lift
- Анализ параметров успешных кулачков

---

## 🛠️ Библиотеки для React

### Сравнение популярных библиотек

| Библиотека | Простота | Возможности | Производительность | Для EngineCamPro |
|------------|----------|-------------|-------------------|------------------|
| **Chart.js** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ✅ Рекомендуется |
| **Recharts** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ✅ Хорошо |
| **Victory** | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⚠️ Избыточно |
| **D3.js** | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⚠️ Сложно |
| **Plotly** | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ✅ Для науки |

### Chart.js (Рекомендуется для начала)

**Почему Chart.js:**
- ✅ Очень простой в использовании
- ✅ Красивые графики из коробки
- ✅ Все основные типы графиков
- ✅ Легкая интеграция с React
- ✅ Хорошая производительность
- ✅ ИИ отлично знает Chart.js

**Для EngineCamPro идеален:**
- Линейные графики для профилей
- Интерактивность (zoom, hover)
- Адаптивный дизайн
- Экспорт в изображение

---

## 💡 Контекст применения

### Для EngineCamPro v2

**Графики которые нам нужны:**

#### 1. Профиль кулачка (Line Chart)
```
Данные от backend:
{
  profile: [
    {angle: 0, radius: 50},
    {angle: 10, radius: 51.2},
    {angle: 20, radius: 54.8},
    ...
  ]
}

График:
X-ось: angle (градусы)
Y-ось: radius (мм)
Тип: Line chart
Опции: smooth curve, точки на линии
```

#### 2. Скорость толкателя (Line Chart)
```
Данные от backend:
{
  velocity: [
    {angle: 0, value: 0},
    {angle: 90, value: 23.5},
    ...
  ]
}

График:
X-ось: angle (градусы)
Y-ось: velocity (м/с)
Тип: Line chart
Цвет: синий (отличается от профиля)
```

#### 3. Ускорение (Line Chart)
```
Данные от backend:
{
  acceleration: [
    {angle: 0, value: 0},
    {angle: 45, value: 15.2},
    ...
  ]
}

График:
X-ось: angle (градусы)
Y-ось: acceleration (м/с²)
Тип: Line chart
Цвет: красный (важные зоны)
```

#### 4. Сравнение кулачков (Multi-line)
```
Несколько профилей на одном графике:
- Кулачок A (красная линия)
- Кулачок B (синяя линия)
- Кулачок C (зелёная линия)

Для сравнения характеристик
```

---

## 🌐 Интеграция Chart.js в React

### Концепция работы

```
┌─────────────────────────────────────────────────┐
│         CHART.JS + REACT ИНТЕГРАЦИЯ              │
├─────────────────────────────────────────────────┤
│                                                 │
│  1️⃣ Backend отправляет данные (JSON):           │
│     {profile: [{angle: 0, radius: 50}, ...]}    │
│                                                 │
│              ↓                                  │
│                                                 │
│  2️⃣ React получает через Fetch API:             │
│     const [profileData, setProfileData] = ...   │
│                                                 │
│              ↓                                  │
│                                                 │
│  3️⃣ Преобразование в формат Chart.js:           │
│     const chartData = {                         │
│       labels: data.map(p => p.angle),           │
│       datasets: [{                              │
│         data: data.map(p => p.radius),          │
│         borderColor: 'blue'                     │
│       }]                                        │
│     }                                           │
│                                                 │
│              ↓                                  │
│                                                 │
│  4️⃣ React компонент с Chart.js:                 │
│     <Line data={chartData} options={...} />     │
│                                                 │
│              ↓                                  │
│                                                 │
│  5️⃣ Chart.js рисует график в canvas             │
│                                                 │
└─────────────────────────────────────────────────┘
```

### Структура компонентов

```
<CamCalculator />
  ├── <ParameterForm />
  └── <ResultsDisplay />
      ├── <ProfileChart data={profile} />
      ├── <VelocityChart data={velocity} />
      └── <AccelerationChart data={acceleration} />

Каждый Chart компонент:
- Получает данные через props
- Преобразует в формат Chart.js
- Рендерит график
- Обрабатывает интерактивность
```

---

## 🤖 Работа с Claude Code

### Сценарий: Создание компонента графика профиля

#### ✅ Эффективный диалог

```
Ты: Создай React компонент для отображения профиля кулачка 
используя Chart.js.

Требования к проекту:
- Установи: npm install chart.js react-chartjs-2
- Компонент: src/components/ProfileChart.jsx

Props:
interface ProfileChartProps {
  data: Array<{angle: number, radius: number}>
  title?: string
  color?: string
}

Функциональность:
1. Преобразование данных в формат Chart.js:
   - labels: массив углов (angle)
   - datasets: массив радиусов (radius)

2. Конфигурация графика:
   - Тип: Line chart
   - Smooth curve (tension: 0.4)
   - Точки на линии (pointRadius: 3)
   - Fill под линией (fill: true, backgroundColor: rgba)

3. Опции:
   - Responsive: true
   - Заголовок: title из props
   - X-ось: "Angle (degrees)"
   - Y-ось: "Radius (mm)"
   - Легенда: скрыть (только один dataset)
   - Tooltip: показать angle и radius при hover
   - Zoom: enable с колёсиком мыши

4. Интерактивность:
   - Hover показывает точные значения
   - Click на точку - копирует координаты
   - Zoom plugin для приближения

5. Адаптивность:
   - Ширина 100% контейнера
   - Высота: 400px на desktop, 300px на mobile
   - Сохранять aspect ratio

6. Loading state:
   - Показать skeleton пока нет данных
   - Placeholder если data пустой

7. Error handling:
   - Проверка что data массив
   - Проверка что есть angle и radius
   - Показать error message если данные невалидны

Стили:
- Контейнер с padding
- Тень вокруг графика
- Адаптивный margin

Claude Code: [анализирует требования]

Создам компонент ProfileChart со следующей структурой:

```
src/components/ProfileChart.jsx
- Import Chart.js и react-chartjs-2
- Props validation
- Data transformation функция
- Chart configuration
- Responsive container
- Loading/Error states
```

Особенности:
- react-chartjs-2 обёртка для Chart.js
- useMemo для оптимизации data transformation
- Custom plugins для zoom
- Responsive design с breakpoints
- PropTypes для validation

Применить? [Y/n]

Ты: Y

Claude Code: [создаёт компонент с полной конфигурацией]

Создан ProfileChart.jsx. Особенности:
- Красивый Line chart с smooth curve
- Полная интерактивность (hover, zoom)
- Адаптивный дизайн
- Loading и error states
- TypeScript-like PropTypes

Хочешь протестировать с mock данными?

Ты: Да, создай тестовую страницу

Claude Code: [создаёт TestProfileChart.jsx с mock данными]

Создана тестовая страница. Содержит:
- Mock данные профиля кулачка
- Кнопки для изменения параметров
- Демо разных цветов
- Live обновление графика

Запустить dev server? [Y/n]

Ты: Y

Claude Code: [npm run dev]

Ты: Отлично! Теперь добавь кнопку экспорта графика в PNG

Claude Code: [добавляет export функцию]
Добавил:
- Кнопку "Export as PNG"
- Функцию chart.toBase64Image()
- Download через browser API
- Именование файла по timestamp
```

**Почему это эффективно:**
- ✅ Конкретная библиотека указана (Chart.js)
- ✅ Props чётко описаны
- ✅ Конфигурация графика детальна
- ✅ Интерактивность упомянута
- ✅ Адаптивность и responsive
- ✅ Loading и error states
- ✅ Возможность тестирования

---

## 🛠️ Практическое задание

### Задача

Создай React компонент для отображения трёх графиков: профиль, скорость, ускорение.

### Работа с Claude Code

**Шаг 1:** Создай проект
```bash
cd ~/projects
mkdir cam-visualization
cd cam-visualization
claude
```

**Шаг 2:** Диалог с Claude Code

```
Ты: Создай React приложение для визуализации данных кулачка 
с тремя графиками.

Требования:

Проект:
- Vite + React + JavaScript
- Установить: chart.js react-chartjs-2

Структура:
<App />
  ├── <MockDataGenerator /> - генерит тестовые данные
  └── <ChartsDisplay />
      ├── <ProfileChart data={profile} />
      ├── <VelocityChart data={velocity} />
      └── <AccelerationChart data={acceleration} />

Mock данные:
Создай функцию generateMockData() которая генерирует:
- profile: синусоида для radius
- velocity: производная профиля
- acceleration: вторая производная

ProfileChart:
- Line chart (синяя линия)
- X: angle (0-360°)
- Y: radius (мм)
- Title: "Cam Profile"

VelocityChart:
- Line chart (зелёная линия)
- X: angle
- Y: velocity (м/с)
- Title: "Follower Velocity"

AccelerationChart:
- Line chart (красная линия)
- X: angle
- Y: acceleration (м/с²)
- Title: "Follower Acceleration"
- Highlight зоны высокого ускорения (> порога)

Все графики:
- Responsive
- Hover показывает значения
- Zoom enabled
- Одинаковый стиль

Layout:
- Grid 1 колонка на mobile
- Grid 3 колонки на desktop
- Padding между графиками

Controls:
- Slider для изменения amplitude
- Slider для изменения frequency
- Кнопка "Regenerate Data"
- Графики обновляются в реальном времени

Claude Code: [создаёт приложение с тремя графиками]
```

**Шаг 3:** Тестирование

- [ ] Все три графика отображаются
- [ ] Slider'ы изменяют графики
- [ ] Hover работает на всех графиках
- [ ] Zoom работает
- [ ] Адаптивный layout (проверь на mobile)

**Шаг 4:** Эксперименты

```
Ты: Добавь кнопку "Compare" для сравнения двух профилей 
на одном графике

Ту: Добавь анимацию при загрузке графиков

Ты: Добавь возможность переключения между Line и Bar chart
```

### Ожидаемый результат

- ✅ Три графика работают
- ✅ Понимаешь интеграцию Chart.js в React
- ✅ Знаешь как передавать данные в графики
- ✅ Видишь разные типы визуализации
- ✅ Готов применить для EngineCamPro

---

## ❓ Вопросы для самопроверки

1. **Зачем нужна визуализация данных?**
   - Приведи пример когда график лучше таблицы

2. **Какой тип графика выбрать?**
   - Для профиля кулачка?
   - Для сравнения кулачков?
   - Для распределения типов?

3. **Почему Chart.js, а не D3.js?**
   - Когда Chart.js достаточно?
   - Когда нужен D3.js?

4. **Как интегрировать график в React?**
   - Откуда берутся данные?
   - Через какой prop передавать?
   - Как обновлять график?

5. **Для EngineCamPro v2:**
   - Какие графики нам нужны?
   - Какие данные будут от backend?
   - Как организовать компоненты графиков?

6. **Интерактивность:**
   - Зачем нужен hover?
   - Зачем нужен zoom?
   - Что ещё можно добавить?

---

## 🔗 Связь с другими уроками

**Основано на уроках:**
- Урок 4.2: Fetch API - данные для графиков с backend
- Урок 4.4: State - данные графиков в State

**Подготавливает к урокам:**
- Урок 5.1: Frontend-Backend интеграция - графики + API
- Модуль 5: Полная интеграция с реальными данными

**Связь с EngineCamPro:**
В следующих модулях создадим:
- Графики профиля из расчётов backend
- Интерактивные charts с реальными данными
- Сравнение нескольких кулачков
- Экспорт графиков в отчёты

---

## ✅ Критерии завершения урока

**Понимание концепций:**
- [ ] Понимаю зачем нужна визуализация
- [ ] Знаю типы графиков и когда их использовать
- [ ] Понимаю интеграцию Chart.js в React
- [ ] Знаю как передавать данные в графики

**Практические навыки:**
- [ ] Могу описать требования к графику для Claude Code
- [ ] Понимаю структуру компонента с Chart.js
- [ ] Знаю как делать графики интерактивными
- [ ] Понимаю responsive design для charts

**Готовность к следующему уроку:**
- [ ] Создано приложение с графиками
- [ ] Все графики работают корректно
- [ ] Понимаю как применить для EngineCamPro
- [ ] Готов изучать UI библиотеки

---

**Статус урока:** ⏳ Не начат / 🔄 В процессе / ✅ Завершён  
**Дата начала:** _________  
**Дата завершения:** _________

---

## 📚 Дополнительные материалы (опционально)

Если хочешь узнать больше:
- [Chart.js Documentation](https://www.chartjs.org/) - официальная документация
- [react-chartjs-2](https://react-chartjs-2.js.org/) - React обёртка
- [Data Visualization Guide](https://www.data-to-viz.com/) - выбор типа графика

**НО!** Главное - понять концепции из этого урока. Claude Code создаст графики за тебя!