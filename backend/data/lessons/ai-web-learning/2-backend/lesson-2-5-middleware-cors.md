# ะฃัะพะบ 2.5: Middleware ะธ CORS

> **ะะพะดัะปั 2:** Backend ัะฐะทัะฐะฑะพัะบะฐ  
> **ะฃัะพะบ:** 2.5  
> **ะะปะธัะตะปัะฝะพััั:** 40-55 ะผะธะฝัั  
> **Prerequisite:** ะฃัะพะบ 2.4 (ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ)

---

## ๐ฏ ะฆะตะปะธ ััะพะบะฐ

ะะพัะปะต ััะพะณะพ ััะพะบะฐ ัั ัะผะพะถะตัั:
- โ ะะพะฝะธะผะฐัั ััะพ ัะฐะบะพะต middleware ะธ ะทะฐัะตะผ ะพะฝ ะฝัะถะตะฝ
- โ ะะฝะฐัั ะฟัะพะฑะปะตะผั Same-Origin Policy
- โ ะะพะฝะธะผะฐัั ะทะฐัะตะผ ะฝัะถะตะฝ CORS
- โ ะะฐัััะฐะธะฒะฐัั CORS ะฒ FastAPI ัะตัะตะท Claude Code
- โ ะะพะฝะธะผะฐัั security implications CORS

---

## ๐ ะะพะฝัะตะฟัะธั: Middleware

### ะัะพััะพะต ะพะฟัะตะดะตะปะตะฝะธะต

**Middleware** (ะฟัะพะผะตะถััะพัะฝะพะต ะะ) - ััะพ ััะฝะบัะธั ะบะพัะพัะฐั ะฒัะฟะพะปะฝัะตััั ะะะะะ ะธะปะธ ะะะกะะ ะบะฐะถะดะพะณะพ ะทะฐะฟัะพัะฐ. ะญัะพ ะบะฐะบ checkpoint - ะฒัะต ะทะฐะฟัะพัั ะฟัะพัะพะดัั ัะตัะตะท ะฝะตะณะพ.

### ะะฐัะตะผ ััะพ ะฝัะถะฝะพ

ะะตะท middleware ัะตะฑะต ะฟัะธัะปะพัั ะฑั ะดะพะฑะฐะฒะปััั ะพะดะธะฝะฐะบะพะฒัะน ะบะพะด ะฒ ะบะฐะถะดัะน endpoint:
```python
@app.get("/cams")
def get_cams():
    log_request()           # โ ะดัะฑะปะธััะตััั
    check_authentication()  # โ ะดัะฑะปะธััะตััั
    add_cors_headers()      # โ ะดัะฑะปะธััะตััั
    # ะขะฒะพั ะปะพะณะธะบะฐ
    return cams

@app.post("/cams")
def create_cam():
    log_request()           # โ ะดัะฑะปะธััะตััั ัะฝะพะฒะฐ!
    check_authentication()  # โ ะดัะฑะปะธััะตััั ัะฝะพะฒะฐ!
    add_cors_headers()      # โ ะดัะฑะปะธััะตััั ัะฝะพะฒะฐ!
    # ะขะฒะพั ะปะพะณะธะบะฐ
```

**ะัะพะฑะปะตะผะฐ:** ะัะฑะปะธัะพะฒะฐะฝะธะต ะบะพะดะฐ ะฒะตะทะดะต! ๐ฑ

**ะะตัะตะฝะธะต:** Middleware - ะฟะธัะตัั ะพะดะธะฝ ัะฐะท, ัะฐะฑะพัะฐะตั ะดะปั ะฒัะตั:
```python
# Middleware ะพะดะธะฝ ัะฐะท
@app.middleware("http")
async def log_requests(request, call_next):
    log_request()
    response = await call_next(request)
    return response

# Endpoints ัะธัััะต!
@app.get("/cams")
def get_cams():
    return cams  # ะะพะณะธัะพะฒะฐะฝะธะต ะฐะฒัะพะผะฐัะธัะตัะบะธ!
```

### ๐ ะะฝะฐะปะพะณะธั: ะััะฐะฝะฝะธะบ ะฝะฐ ะฒัะพะดะต

```
ะะะ MIDDLEWARE (ะฟัะพะฒะตัะบะฐ ะฒ ะบะฐะถะดะพะน ะบะพะผะฝะฐัะต)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ช ะะพะผะฝะฐัะฐ A
   ๐ฎ ะััะฐะฝะฝะธะบ ะฟัะพะฒะตััะตั ะฟัะพะฟััะบ
   โ ะัะพะดะธัั
   
๐ช ะะพะผะฝะฐัะฐ B
   ๐ฎ ะััะฐะฝะฝะธะบ ะฟัะพะฒะตััะตั ะฟัะพะฟััะบ ะกะะะะ
   โ ะัะพะดะธัั
   
๐ช ะะพะผะฝะฐัะฐ C
   ๐ฎ ะััะฐะฝะฝะธะบ ะฟัะพะฒะตััะตั ะฟัะพะฟััะบ ะกะะะะ
   โ ะัะพะดะธัั
   
ะะตัััะตะบัะธะฒะฝะพ! ะ ะบะฐะถะดะพะน ะบะพะผะฝะฐัะต ะพััะฐะฝะฝะธะบ!


ะก MIDDLEWARE (ะพะดะธะฝ ะพััะฐะฝะฝะธะบ ะฝะฐ ะฒัะพะดะต)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ช ะะฅะะ ะ ะะะะะะ
   ๐ฎ ะััะฐะฝะฝะธะบ ะฟัะพะฒะตััะตั ะะะะ ะะะ
   โ ะะฐะป ะฟัะพะฟััะบ
   
๐ช ะะพะผะฝะฐัะฐ A - ะทะฐัะพะดะธัั ัะฒะพะฑะพะดะฝะพ
๐ช ะะพะผะฝะฐัะฐ B - ะทะฐัะพะดะธัั ัะฒะพะฑะพะดะฝะพ  
๐ช ะะพะผะฝะฐัะฐ C - ะทะฐัะพะดะธัั ัะฒะพะฑะพะดะฝะพ

ะญััะตะบัะธะฒะฝะพ! ะัะพะฒะตัะบะฐ ะฝะฐ ะฒัะพะดะต!
```

**Middleware = ะพััะฐะฝะฝะธะบ ะฝะฐ ะฒัะพะดะต:**
- ะัะพะฒะตััะตั ะะกะ ะทะฐะฟัะพัั
- ะะพะฑะฐะฒะปัะตั ะพะฑััั ะปะพะณะธะบั
- ะัะพะฟััะบะฐะตั ะดะฐะปััะต ะธะปะธ ะฑะปะพะบะธััะตั

### ะะฐะบ ัะฐะฑะพัะฐะตั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              MIDDLEWARE ะ FASTAPI                        โ
โ                                                          โ
โ  HTTP Request                                            โ
โ      โ                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ  โ   MIDDLEWARE STACK                โ                   โ
โ  โ                                   โ                   โ
โ  โ  1. Logging Middleware            โ                   โ
โ  โ     โข ะะพะณะธััะตั ะทะฐะฟัะพั             โ                   โ
โ  โ     โ                             โ                   โ
โ  โ  2. CORS Middleware               โ                   โ
โ  โ     โข ะะพะฑะฐะฒะปัะตั CORS headers      โ                   โ
โ  โ     โ                             โ                   โ
โ  โ  3. Authentication Middleware     โ                   โ
โ  โ     โข ะัะพะฒะตััะตั ัะพะบะตะฝ             โ                   โ
โ  โ     โ                             โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ      โ                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ  โ   ะขะะะ ENDPOINT                   โ                   โ
โ  โ   def get_cams():                 โ                   โ
โ  โ       return cams                 โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ      โ                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ  โ   MIDDLEWARE (ะพะฑัะฐัะฝัะน ะฟััั)      โ                   โ
โ  โ   โข ะะพะฑะฐะฒะปัะตั headers             โ                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                   โ
โ      โ                                                   โ
โ  HTTP Response                                           โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ะะฐะฟัะพั ะฟัะพัะพะดะธั ัะตัะตะท ะะกะ middleware
ะัะฒะตั ัะพะถะต ะฟัะพัะพะดะธั ะพะฑัะฐัะฝะพ
```

---

## ๐ ะะพะฝัะตะฟัะธั: CORS

### ะัะพััะพะต ะพะฟัะตะดะตะปะตะฝะธะต

**CORS** (Cross-Origin Resource Sharing) - ััะพ ะผะตัะฐะฝะธะทะผ ะบะพัะพััะน ัะฐะทัะตัะฐะตั ะธะปะธ ะฑะปะพะบะธััะตั ะทะฐะฟัะพัั ะผะตะถะดั ัะฐะทะฝัะผะธ ะดะพะผะตะฝะฐะผะธ. ะะพ ัะผะพะปัะฐะฝะธั ะฑัะฐัะทะตัั ะฑะปะพะบะธัััั ัะฐะบะธะต ะทะฐะฟัะพัั ะดะปั ะฑะตะทะพะฟะฐัะฝะพััะธ.

### ะัะพะฑะปะตะผะฐ: Same-Origin Policy

ะัะฐัะทะตัั ะธะผะตัั ะฟัะฐะฒะธะปะพ ะฑะตะทะพะฟะฐัะฝะพััะธ: **Same-Origin Policy**

```
๐ ORIGIN = ะฟัะพัะพะบะพะป + ะดะพะผะตะฝ + ะฟะพัั

http://localhost:3000     โ Origin 1 (Frontend React)
http://localhost:8000     โ Origin 2 (Backend FastAPI)
                             โ
                        ะะะะะซะ origins!
```

**ะะตะท CORS:**
```javascript
// Frontend ะฝะฐ http://localhost:3000
fetch('http://localhost:8000/api/cams')

โ ะะจะะะะ ะ ะะะะกะะะ:
Access to fetch at 'http://localhost:8000/api/cams' 
from origin 'http://localhost:3000' has been blocked 
by CORS policy: No 'Access-Control-Allow-Origin' header 
is present on the requested resource.
```

**ะัะฐัะทะตั ะฑะปะพะบะธััะตั ะทะฐะฟัะพั!** ๐ซ

### ะะฐัะตะผ ััะพ ะฝัะถะฝะพ

**ะัะพะฑะปะตะผะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ ะฑะตะท CORS:**
```
1. ะขั ะทะฐัะพะดะธัั ะฝะฐ bank.com (ะปะพะณะธะฝะธัััั)
2. ะัะบััะฒะฐะตัั ะฝะพะฒัั ะฒะบะปะฐะดะบั: evil.com
3. evil.com ะดะตะปะฐะตั ะทะฐะฟัะพั ะบ bank.com/transfer-money
4. ะะตะท CORS ะฑัะฐัะทะตั ะพัะฟัะฐะฒะธั ัะฒะพะธ cookies!
5. ๐ฐ ะะตะฝัะณะธ ัะบัะฐะดะตะฝั!
```

**Same-Origin Policy ะทะฐัะธัะฐะตั ะพั ััะพะณะพ!**

### ะะตัะตะฝะธะต: CORS headers

Backend ะดะพะฑะฐะฒะปัะตั ัะฟะตัะธะฐะปัะฝัะต headers:
```
Access-Control-Allow-Origin: http://localhost:3000
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type
```

**ะขะตะฟะตัั ะฑัะฐัะทะตั:**
```javascript
// Frontend ะฝะฐ http://localhost:3000
fetch('http://localhost:8000/api/cams')

โ ะฃะกะะะฅ! Backend ัะฐะทัะตัะธะป ะทะฐะฟัะพัั ั localhost:3000
```

---

## ๐ก CORS ะฒ FastAPI

### ะะฐัััะพะนะบะฐ CORS Middleware

```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# CORS Middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",    # React Dev Server
        "http://localhost:3001",    # ะะพะฟะพะปะฝะธัะตะปัะฝัะน ะฟะพัั
    ],
    allow_credentials=True,         # ะะฐะทัะตัะธัั cookies
    allow_methods=["*"],            # ะัะต HTTP ะผะตัะพะดั
    allow_headers=["*"],            # ะัะต headers
)
```

### ะะฐัะฐะผะตััั CORS

#### `allow_origins`
**ะะฐะบะธะต ะดะพะผะตะฝั ะผะพะณัั ะดะตะปะฐัั ะทะฐะฟัะพัั**

```python
# โ ะะะะกะะ - ัะฐะทัะตัะฐะตั ะะกะ ะดะพะผะตะฝั
allow_origins=["*"]

# โ ะะะะะะะกะะ - ัะพะปัะบะพ ัะฒะพะน Frontend
allow_origins=[
    "http://localhost:3000",           # Development
    "https://enginecampro.com",        # Production
]
```

#### `allow_methods`
**ะะฐะบะธะต HTTP ะผะตัะพะดั ัะฐะทัะตัะตะฝั**

```python
allow_methods=["*"]              # ะัะต ะผะตัะพะดั
allow_methods=["GET", "POST"]    # ะขะพะปัะบะพ GET ะธ POST
```

#### `allow_headers`
**ะะฐะบะธะต headers ะผะพะถะตั ะพัะฟัะฐะฒะปััั Frontend**

```python
allow_headers=["*"]              # ะัะต headers
allow_headers=["Content-Type"]   # ะขะพะปัะบะพ Content-Type
```

#### `allow_credentials`
**ะะฐะทัะตัะธัั ะพัะฟัะฐะฒะบั cookies ะธ ะฐะฒัะพัะธะทะฐัะธะพะฝะฝัั headers**

```python
allow_credentials=True   # ะก cookies (ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ)
allow_credentials=False  # ะะตะท cookies
```

---

## ๐ฏ CORS ะดะปั EngineCamPro v2

### Development ะฝะฐัััะพะนะบะธ

```python
# app/main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="EngineCamPro API", version="2.0")

# CORS ะดะปั Development
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",      # React Dev Server
        "http://localhost:3001",      # ะะปััะตัะฝะฐัะธะฒะฝัะน ะฟะพัั
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

### Production ะฝะฐัััะพะนะบะธ

```python
import os

# ะะพะปััะธัั origins ะธะท ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
ALLOWED_ORIGINS = os.getenv(
    "ALLOWED_ORIGINS",
    "https://enginecampro.com,https://www.enginecampro.com"
).split(",")

app.add_middleware(
    CORSMiddleware,
    allow_origins=ALLOWED_ORIGINS,  # ะะท ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["Content-Type", "Authorization"],
)
```

---

## ๐ก๏ธ Security Best Practices

### โ ะะ ะดะตะปะฐะน ัะฐะบ (ะฝะตะฑะตะทะพะฟะฐัะฝะพ)

```python
# ะะะะกะะ! ะะฐะทัะตัะฐะตั ะทะฐะฟัะพัั ั ะปัะฑะพะณะพ ัะฐะนัะฐ!
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],      # โ ะัะฑะพะน ัะฐะนั ะผะพะถะตั ะดะตะปะฐัั ะทะฐะฟัะพัั!
    allow_credentials=True,   # โ ะก cookies!
)
```

**ะะพัะตะผั ะพะฟะฐัะฝะพ:**
- ะัะฑะพะน ัะฐะนั ะผะพะถะตั ะพัะฟัะฐะฒะปััั ะทะฐะฟัะพัั ะบ ัะฒะพะตะผั API
- Evil.com ะผะพะถะตั ัะบัะฐััั ะดะฐะฝะฝัะต ะฟะพะปัะทะพะฒะฐัะตะปะตะน
- ะะตั ะทะฐัะธัั ะพั CSRF ะฐัะฐะบ

### โ ะะตะปะฐะน ัะฐะบ (ะฑะตะทะพะฟะฐัะฝะพ)

```python
# ะะะะะะะกะะ! ะขะพะปัะบะพ ัะฒะพะธ ะดะพะผะตะฝั
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",        # Dev
        "https://enginecampro.com",     # Production
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],  # ะะพะฝะบัะตัะฝัะต ะผะตัะพะดั
    allow_headers=["Content-Type", "Authorization"], # ะะพะฝะบัะตัะฝัะต headers
)
```

### Preflight requests

ะัะฐัะทะตั ะธะฝะพะณะดะฐ ะดะตะปะฐะตั **preflight request** (OPTIONS):
```
1. Frontend ะดะตะปะฐะตั POST /api/cams
2. ะัะฐัะทะตั ะกะะะงะะะ ะพัะฟัะฐะฒะปัะตั OPTIONS /api/cams (preflight)
3. Backend ะพัะฒะตัะฐะตั ั CORS headers
4. ะัะฐัะทะตั ะพัะฟัะฐะฒะปัะตั ัะตะฐะปัะฝัะน POST /api/cams
```

**FastAPI ะพะฑัะฐะฑะฐััะฒะฐะตั OPTIONS ะฐะฒัะพะผะฐัะธัะตัะบะธ!** โ

---

## ๐ก ะะพะฝัะตะบัั ะฟัะธะผะตะฝะตะฝะธั

### ะะพะณะดะฐ ะฝัะถะตะฝ CORS?

**CORS ะฝัะถะตะฝ ะบะพะณะดะฐ:**
- โ Frontend ะธ Backend ะฝะฐ ัะฐะทะฝัั ะฟะพััะฐั (localhost:3000 + localhost:8000)
- โ Frontend ะธ Backend ะฝะฐ ัะฐะทะฝัั ะดะพะผะตะฝะฐั (enginecampro.com + api.enginecampro.com)
- โ ะะฐะทะดะตะปัะฝะฝะฐั ะฐััะธัะตะบัััะฐ (React + FastAPI)

**CORS ะะ ะฝัะถะตะฝ ะบะพะณะดะฐ:**
- โ๏ธ Next.js Full-Stack (ะฒัั ะฒ ะพะดะฝะพะผ origin)
- โ๏ธ Server-side rendering (SSR)
- โ๏ธ ะะพะฝะพะปะธั (Frontend ะธ Backend ะฒ ะพะดะฝะพะผ ะฟัะพัะตััะต)

### ะะปั EngineCamPro v2

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          ENGINECAMPRO V2 ะะะฅะะขะะะขะฃะะ                     โ
โ                                                          โ
โ  FRONTEND (React)          BACKEND (FastAPI)             โ
โ  localhost:3000            localhost:8000                โ
โ        โ                         โ                       โ
โ        โ   HTTP Request          โ                       โ
โ        โโโโโโโโโโโโโโโโโโโโโโโโโโโ                       โ
โ                                                          โ
โ        โ ะะะ CORS - ะฑะปะพะบะธััะตััั ะฑัะฐัะทะตัะพะผ               โ
โ        โ ะก CORS - ัะฐะฑะพัะฐะตั!                             โ
โ                                                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ค ะะฐะฑะพัะฐ ั Claude Code

### ะะฐะดะฐัะฐ: ะะฐัััะพะธัั CORS ะดะปั EngineCamPro

### โ ะฅะพัะพัะธะน ะดะธะฐะปะพะณ (ัััะตะบัะธะฒะฝัะน)

```bash
cd ~/projects/enginecampro-v2/backend
claude
```

```
ะขั: ะัะถะฝะพ ะฝะฐัััะพะธัั CORS ััะพะฑั Frontend ะผะพะณ ะพะฑัะฐัะฐัััั ะบ Backend.

Claude Code: ะะฐะบะธะต origins ะฝัะถะฝะพ ัะฐะทัะตัะธัั?

ะขั: ะะฐัััะพะน CORS Middleware ะฒ app/main.py

ะขัะตะฑะพะฒะฐะฝะธั:

Development origins:
- http://localhost:3000 (React Dev Server)
- http://localhost:3001 (ะฐะปััะตัะฝะฐัะธะฒะฝัะน ะฟะพัั)

Settings:
- allow_credentials: True (ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ ะฒ ะฑัะดััะตะผ)
- allow_methods: ["GET", "POST", "PUT", "DELETE"]
- allow_headers: ["*"] (ะดะปั dev, ะฟะพัะพะผ ััะพัะฝะธะผ)

Production:
- ะะพะฑะฐะฒั ะบะพะผะผะตะฝัะฐัะธะน ััะพ origins ะฝัะถะฝะพ ะฑัะดะตั ะฒะทััั ะธะท env ะฟะตัะตะผะตะฝะฝัั

Best practices:
- ะะ ะธัะฟะพะปัะทะพะฒะฐัั allow_origins=["*"]
- ะะพะฝะบัะตัะฝัะต ะผะตัะพะดั, ะฝะต ["*"]
- ะะพะผะผะตะฝัะฐัะธะธ ะฟะพัะตะผั ะฒัะฑัะฐะฝั ััะธ ะฝะฐัััะพะนะบะธ

Claude Code: ะัะปะธัะฝะพ! ะะฐัััะพั CORS Middleware:

ะะพะฑะฐะฒะปั ะฒ app/main.py:
- ะะผะฟะพัั CORSMiddleware
- app.add_middleware() ั ัะบะฐะทะฐะฝะฝัะผะธ ะฟะฐัะฐะผะตััะฐะผะธ
- ะะพะผะผะตะฝัะฐัะธะธ ะดะปั dev/prod
- Best practices ัะพะฑะปัะดะตะฝั

ะัะธะผะตะฝะธัั? [Y/n]

ะขั: Y

Claude Code: โ ะะพะฑะฐะฒะธะป CORS Middleware ะฒ app/main.py:

```python
from fastapi.middleware.cors import CORSMiddleware

# CORS Configuration
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:3000",    # React Dev Server
        "http://localhost:3001",    # Alternative port
        # Production: use environment variables
    ],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],  # Dev: allow all, Prod: specify
)
```

ะขะตะฟะตัั Frontend ะผะพะถะตั ะดะตะปะฐัั ะทะฐะฟัะพัั!

ะัะพัะตััะธััะน:
1. ะะฐะฟัััะธ Backend: uvicorn app.main:app --reload
2. ะะฐะฟัััะธ Frontend: npm run dev
3. ะะพะฟัะพะฑัะน ัะดะตะปะฐัั fetch() ะทะฐะฟัะพั

ะขั: ะัะปะธัะฝะพ! ะขะตะฟะตัั ะดะพะฑะฐะฒั logging middleware ััะพะฑั ะปะพะณะธัะพะฒะฐัั 
ะฒัะต ะทะฐะฟัะพัั.

Claude Code: ะกะพะทะดะฐะผ custom middleware:
- ะะพะณะธััะตั ะผะตัะพะด ะธ URL
- ะะพะณะธััะตั ะฒัะตะผั ะฒัะฟะพะปะฝะตะฝะธั
- ะะพะฑะฐะฒะปั ะฟะตัะตะด CORS middleware

ะัะธะผะตะฝะธัั? [Y/n]

ะขั: Y

Claude Code: โ ะะพะฑะฐะฒะธะป logging middleware:

```python
import time
import logging

@app.middleware("http")
async def log_requests(request, call_next):
    start_time = time.time()
    response = await call_next(request)
    duration = time.time() - start_time
    
    logging.info(
        f"{request.method} {request.url.path} "
        f"completed in {duration:.3f}s"
    )
    return response
```

ะขะตะฟะตัั ะฒัะต ะทะฐะฟัะพัั ะปะพะณะธัััััั! ะัะพะฒะตัั ะบะพะฝัะพะปั ะฟัะธ ะทะฐะฟัะพัะฐั.

ะขั: ะกะฟะฐัะธะฑะพ!
```

**ะะพัะตะผั ััะพ ัััะตะบัะธะฒะฝะพ:**
- โ ะงััะบะธะต ััะตะฑะพะฒะฐะฝะธั ะดะปั dev ะธ prod
- โ Best practices ัะฟะพะผัะฝััั
- โ ะัะตัะฐัะธะฒะฝะพะต ะดะพะฑะฐะฒะปะตะฝะธะต (CORS, ะฟะพัะพะผ logging)
- โ ะะฝััััะบัะธะธ ะบะฐะบ ัะตััะธัะพะฒะฐัั

---

## ๐๏ธ ะัะฐะบัะธัะตัะบะพะต ะทะฐะดะฐะฝะธะต

### ะะฐะดะฐัะฐ

ะะฐัััะพะน CORS ะธ ะดะพะฑะฐะฒั logging middleware ัะตัะตะท ะดะธะฐะปะพะณ ั Claude Code. Frontend ะดะพะปะถะตะฝ ััะฟะตัะฝะพ ะพะฑัะฐัะฐัััั ะบ Backend.

### ะงัะพ ะฝัะถะฝะพ ัะพะทะดะฐัั

- CORS Middleware ั ะฟัะฐะฒะธะปัะฝัะผะธ ะฝะฐัััะพะนะบะฐะผะธ
- Logging Middleware ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ ะทะฐะฟัะพัะพะฒ
- ะะพะผะผะตะฝัะฐัะธะธ ะดะปั dev/prod ะฝะฐัััะพะตะบ

### ะะฐะฑะพัะฐ ั Claude Code

**ะจะฐะณ 1:** ะัะบัะพะน ัะตัะผะธะฝะฐะป
```bash
cd ~/projects/enginecampro-v2/backend
claude
```

**ะจะฐะณ 2:** ะะธะฐะปะพะณ ั Claude Code

```
ะขั: ะะฐัััะพะน CORS ะฒ app/main.py

[ะฃะบะฐะถะธ origins]
[ะฃะบะฐะถะธ ะฝะฐัััะพะนะบะธ]
[ะฃะบะฐะถะธ best practices]

Claude Code: [ะดะพะฑะฐะฒะธั CORS middleware]

ะขั: ะะพะฑะฐะฒั logging middleware

Claude Code: [ะดะพะฑะฐะฒะธั logging]
```

**ะจะฐะณ 3:** ะะฐะฟัััะธ Backend
```bash
uvicorn app.main:app --reload
```

**ะจะฐะณ 4:** ะขะตััะธัะพะฒะฐะฝะธะต CORS

ะกะพะทะดะฐะน ะฟัะพััะพะน HTML ัะฐะนะป ะดะปั ัะตััะฐ:
```html
<!-- test-cors.html -->
<!DOCTYPE html>
<html>
<body>
  <button onclick="testAPI()">Test API</button>
  <script>
    async function testAPI() {
      try {
        const response = await fetch('http://localhost:8000/api/cams');
        const data = await response.json();
        console.log('โ CORS ัะฐะฑะพัะฐะตั!', data);
        alert('CORS ัะฐะฑะพัะฐะตั! ะกะผะพััะธ ะบะพะฝัะพะปั.');
      } catch (error) {
        console.error('โ CORS ะพัะธะฑะบะฐ:', error);
        alert('CORS ะพัะธะฑะบะฐ! ะกะผะพััะธ ะบะพะฝัะพะปั.');
      }
    }
  </script>
</body>
</html>
```

ะัะบัะพะน ัะฐะนะป ะฒ ะฑัะฐัะทะตัะต ะธ ะฝะฐะถะผะธ ะบะฝะพะฟะบั.

### ะงัะพ ะฟัะพัะตััะธัะพะฒะฐัั

**1. CORS ัะฐะฑะพัะฐะตั**
- ะัะบัะพะน test-cors.html ะฒ ะฑัะฐัะทะตัะต
- ะะฐะถะผะธ "Test API"
- ะัะพะฒะตัั ะบะพะฝัะพะปั - ะะ ะดะพะปะถะฝะพ ะฑััั CORS ะพัะธะฑะบะธ
- โ ะะฐะฟัะพั ะฟัะพััะป ััะฟะตัะฝะพ

**2. CORS ะฑะปะพะบะธััะตั ะฝะตัะฐะทัะตััะฝะฝัะต origins**
- ะะทะผะตะฝะธ ะฒ CORS: `allow_origins=["http://example.com"]`
- ะะตัะตะทะฐะฟัััะธ ัะตัะฒะตั
- ะะฐะถะผะธ "Test API" ัะฝะพะฒะฐ
- โ ะะพะปะถะฝะฐ ะฑััั CORS ะพัะธะฑะบะฐ ะฒ ะบะพะฝัะพะปะธ
- ะะตัะฝะธ `localhost:3000` ะพะฑัะฐัะฝะพ

**3. Logging ัะฐะฑะพัะฐะตั**
- ะกะดะตะปะฐะน ะฝะตัะบะพะปัะบะพ ะทะฐะฟัะพัะพะฒ ะบ API
- ะัะพะฒะตัั ะบะพะฝัะพะปั Backend
- โ ะะธะดะธัั ะปะพะณะธ: "GET /api/cams completed in 0.XXXs"

**4. Preflight requests**
- ะัะบัะพะน DevTools โ Network
- ะกะดะตะปะฐะน POST ะทะฐะฟัะพั ะบ /api/cams
- โ ะะธะดะธัั OPTIONS ะทะฐะฟัะพั (preflight)
- โ ะะพัะพะผ ะธะดัั POST ะทะฐะฟัะพั

### ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั

- โ CORS Middleware ะฝะฐัััะพะตะฝ
- โ Frontend ะผะพะถะตั ะดะตะปะฐัั ะทะฐะฟัะพัั ะบ Backend
- โ Logging Middleware ะปะพะณะธััะตั ะฒัะต ะทะฐะฟัะพัั
- โ Preflight requests ะพะฑัะฐะฑะฐััะฒะฐัััั ะฐะฒัะพะผะฐัะธัะตัะบะธ
- โ ะะตัะฐะทัะตััะฝะฝัะต origins ะฑะปะพะบะธัััััั

### ะะฐะบ ะฟัะพะฒะตัะธัั

- [ ] CORS middleware ะดะพะฑะฐะฒะปะตะฝ ะฒ app/main.py
- [ ] Test-cors.html ัะฐะฑะพัะฐะตั ะฑะตะท ะพัะธะฑะพะบ
- [ ] ะะตัะฐะทัะตััะฝะฝัะน origin ะฑะปะพะบะธััะตััั
- [ ] ะะพะณะธ ะฟะพัะฒะปััััั ะฒ ะบะพะฝัะพะปะธ Backend
- [ ] OPTIONS requests ะฒะธะดะฝั ะฒ DevTools

---

## โ ะะพะฟัะพัั ะดะปั ัะฐะผะพะฟัะพะฒะตัะบะธ

1. **Middleware:**
   - ะงัะพ ัะฐะบะพะต middleware?
   - ะะฐัะตะผ ะพะฝ ะฝัะถะตะฝ?
   - ะะฐะบ middleware ัะฐะฑะพัะฐะตั ะฒ FastAPI?

2. **CORS:**
   - ะงัะพ ัะฐะบะพะต Same-Origin Policy?
   - ะะฐัะตะผ ะฝัะถะตะฝ CORS?
   - ะงัะพ ะฟัะพะธะทะพะนะดัั ะฑะตะท CORS?

3. **CORS ะฝะฐัััะพะนะบะธ:**
   - ะ ััะผ ัะฐะทะฝะธัะฐ ะผะตะถะดั allow_origins=["*"] ะธ ะบะพะฝะบัะตัะฝัะผะธ origins?
   - ะงัะพ ัะฐะบะพะต preflight request?
   - ะะพะณะดะฐ ะธัะฟะพะปัะทะพะฒะฐัั allow_credentials=True?

4. **Security:**
   - ะะพัะตะผั allow_origins=["*"] ะพะฟะฐัะฝะพ?
   - ะะฐะบะธะต origins ัะบะฐะทะฐัั ะดะปั dev?
   - ะะฐะบะธะต origins ัะบะฐะทะฐัั ะดะปั production?

5. **ะะปั EngineCamPro v2:**
   - ะะฐ ะบะฐะบะธั ะฟะพััะฐั ะฑัะดัั Frontend ะธ Backend?
   - ะัะถะตะฝ ะปะธ CORS?
   - ะะฐะบะธะต ะฝะฐัััะพะนะบะธ ะธัะฟะพะปัะทะพะฒะฐัั?

---

## ๐ ะกะฒัะทั ั ะดััะณะธะผะธ ััะพะบะฐะผะธ

**ะัะฝะพะฒะฐะฝะพ ะฝะฐ ััะพะบะฐั:**
- ะฃัะพะบ 1.1: Client-Server - ะฟะพะฝะธะผะฐะฝะธะต ัะฐะทะดะตะปัะฝะฝะพะน ะฐััะธัะตะบัััั
- ะฃัะพะบ 2.1: ะะฒะตะดะตะฝะธะต ะฒ FastAPI - ััััะบัััะฐ ะฟัะธะปะพะถะตะฝะธั

**ะะพะดะณะพัะฐะฒะปะธะฒะฐะตั ะบ ััะพะบะฐะผ:**
- ะฃัะพะบ 4.2: Fetch API - Frontend ะฑัะดะตั ะดะตะปะฐัั ะทะฐะฟัะพัั
- ะฃัะพะบ 5.1: Frontend-Backend ะธะฝัะตะณัะฐัะธั - CORS ะฒะฐะถะตะฝ ะทะดะตัั
- ะฃัะพะบ 6.1: ะััะตะฝัะธัะธะบะฐัะธั - allow_credentials ะดะปั ัะพะบะตะฝะพะฒ

**ะกะฒัะทั ั EngineCamPro v2:**
CORS - ััะพ ะผะพัั ะผะตะถะดั Frontend ะธ Backend:
- React ะฝะฐ :3000 โ FastAPI ะฝะฐ :8000
- ะะตะท CORS ะฑัะฐัะทะตั ะฑะปะพะบะธััะตั ะทะฐะฟัะพัั
- ะก CORS ะฒัั ัะฐะฑะพัะฐะตั ะณะปะฐะดะบะพ

---

## โ ะัะธัะตัะธะธ ะทะฐะฒะตััะตะฝะธั ััะพะบะฐ

**ะะพะฝะธะผะฐะฝะธะต middleware:**
- [ ] ะะฝะฐั ััะพ ัะฐะบะพะต middleware
- [ ] ะะพะฝะธะผะฐั ะฐะฝะฐะปะพะณะธั ั ะพััะฐะฝะฝะธะบะพะผ
- [ ] ะะฝะฐั ะทะฐัะตะผ ะพะฝ ะฝัะถะตะฝ

**ะะพะฝะธะผะฐะฝะธะต CORS:**
- [ ] ะะฝะฐั ััะพ ัะฐะบะพะต Same-Origin Policy
- [ ] ะะพะฝะธะผะฐั ะทะฐัะตะผ ะฝัะถะตะฝ CORS
- [ ] ะะฝะฐั ะบะฐะบ ะฝะฐัััะพะธัั CORS ะฒ FastAPI

**Security:**
- [ ] ะะพะฝะธะผะฐั ะฟะพัะตะผั ["*"] ะพะฟะฐัะฝะพ
- [ ] ะะฝะฐั ะฟัะฐะฒะธะปัะฝัะต ะฝะฐัััะพะนะบะธ ะดะปั dev/prod
- [ ] ะะพะฝะธะผะฐั preflight requests

**ะัะฐะบัะธะบะฐ:**
- [ ] ะะฐัััะพะธะป CORS ัะตัะตะท Claude Code
- [ ] ะะพะฑะฐะฒะธะป logging middleware
- [ ] ะัะพัะตััะธัะพะฒะฐะป ัะตัะตะท test-cors.html
- [ ] ะะธะดะตะป CORS ะพัะธะฑะบั ะฟัะธ ะฝะตะฟัะฐะฒะธะปัะฝัั ะฝะฐัััะพะนะบะฐั

**ะะพะบัะผะตะฝัะธัะพะฒะฐะฝะธะต:**
- [ ] ะะฐะฟะธัะฐะป ะฒัะฒะพะดั
- [ ] ะะพะฝะธะผะฐั ัะปะตะดัััะธะน ััะพะบ

---

**ะกะปะตะดัััะธะน ััะพะบ:** 2.6 ะะฒัะพะดะพะบัะผะตะฝัะฐัะธั API (Swagger)  
**ะัะตะผั ะฝะฐ ััะพะบ:** 40-55 ะผะธะฝัั  
**ะกัะฐััั:** โณ ะะต ะฝะฐัะฐั / ๐ ะ ะฟัะพัะตััะต / โ ะะฐะฒะตัััะฝ

---

*ะะตััะธั ััะพะบะฐ: 1.0*  
*ะะฐัะฐ ัะพะทะดะฐะฝะธั: 11 ะพะบััะฑัั 2025*  
*ะคะพัะผะฐั: Vibe Coding ั ะดะธะฐะปะพะณะฐะผะธ Claude Code*