# Урок 2.1: Введение в FastAPI

> **Модуль 2:** Backend разработка  
> **Урок:** 2.1  
> **Длительность:** 45-60 минут  
> **Prerequisite:** Модуль 1 (Основы веб-архитектуры)

---

## 🎯 Цели урока

После этого урока ты сможешь:
- ✅ Понимать что такое веб-фреймворк и зачем он нужен
- ✅ Объяснить почему FastAPI выбран для EngineCamPro v2
- ✅ Эффективно общаться с Claude Code для создания FastAPI приложений
- ✅ Создать своё первое API с помощью Claude Code
- ✅ Понимать когда использовать FastAPI vs альтернативы

---

## 📖 Концепция: Что такое веб-фреймворк?

### Простое определение

**Фреймворк** - это готовый "каркас" приложения со встроенными решениями типичных задач. Вместо того чтобы писать всё с нуля, ты используешь готовую структуру и добавляешь свою логику.

### Зачем это нужно

Без фреймворка тебе пришлось бы самому:
- Разбирать HTTP запросы вручную
- Валидировать данные через кучу `if`/`else`
- Писать обработку ошибок для каждого endpoint
- Создавать документацию API вручную
- Настраивать CORS, security, logging и т.д.

**Проблема:** Это занимает недели работы и полно ошибок!

**Решение:** Фреймворк делает всё это за тебя. Ты фокусируешься на бизнес-логике (расчёты кулачков), а не на "сантехнике".

### 🏗️ Аналогия: Конструктор Lego

```
БЕЗ ФРЕЙМВОРКА (делать кирпичики самому)
════════════════════════════════════════

🧱 Создать глину
↓
🔥 Обжечь кирпичи  
↓
📏 Нарезать ровными
↓
🏗️ Построить дом
└──► 6 месяцев работы


С ФРЕЙМВОРКОМ (готовые блоки Lego)
═══════════════════════════════════

📦 Взять готовые блоки
↓
🏗️ Собрать дом по инструкции
└──► 2 недели работы
```

**Фреймворк = набор готовых "блоков":**
- 🧱 Routing (куда пришёл запрос)
- 🔍 Валидация (правильные ли данные)
- 📋 Документация (Swagger UI автоматически)
- 🛡️ Security (защита от атак)
- 🔧 Error handling (правильные ошибки)

Ты просто **соединяешь блоки** - фреймворк делает остальное!

### Как работает

```
┌─────────────────────────────────────────────────────────┐
│                  ВЕБ-ПРИЛОЖЕНИЕ                         │
│                                                         │
│  ┌────────────────────────────────────────────────┐    │
│  │          FASTAPI ФРЕЙМВОРК (каркас)            │    │
│  │                                                 │    │
│  │  [Routing] [Validation] [Docs] [CORS] [Auth]   │    │
│  │                                                 │    │
│  │  ┌─────────────────────────────────────────┐   │    │
│  │  │   ТВОЯ БИЗНЕС-ЛОГИКА (расчёты)         │   │    │
│  │  │                                         │   │    │
│  │  │  def calculate_cam_profile():          │   │    │
│  │  │      # Твой код здесь                  │   │    │
│  │  │      return profile                     │   │    │
│  │  │                                         │   │    │
│  │  └─────────────────────────────────────────┘   │    │
│  │                                                 │    │
│  └────────────────────────────────────────────────┘    │
│                                                         │
└─────────────────────────────────────────────────────────┘

Фреймворк = фундамент, стены, крыша
Твой код = мебель и интерьер
```

---

## 💡 Контекст применения (ВАЖНО!)

### Когда использовать FastAPI?

**FastAPI идеален для:**
- ✅ **Python Backend нужен** (математика, ML, Data Science)
- ✅ **REST API для разделённой архитектуры** (Frontend отдельно)
- ✅ **Внешний доступ к API** (из MATLAB, Python scripts, мобильных приложений)
- ✅ **Работа с ИИ-ассистентами** (Claude Code отлично знает FastAPI)
- ✅ **Нужна автодокументация** (Swagger UI из коробки)
- ✅ **Производительность важна** (async, быстрее Flask)

**Примеры проектов для FastAPI:**
- 🔧 **EngineCamPro v2** - математические расчёты (NumPy, SciPy)
- 🤖 **ML/AI API** - модели машинного обучения
- 📊 **Data Science дашборды** - анализ данных
- 🔬 **Научные инструменты** - симуляции, моделирование
- 🎓 **Образовательные платформы с Python Backend** (RAG онлайн-школа)

### Когда НЕ нужен FastAPI?

**Используй альтернативы если:**
- ⚠️ **Простой веб-сайт** (блог, лендинг, документация) → **Next.js Full-Stack**
- ⚠️ **Только веб-интерфейс без математики** → **Next.js Full-Stack**
- ⚠️ **JavaScript везде предпочтительнее** → **Next.js Full-Stack**
- ⚠️ **Быстрое прототипирование простого проекта** → **Next.js Full-Stack**

---

## 🔄 Сравнение Python Backend фреймворков

### FastAPI vs Flask vs Django REST Framework

| Аспект | FastAPI ✅ | Flask | Django REST |
|--------|-----------|-------|-------------|
| **Философия** | Современный, type-safe | Минималистичный | Полнофункциональный |
| **Скорость** | ⚡ Очень быстрый (async) | 🐢 Медленный (sync) | 🐢 Медленный (sync) |
| **Автодокументация** | ✅ Swagger из коробки | ❌ Нужны расширения | ⚠️ Через drf-spectacular |
| **Валидация** | ✅ Pydantic автоматически | ❌ Вручную | ⚠️ Django Serializers |
| **Type hints** | ✅ Обязательно | ❌ Опционально | ❌ Опционально |
| **Для ИИ** | ✅ Отлично (чёткие типы) | ⚠️ Средне | ⚠️ Средне |
| **Кривая обучения** | 📚 Средняя | 📖 Простая | 📚📚 Крутая |
| **REST API фокус** | ✅ Да | ⚠️ Нужны расширения | ✅ Да |
| **Батарейки в комплекте** | ⚠️ Минимум | ❌ Минимум | ✅ Всё есть |
| **Админ-панель** | ❌ Нет | ❌ Нет | ✅ Да |
| **ORM** | ⚠️ SQLAlchemy отдельно | ⚠️ SQLAlchemy отдельно | ✅ Django ORM |
| **Для EngineCamPro** | ✅ Идеально | ⚠️ Можно | ⚠️ Излишне |

### Когда использовать каждый?

#### ⚡ FastAPI - выбери для:
- REST API приложений
- Микросервисов
- Когда нужна производительность
- Работы с ИИ-ассистентами
- ML/Data Science проектов
- **👉 EngineCamPro v2**

#### 🔧 Flask - выбери для:
- Простых прототипов
- Когда нужна максимальная гибкость
- Маленьких проектов
- Изучения основ веб-разработки

#### 📦 Django REST Framework - выбери для:
- Полнофункциональных веб-приложений
- Когда нужна админ-панель из коробки
- Сложные проекты с аутентификацией, permissions
- Больших команд (convention over configuration)

### Для EngineCamPro v2: Почему FastAPI?

```
✅ Python нужен для математики (NumPy, SciPy)
✅ REST API для внешнего доступа (MATLAB, scripts)
✅ Type hints помогают Claude Code
✅ Swagger документация для пользователей
✅ Производительность для расчётов
✅ Современный стек (React лучше работает с FastAPI)
```

---

## 🌐 Как работает FastAPI в веб-приложении

### Архитектура EngineCamPro v2

```
┌──────────────────────────────────────────────────────────────┐
│                    ВЕБРОЕ-ПРИЛОЖЕНИЕ                         │
│                                                              │
│  👤 FRONTEND (React)         🖥️ BACKEND (FastAPI)            │
│                                                              │
│  ┌──────────────────┐        ┌─────────────────────────┐   │
│  │ Форма ввода      │        │ FastAPI Framework       │   │
│  │ параметров       │        │                         │   │
│  │                  │        │ ┌─────────────────────┐ │   │
│  │ Base Radius: 25  │   ➊    │ │ Endpoints (Routes)  │ │   │
│  │ Lift: 10         │───────►│ │  /api/cams         │ │   │
│  │ Duration: 120°   │ POST   │ │  /api/calculate    │ │   │
│  │                  │        │ └─────────────────────┘ │   │
│  │ [Calculate] 🔧   │        │          ↓              │   │
│  └──────────────────┘        │ ┌─────────────────────┐ │   │
│           ↑                  │ │ Pydantic Validation │ │   │
│           │                  │ │ ✅ Проверка данных  │ │   │
│           │                  │ └─────────────────────┘ │   │
│           │                  │          ↓              │   │
│           │            ➋     │ ┌─────────────────────┐ │   │
│           │                  │ │ Бизнес-логика       │ │   │
│           │                  │ │ calculate_profile() │ │   │
│           │                  │ │ NumPy, SciPy        │ │   │
│           │                  │ └─────────────────────┘ │   │
│           │            ➌     │          ↓              │   │
│           └──────────────────│ ┌─────────────────────┐ │   │
│                JSON response │ │ JSON Response       │ │   │
│              (profile data)  │ │ {profile: [...]}    │ │   │
│                              │ └─────────────────────┘ │   │
│  ┌──────────────────┐        │                         │   │
│  │ График профиля   │        │ [Swagger Docs] 📋       │   │
│  │                  │        │ http://localhost:8000/  │   │
│  │  📈              │        │            docs         │   │
│  │                  │        │                         │   │
│  └──────────────────┘        └─────────────────────────┘   │
│                                                              │
└──────────────────────────────────────────────────────────────┘

Поток данных:
➊ Frontend отправляет POST запрос с параметрами
➋ FastAPI валидирует → вызывает расчёт
➌ Backend возвращает JSON с результатами
```

### Что делает FastAPI автоматически?

```python
# Ты пишешь:
@app.post("/api/calculate")
def calculate(params: CamParams):
    return {"profile": calculate_profile(params)}

# FastAPI делает ЗА ТЕБЯ:
✅ Парсит HTTP запрос
✅ Валидирует JSON через Pydantic
✅ Конвертирует типы данных
✅ Обрабатывает ошибки (422 если данные неверные)
✅ Сериализует ответ в JSON
✅ Добавляет правильные HTTP headers
✅ Создаёт Swagger документацию
✅ Добавляет в OpenAPI спецификацию
```

**Магия!** Ты сосредоточен на логике расчётов, а не на "сантехнике" HTTP.

---

## 🤖 Работа с Claude Code

### Что такое Claude Code?

**Claude Code** - это CLI инструмент для диалогового кодирования:
- Запускается в терминале: `claude`
- Работает в режиме **ДИАЛОГА** (вопрос-ответ)
- ИИ **САМ пишет код** и применяет изменения
- Ты **ОБЩАЕШЬСЯ**, а не пишешь код

### ❌ Плохой диалог (неэффективный)

```
Ты: Сделай FastAPI

Claude Code: Что именно нужно создать?

Ты: API

Claude Code: Какие endpoints? Какая структура?

Ты: Не знаю, сделай что-нибудь
```

**Проблемы:**
- ❌ Неясно что создавать
- ❌ ИИ вынужден угадывать
- ❌ Результат не соответствует ожиданиям
- ❌ Много итераций на уточнение

### ✅ Хороший диалог (эффективный)

```bash
# Шаг 1: Открой терминал в папке проекта
cd ~/projects/enginecampro-v2/backend
claude
```

```
Ты: Привет Claude! Помоги создать FastAPI приложение для EngineCamPro.

Claude Code: Конечно! Расскажи подробнее - какие endpoints нужны и что 
приложение должно делать?

Ты: Создай FastAPI приложение со следующими требованиями:

Структура проекта:
- app/main.py (FastAPI приложение)
- app/models.py (Pydantic модели)
- app/routers/ (endpoints)
- requirements.txt (зависимости)

Технологии:
- FastAPI (latest)
- Pydantic для валидации
- CORS middleware для frontend (http://localhost:3000)
- Следуй FastAPI best practices

Endpoints для начала:
- GET / - hello world
- GET /api/info - информация о API
- GET /health - health check

Требования к коду:
- Type hints везде
- Автоматическая документация OpenAPI
- Правильные HTTP статус коды
- Обработка ошибок

Claude Code: Отлично! Создам FastAPI приложение с такой структурой:

```
backend/
├── app/
│   ├── __init__.py
│   ├── main.py          # FastAPI app с CORS
│   ├── models.py        # Pydantic модели
│   └── routers/
│       ├── __init__.py
│       └── info.py      # endpoint /api/info
├── requirements.txt
└── README.md
```

Применить изменения? [Y/n]

Ты: Y

Claude Code: ✅ Создал файлы:
- app/main.py (FastAPI app с CORS middleware)
- app/models.py (базовые Pydantic модели)
- app/routers/info.py (endpoint /api/info)
- requirements.txt (FastAPI, uvicorn, pydantic)
- README.md (инструкции по запуску)

Готово! Теперь можешь запустить:
```bash
pip install -r requirements.txt
uvicorn app.main:app --reload
```

Ты: Отлично! Теперь добавь endpoint POST /api/calculate для расчёта 
профиля кулачка.

Входные параметры:
- base_radius: float (мм)
- lift: float (мм)
- duration: float (градусы)

Выходные данные:
- profile: List[dict] с полями angle, radius
- max_velocity: float
- max_acceleration: float

Используй Pydantic модель для валидации.

Claude Code: Добавлю endpoint для расчёта. Создам:
1. Pydantic модель CamParams для входных данных
2. Pydantic модель ProfileResult для ответа
3. Endpoint POST /api/calculate в app/routers/cams.py
4. Заглушку для расчёта (пока без математики)

Применить? [Y/n]

Ты: Y

Claude Code: ✅ Добавил:
- app/models.py (CamParams, ProfileResult модели)
- app/routers/cams.py (endpoint /api/calculate)
- app/main.py (подключил router)

Endpoint готов! Протестируй через Swagger:
http://localhost:8000/docs

Ты: Проверю. Спасибо!
```

**Почему это эффективно:**
- ✅ Чёткие требования с самого начала
- ✅ Указаны технологии и структура
- ✅ Best practices упомянуты
- ✅ Конкретные endpoints и модели
- ✅ ИИ понимает контекст (EngineCamPro)
- ✅ Итеративное улучшение через диалог

---

## 🛠️ Практическое задание

### Задача

Создай своё первое FastAPI приложение через диалог с Claude Code. Приложение должно иметь базовые endpoints и автодокументацию.

### Что нужно создать

- FastAPI приложение с правильной структурой
- Endpoint GET / - приветствие
- Endpoint GET /api/info - информация о API
- Endpoint POST /api/calculate - заглушка для расчётов
- Swagger документация
- CORS middleware

### Работа с Claude Code

**Шаг 1:** Создай папку для проекта
```bash
mkdir ~/projects/my-first-fastapi
cd ~/projects/my-first-fastapi
```

**Шаг 2:** Запусти Claude Code
```bash
claude
```

**Шаг 3:** Диалог с Claude Code (адаптируй под себя)

```
Ты: Привет! Помоги создать FastAPI приложение для обучения.

Claude Code: [спросит детали]

Ты: Создай FastAPI приложение со следующими требованиями:

Структура:
- app/main.py (FastAPI app)
- app/routers/api.py (endpoints)
- requirements.txt
- README.md

Endpoints:
- GET / - возвращает {"message": "Hello from FastAPI!"}
- GET /api/info - возвращает название API и версию
- POST /api/calculate - принимает {value: float}, возвращает {result: float}

Требования:
- CORS для http://localhost:3000
- Pydantic модели для валидации
- Type hints
- Swagger документация
- Следуй FastAPI best practices

Claude Code: [предложит структуру]

Ты: Y

Claude Code: [создаст файлы]
```

**Шаг 4:** Установи зависимости
```bash
pip install -r requirements.txt
```

**Шаг 5:** Запусти сервер
```bash
uvicorn app.main:app --reload
```

**Шаг 6:** Открой Swagger UI
```
http://localhost:8000/docs
```

### Ожидаемый результат

- ✅ Приложение запускается без ошибок
- ✅ Swagger UI доступен по /docs
- ✅ Можно протестировать все endpoints через Swagger
- ✅ POST /api/calculate валидирует данные (попробуй отправить строку вместо числа)

### Как проверить

- [ ] `uvicorn app.main:app --reload` запускается
- [ ] http://localhost:8000/ возвращает приветствие
- [ ] http://localhost:8000/docs показывает Swagger UI
- [ ] В Swagger можно протестировать endpoints
- [ ] Валидация работает (неправильные данные → 422 ошибка)

### Дополнительно (если хочешь)

Продолжи диалог с Claude Code:
```
Ты: Добавь endpoint GET /api/health для health check. Пусть возвращает 
{"status": "healthy", "timestamp": <текущее время>}

Claude Code: [добавит endpoint]
```

---

## ❓ Вопросы для самопроверки

Ответь на эти вопросы своими словами:

1. **Что такое фреймворк?**
   - Объясни аналогию с конструктором Lego
   - Какие проблемы решает фреймворк?

2. **Зачем нужен FastAPI?**
   - Что FastAPI делает автоматически?
   - В чём преимущества перед "голым" Python?

3. **FastAPI vs альтернативы:**
   - Когда выбрать FastAPI?
   - Когда выбрать Next.js Full-Stack?
   - В чём отличие от Flask и Django?

4. **Для EngineCamPro v2:**
   - Почему выбран FastAPI?
   - Какие технологии нужны (Python для чего)?
   - Как будет работать архитектура?

5. **Работа с Claude Code:**
   - Чем плохой диалог отличается от хорошего?
   - Что нужно указать в требованиях?
   - Как итеративно улучшать через диалог?

6. **Практика:**
   - Что делает endpoint GET vs POST?
   - Как проверить API через Swagger?
   - Что такое валидация данных?

---

## 🔗 Связь с другими уроками

**Основано на уроках:**
- Урок 1.1: Client-Server архитектура - понимание Backend роли
- Урок 1.2: HTTP протокол - как работают запросы
- Урок 1.4: REST API концепции - что такое endpoints

**Подготавливает к урокам:**
- Урок 2.2: HTTP методы - детальная работа с GET/POST/PUT/DELETE
- Урок 2.3: Pydantic модели - валидация данных
- Урок 2.4: Обработка ошибок - правильные HTTP коды

**Связь с EngineCamPro v2:**
FastAPI - это основа всего Backend. В следующих уроках ты добавишь:
- Endpoints для CRUD операций с кулачками
- Математические расчёты (NumPy, SciPy)
- Интеграцию с базой данных
- Монетизацию (Clerk + Stripe)

**Связь с другими модулями:**
- **Модуль 8 (Next.js):** Альтернатива FastAPI для простых проектов
- **Модуль 9 (RAG):** FastAPI Backend для AI ассистента

---

## ✅ Критерии завершения урока

**Понимание концепций:**
- [ ] Могу объяснить что такое фреймворк
- [ ] Понимаю аналогию с конструктором Lego
- [ ] Знаю зачем нужен FastAPI
- [ ] Понимаю что FastAPI делает автоматически

**Сравнение технологий:**
- [ ] Знаю когда использовать FastAPI
- [ ] Знаю когда использовать Next.js Full-Stack
- [ ] Могу сравнить FastAPI vs Flask vs Django
- [ ] Понимаю выбор для EngineCamPro v2

**Работа с Claude Code:**
- [ ] Понимаю как работает Claude Code
- [ ] Могу провести эффективный диалог с ИИ
- [ ] Знаю что указывать в требованиях
- [ ] Понимаю итеративное улучшение

**Практические навыки:**
- [ ] Создал FastAPI приложение через Claude Code
- [ ] Запустил сервер локально
- [ ] Открыл Swagger UI и протестировал endpoints
- [ ] Проверил валидацию данных

**Документирование:**
- [ ] Записал выводы в блокнот
- [ ] Если были вопросы - записал их
- [ ] Понимаю что буду делать в следующем уроке

---

**Следующий урок:** 2.2 HTTP методы и endpoints  
**Время на урок:** 45-60 минут  
**Статус:** ⏳ Не начат / 🔄 В процессе / ✅ Завершён

---

*Версия урока: 1.0*  
*Дата создания: 11 октября 2025*  
*Формат: Vibe Coding с диалогами Claude Code*