# Урок 9.0: Введение в RAG системы

> **Модуль 9:** RAG + AI Агент  
> **Урок:** 9.0 (вводный)  
> **Длительность:** 2 часа  
> **Prerequisite:** Модули 1-7

---

## 🎯 Цели урока

После этого урока ты сможешь:
- ✅ Понимать что такое RAG (Retrieval-Augmented Generation)
- ✅ Знать проблему: почему ChatGPT не знает твой контент
- ✅ Понимать как RAG решает эту проблему
- ✅ Знать архитектуру RAG системы
- ✅ Понимать когда использовать RAG vs Fine-tuning

---

## 📖 Часть 1: Проблема — LLM не знают твой контент

### Главный вопрос урока

**"Как сделать так, чтобы AI знал о моих уроках?"**

### Эксперимент: Спроси ChatGPT

**Попробуй задать ChatGPT вопрос:**
```
Ты: "Объясни что такое Server Actions в Next.js из курса ai-web-learning"

ChatGPT: "Извините, но я не имею доступа к конкретному курсу 
'ai-web-learning'. Могу объяснить Server Actions в общих чертах..."
```

**Проблема:** ChatGPT не знает про твой курс!

### Почему LLM не знают твой контент?

**1. Обучение закончилось в прошлом**
```
GPT-4 обучен на данных до апреля 2023
Твой курс создан в октябре 2025
                ↓
GPT-4 не знает о нём ❌
```

**2. Твой контент приватный**
```
Твои уроки на GitHub (приватный репозиторий)
OpenAI не имеет к ним доступа
                ↓
GPT-4 не видел эти данные ❌
```

**3. Специфичный контент**
```
Твоя образовательная платформа уникальна
Твои упражнения, примеры, задания
                ↓
Нет в публичных данных OpenAI ❌
```

### Последствия

**Если студент спрашивает AI помощника:**
```
Студент: "Какое упражнение в Уроке 2.3 про FastAPI endpoints?"

AI без RAG: "Я не знаю какое упражнение в вашем курсе. 
Могу рассказать про FastAPI endpoints в общем..."

❌ НЕ ПОМОГАЕТ!
```

---

## 💡 Часть 2: Решение — RAG (Retrieval-Augmented Generation)

### Что такое RAG?

**Простое определение:**
RAG = система которая НАХОДИТ релевантную информацию из твоих документов и ПЕРЕДАЁТ её AI для генерации ответа.

**Расшифровка:**
- **Retrieval** (Поиск) — найди релевантные части документов
- **Augmented** (Дополненная) — добавь найденную информацию к запросу
- **Generation** (Генерация) — создай ответ на основе найденного

### Аналогия: Студент на экзамене

**Без RAG (закрытая книга):**
```
Экзаменатор: "Что такое Server Actions?"
Студент: "Эм... что-то про Next.js... не помню детали..."
```

**С RAG (открытая книга):**
```
Экзаменатор: "Что такое Server Actions?"
Студент: 
  1. Открывает учебник на нужной странице (Retrieval)
  2. Читает определение (Augmented)
  3. Формулирует ответ своими словами (Generation)
     
"Server Actions — это функции в Next.js которые выполняются 
на сервере и вызываются как обычные функции с клиента..."
```

### Визуальная диаграмма RAG

```
┌───────────────────────────────────────────────────────┐
│              БЕЗ RAG (обычный ChatGPT)                │
├───────────────────────────────────────────────────────┤
│                                                       │
│  Вопрос студента                                      │
│  "Что такое Server Actions?"                          │
│         ↓                                             │
│  ┌──────────────────┐                                │
│  │   GPT-4          │                                │
│  │   (не знает      │                                │
│  │    твой курс)    │                                │
│  └──────┬───────────┘                                │
│         ↓                                             │
│  Общий ответ (не специфичный для курса) ❌           │
│                                                       │
└───────────────────────────────────────────────────────┘

┌───────────────────────────────────────────────────────┐
│                   С RAG                               │
├───────────────────────────────────────────────────────┤
│                                                       │
│  Вопрос студента                                      │
│  "Что такое Server Actions?"                          │
│         ↓                                             │
│  ┌─────────────────────────────────┐                │
│  │  1. RETRIEVAL (Поиск)           │                │
│  │  Ищет в векторной БД            │                │
│  │  релевантные части уроков       │                │
│  └──────┬──────────────────────────┘                │
│         ↓                                             │
│  Найдено: Урок 8.2, параграфы 3-5                    │
│         ↓                                             │
│  ┌─────────────────────────────────┐                │
│  │  2. AUGMENTED (Дополнение)      │                │
│  │  Добавляет найденный контент    │                │
│  │  к запросу                      │                │
│  └──────┬──────────────────────────┘                │
│         ↓                                             │
│  Промпт для GPT-4:                                    │
│  "Используя этот контент из курса:                    │
│   [Урок 8.2: Server Actions...]                       │
│   Ответь на вопрос: Что такое Server Actions?"        │
│         ↓                                             │
│  ┌─────────────────────────────────┐                │
│  │  3. GENERATION (Генерация)      │                │
│  │  GPT-4 создаёт ответ на основе  │                │
│  │  найденного контента            │                │
│  └──────┬──────────────────────────┘                │
│         ↓                                             │
│  Точный ответ из твоего курса! ✅                    │
│  + Ссылка на Урок 8.2                                │
│                                                       │
└───────────────────────────────────────────────────────┘
```

---

## 🏗️ Часть 3: Архитектура RAG системы

### Компоненты RAG системы

```
┌────────────────────────────────────────────────────┐
│            RAG СИСТЕМА АРХИТЕКТУРА                 │
├────────────────────────────────────────────────────┤
│                                                    │
│  1. ДОКУМЕНТЫ (твои уроки)                         │
│  ┌──────────────────────────────────────┐         │
│  │  Урок 1.1: Client-Server             │         │
│  │  Урок 1.2: HTTP протокол             │         │
│  │  Урок 8.2: Server Actions vs REST    │         │
│  │  ... 500+ уроков                     │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  2. CHUNKING (разбиение на части)                  │
│  ┌──────────────────────────────────────┐         │
│  │  Урок разбивается на чанки по 1000   │         │
│  │  символов с перекрытием 200          │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  3. EMBEDDINGS (векторизация)                      │
│  ┌──────────────────────────────────────┐         │
│  │  Каждый чанк → вектор [0.2, -0.5,   │         │
│  │  0.8, ...] (1536 измерений)          │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  4. VECTOR STORE (векторная БД)                    │
│  ┌──────────────────────────────────────┐         │
│  │  pgvector / Pinecone                 │         │
│  │  Хранит векторы + метаданные         │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  ═══════════════════════════════════════          │
│               ЗАПРОС СТУДЕНТА                      │
│  ═══════════════════════════════════════          │
│               ↓                                    │
│  5. QUERY EMBEDDING                                │
│  ┌──────────────────────────────────────┐         │
│  │  "Что такое Server Actions?"         │         │
│  │  → вектор [0.3, -0.4, 0.7, ...]      │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  6. SIMILARITY SEARCH                              │
│  ┌──────────────────────────────────────┐         │
│  │  Находит топ-3 самых похожих         │         │
│  │  чанка по косинусному расстоянию     │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  Найдено:                                          │
│  - Урок 8.2, чанк 3 (similarity: 0.92)            │
│  - Урок 8.1, чанк 7 (similarity: 0.87)            │
│  - Урок 8.0, чанк 2 (similarity: 0.83)            │
│               ↓                                    │
│  7. PROMPT CONSTRUCTION                            │
│  ┌──────────────────────────────────────┐         │
│  │  Создаёт промпт для LLM:             │         │
│  │                                      │         │
│  │  "Контекст из курса:                 │         │
│  │  [Урок 8.2: Server Actions — это...] │         │
│  │  [Урок 8.1: В Next.js...]            │         │
│  │                                      │         │
│  │  Вопрос студента:                    │         │
│  │  Что такое Server Actions?"          │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  8. LLM GENERATION                                 │
│  ┌──────────────────────────────────────┐         │
│  │  GPT-4 генерирует ответ на основе    │         │
│  │  найденного контекста                │         │
│  └────────────┬─────────────────────────┘         │
│               ↓                                    │
│  9. ОТВЕТ СТУДЕНТУ                                 │
│  ┌──────────────────────────────────────┐         │
│  │  "Server Actions — это функции в     │         │
│  │  Next.js которые выполняются на      │         │
│  │  сервере..."                         │         │
│  │                                      │         │
│  │  📚 Источники: Урок 8.2, Урок 8.1   │         │
│  └──────────────────────────────────────┘         │
│                                                    │
└────────────────────────────────────────────────────┘
```

### Ключевые технологии

**1. Embeddings (векторные представления)**
```
Текст "Server Actions" → Вектор [0.2, -0.5, 0.8, ...1536 чисел]

Похожий текст = похожие векторы
"Server Actions"  [0.2, -0.5, 0.8, ...]
"Next.js сервер"  [0.3, -0.4, 0.7, ...]  ← близко!

Разный текст = разные векторы
"Server Actions"  [0.2, -0.5, 0.8, ...]
"Котики мурлыкают" [-0.9, 0.1, -0.3, ...] ← далеко!
```

**2. Vector Database (векторная БД)**
```
Обычная БД:      SELECT * WHERE name = 'Server Actions'
Векторная БД:    SELECT * WHERE vector SIMILAR TO [0.2, -0.5, ...]
                                              ↑
                                   Косинусное расстояние
```

**3. LangChain (оркестрация)**
```
LangChain = фреймворк который связывает все компоненты:
- Document Loaders (загрузка уроков)
- Text Splitters (chunking)
- Embeddings (OpenAI)
- Vector Stores (Pinecone/pgvector)
- LLM (GPT-4)
- Chains (логика RAG)
```

---

## 🆚 Часть 4: RAG vs Fine-tuning

### Два способа научить AI твоему контенту

**1. Fine-tuning (дообучение модели)**
```
Берёшь GPT-4
      ↓
Дообучаешь на твоих уроках (500 уроков)
      ↓
Получаешь свою модель: GPT-4-ai-school
      ↓
Модель "знает" твой контент
```

**2. RAG (поиск + генерация)**
```
Берёшь GPT-4 (не меняешь модель)
      ↓
При каждом вопросе:
  1. Ищешь релевантные уроки
  2. Передаёшь их GPT-4 в контексте
      ↓
GPT-4 отвечает на основе найденного
```

### Сравнительная таблица

| **Аспект** | **Fine-tuning** | **RAG** |
|---|---|---|
| **Стоимость обучения** | $$$$ (~$1000+) | $ (~$50) |
| **Время обучения** | Часы/дни | Минуты |
| **Обновление контента** | Переобучить модель | Просто добавить в БД |
| **Прозрачность** | ❌ Чёрный ящик | ✅ Видны источники |
| **Точность** | ⚠️ Может галлюцинировать | ✅ Использует факты |
| **Latency** | Быстрее | Чуть медленнее |
| **Ссылки на источники** | ❌ Нет | ✅ Есть |
| **Для образования** | ❌ Не оптимально | ✅ Идеально |

### Когда использовать каждый подход

**Fine-tuning:**
```
✅ Нужен специфичный стиль ответов
✅ Контент не меняется
✅ Не нужны ссылки на источники
✅ Бюджет большой

Пример: Корпоративный чат-бот с фирменным стилем
```

**RAG:**
```
✅ Контент часто обновляется (новые уроки)
✅ Нужны ссылки на источники
✅ Важна точность фактов
✅ Ограниченный бюджет

Пример: Образовательная платформа (твой случай) ✅
```

---

## 💰 Часть 5: Стоимость RAG системы

### Одноразовые затраты (индексация контента)

**Embeddings для 500 уроков:**
```
500 уроков × 2000 слов × 1.3 (токены) = 1,300,000 токенов

OpenAI Embeddings: $0.0001 за 1K токенов
Стоимость: 1,300 × $0.0001 = $0.13

Итого: ~$1 (почти бесплатно!)
```

### Ежемесячные затраты (использование)

**Сценарий: 1000 студентов**
```
1000 студентов × 20 вопросов/месяц = 20,000 вопросов

Каждый вопрос:
- Query embedding: ~50 токенов (input)
- Контекст из уроков: ~1500 токенов (input)
- Ответ: ~500 токенов (output)

Input:  20,000 × 1,550 × $0.01/1K = $310/месяц
Output: 20,000 × 500 × $0.03/1K = $300/месяц

Итого: ~$610/месяц (GPT-4)
```

**Оптимизация: используй GPT-3.5-turbo**
```
Input:  $0.0005/1K (в 20 раз дешевле)
Output: $0.0015/1K (в 20 раз дешевле)

Итого: ~$30/месяц (GPT-3.5) ✅
```

### Векторная БД

**Варианты:**
1. **pgvector (PostgreSQL)** — бесплатно (уже используешь PostgreSQL)
2. **Pinecone** — $70/месяц (managed, удобнее)
3. **ChromaDB** — бесплатно (self-hosted)

**Рекомендация для старта:** pgvector (бесплатно)

---

## 🎯 Часть 6: Примеры использования RAG

### Пример 1: Вопрос студента

**Вопрос:**
```
"Я не понял разницу между Server Actions и REST API. 
Можешь объяснить проще?"
```

**Без RAG (обычный ChatGPT):**
```
"Server Actions и REST API — это два разных способа 
взаимодействия frontend и backend. Server Actions — это..."

(Общее объяснение, не специфичное для твоего курса)
```

**С RAG (твой AI помощник):**
```
"Отличный вопрос! В Уроке 8.2 мы разбирали именно это.

Server Actions (Next.js):
- Выглядят как обычный вызов функции
- Next.js автоматически делает HTTP под капотом
- Пример из урока: [код из Урока 8.2]

REST API (FastAPI):
- Явный HTTP запрос через fetch()
- Полный контроль над процессом
- Пример из урока: [код из Урока 8.2]

Главное отличие: Server Actions — это "магия" Next.js,
REST API — явный протокол.

📚 Источники: Урок 8.2 (Server Actions vs REST API)"
```

**Преимущества RAG:**
- ✅ Ссылается на конкретный урок
- ✅ Использует примеры из курса
- ✅ Даёт ссылку для углублённого изучения

---

### Пример 2: Помощь с упражнением

**Вопрос:**
```
"Я застрял на упражнении 2.3. Как создать FastAPI endpoint?"
```

**С RAG:**
```
"Понимаю! В упражнении 2.3 нужно создать endpoint для 
получения списка кулачков.

Вот шаблон из Урока 2.3:

[код примера из урока]

Шаги:
1. Импортируй FastAPI
2. Создай router
3. Определи endpoint с @router.get()

Попробуй, если не получится — покажи свой код, помогу!

📚 Источник: Урок 2.3 (FastAPI Endpoints)"
```

---

### Пример 3: Концептуальный вопрос

**Вопрос:**
```
"Когда лучше использовать Next.js, а когда FastAPI + React?"
```

**С RAG:**
```
"Отличный вопрос! Мы разбирали это в Модуле 8.

Next.js Full-Stack (Урок 8.1):
- Один язык (JavaScript)
- SSR для SEO
- Подходит для: блоги, e-commerce

FastAPI + React (твой выбор для EngineCamPro):
- Python для математики (NumPy, SciPy)
- REST API стандарт
- Подходит для: научные расчёты, ML/AI

Для твоего проекта (EngineCamPro) мы выбрали FastAPI + React
потому что нужна математика и REST API для MATLAB интеграции.

📚 Источники: 
- Урок 8.0 (Python vs JavaScript)
- Урок 8.1 (Монолит vs Разделённая архитектура)
- Анализ ANALYSIS-COURSE-VS-NEXTJS.md"
```

---

## 🎓 Резюме урока

### Что такое RAG

**Простыми словами:**
```
RAG = умный поиск по твоим документам + AI который отвечает
на основе найденного
```

**Формально:**
```
RAG = Retrieval (поиск) + Augmented (дополнение) + 
Generation (генерация ответа)
```

### Зачем нужен RAG

**Проблема:**
- LLM не знают твой контент
- Галлюцинации (выдумывают факты)
- Нет ссылок на источники

**Решение (RAG):**
- Находит релевантные части документов
- Передаёт их LLM в контексте
- LLM отвечает на основе фактов
- Можешь показать источники

### Архитектура RAG

```
Документы → Chunking → Embeddings → Vector DB
                                        ↓
Вопрос → Query Embedding → Similarity Search → Топ-K чанков
                                        ↓
Промпт с контекстом → LLM → Ответ + Источники
```

### RAG vs Fine-tuning

| **RAG** | **Fine-tuning** |
|---|---|
| Дешевле | Дороже |
| Быстрее настроить | Долго обучать |
| Легко обновлять | Переобучать модель |
| Ссылки на источники | Нет ссылок |
| **Для образования ✅** | Для корпораций |

### Для твоего проекта

**Интерактивная школа (500-600 уроков):**
- ✅ RAG идеально подходит
- ✅ Студенты получат точные ответы
- ✅ Ссылки на конкретные уроки
- ✅ Легко добавлять новые уроки
- ✅ Доступная стоимость (~$30-50/мес)

---

## 📝 Проверка понимания

1. **Что такое RAG?**
   - Ответ: Retrieval (поиск) + Augmented (дополнение) + Generation (генерация)

2. **Почему ChatGPT не знает твой курс?**
   - Ответ: Обучен до 2023, твой контент приватный, не видел эти данные

3. **Как RAG решает эту проблему?**
   - Ответ: Находит релевантные части уроков и передаёт их LLM в контексте

4. **Когда использовать RAG вместо Fine-tuning?**
   - Ответ: Контент часто меняется, нужны ссылки, ограниченный бюджет

5. **Сколько стоит RAG для 1000 студентов?**
   - Ответ: ~$30-50/мес с GPT-3.5-turbo, ~$600/мес с GPT-4

---

## 🚀 Следующий шаг

В **Уроке 9.1** мы изучим:
- **Embeddings** — как превратить текст в векторы
- **Semantic Search** — как искать по смыслу, а не по словам
- **Vector Databases** — pgvector, Pinecone, ChromaDB
- **Создание векторной БД** для твоих уроков

**Готов погрузиться в векторные пространства?** 🎯

---

**Конец урока 9.0** ✅
