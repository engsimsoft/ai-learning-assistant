# Урок 1.1: Client-Server архитектура

> **Модуль 1:** Основы веб-архитектуры  
> **Урок:** 1.1  
> **Длительность:** 60-90 минут  
> **Prerequisite:** Нет (первый урок)

---

## 🎯 Цели урока

После этого урока ты сможешь:
- ✅ Понимать разницу между монолитом и Client-Server архитектурой
- ✅ Объяснить что происходит когда открываешь сайт
- ✅ Понять почему EngineCamPro на Streamlit - это монолит
- ✅ Спроектировать архитектуру EngineCamPro v2

---

## 📖 Концепция: Что такое Client-Server?

### Простое определение

**Client (Клиент)** - программа, которая **запрашивает** данные или услуги  
**Server (Сервер)** - программа, которая **предоставляет** данные или услуги

**Важно:** Это про **роли в диалоге**, а не про компьютеры!

### 🏪 Аналогия: Ресторан

Представь ресторан:

```
┌─────────────────────────────────────────────────────────┐
│                      РЕСТОРАН                           │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  👤 ПОСЕТИТЕЛЬ (Client)         🍳 КУХНЯ (Server)       │
│                                                         │
│  • Сидит в зале                 • Готовит блюда        │
│  • Смотрит меню                 • Хранит продукты      │
│  • Делает заказ                 • Обрабатывает заказы  │
│  • Получает блюдо               • Отдаёт готовое       │
│  • Ест и платит                 • Ведёт учёт           │
│                                                         │
│  ┌─────────────┐                ┌─────────────┐         │
│  │   Меню      │                │   Рецепты   │         │
│  │  (что можно │                │(как готовить│         │
│  │   заказать) │                │   блюда)    │         │
│  └─────────────┘                └─────────────┘         │
│         │                              │                │
│         │        📝 ЗАКАЗ              │                │
│         └──────────────►───────────────┘                │
│                                        │                │
│                        🍕 БЛЮДО        │                │
│         ┌──────────────◄───────────────┘                │
│         │                                               │
│         ▼                                               │
│    😋 Кушаю                                             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**Ключевые моменты аналогии:**

1. **Посетитель не видит кухню** - не знает как готовится блюдо
2. **Меню - это интерфейс** - посетитель знает только что может заказать
3. **Кухня - это бизнес-логика** - там происходит вся работа
4. **Заказ - это запрос** - посетитель просит что-то
5. **Блюдо - это ответ** - кухня отдаёт результат

---

## 🌐 Как это работает в веб-приложении

### Схема взаимодействия

```
┌──────────────────────────────────────────────────────────┐
│                    ВЕБ-ПРИЛОЖЕНИЕ                        │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  💻 FRONTEND (Client)          🖥️ BACKEND (Server)       │
│                                                          │
│  Браузер пользователя          Удалённый компьютер      │
│                                                          │
│  • HTML страницы               • Бизнес-логика          │
│  • CSS стили                   • Работа с БД            │
│  • JavaScript код              • Расчёты                │
│  • Формы ввода                 • Обработка данных       │
│  • Кнопки                      • Аутентификация         │
│  • Графики                     • API endpoints          │
│                                                          │
│         │                             │                 │
│         │    1. HTTP REQUEST          │                 │
│         │    (запрос данных)          │                 │
│         └─────────────►───────────────┘                 │
│                                       │                 │
│                                  2. Обработка           │
│                                     - SQL запрос        │
│                                     - Расчёты           │
│                                     - Бизнес-логика     │
│                                       │                 │
│         ┌─────────────◄───────────────┘                 │
│         │    3. HTTP RESPONSE                           │
│         │    (JSON с данными)                           │
│         │                                               │
│         ▼                                               │
│   4. Отображение                                        │
│      - Рендер таблиц                                    │
│      - Построение графиков                              │
│      - Обновление UI                                    │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

### Что происходит когда открываешь сайт?

**Шаг 1:** Вводишь адрес `enginecampro.com` в браузере

**Шаг 2:** Браузер (клиент) отправляет запрос на сервер:
```
GET https://enginecampro.com
```

**Шаг 3:** Сервер отправляет HTML, CSS, JavaScript файлы

**Шаг 4:** Браузер рендерит страницу (ты видишь интерфейс)

**Шаг 5:** Нажимаешь кнопку "Рассчитать профиль"

**Шаг 6:** JavaScript отправляет запрос на сервер:
```
POST https://enginecampro.com/api/calculate
Body: { "lift": 11.5, "duration": 280 }
```

**Шаг 7:** Сервер:
- Получает параметры
- Делает расчёты (математика кулачков)
- Возвращает результат

**Шаг 8:** JavaScript получает ответ:
```json
{
  "profile": [...точки профиля...],
  "max_velocity": 0.0234
}
```

**Шаг 9:** JavaScript строит график на странице

---

## 🔍 Streamlit vs Client-Server

### EngineCamPro сейчас (Streamlit) - МОНОЛИТ

```
┌────────────────────────────────────────────────────┐
│           ВСЁ В ОДНОМ ПРОЦЕССЕ                     │
│                                                    │
│  📦 Streamlit приложение                           │
│  ├── UI (интерфейс)                                │
│  ├── Бизнес-логика (core/)                         │
│  ├── Математика (расчёты)                          │
│  ├── База данных (SQLite)                          │
│  └── Сервер (встроенный)                           │
│                                                    │
│  Всё работает на ОДНОМ компьютере/процессе        │
│                                                    │
└────────────────────────────────────────────────────┘
        │
        ▼
   Пользователь подключается к этому процессу
```

**Проблемы монолита:**

❌ **Нет разделения ответственности**
- UI смешан с бизнес-логикой
- Сложно менять одно без влияния на другое

❌ **Нельзя использовать из других приложений**
- Хочешь мобильное приложение? Придётся всё переписывать
- Нет API для интеграций

❌ **Сложно монетизировать**
- Streamlit не поддерживает аутентификацию из коробки
- Нет системы подписок
- Все видят всё

❌ **Плохая масштабируемость**
- Streamlit перезагружает всё при каждом действии
- Один процесс для всех пользователей
- При росте нагрузки - проблемы

---

### EngineCamPro v2 (Client-Server) - ПРАВИЛЬНАЯ АРХИТЕКТУРА

```
┌───────────────────────┐         ┌───────────────────────┐
│    FRONTEND           │         │      BACKEND          │
│    (Next.js)          │         │      (FastAPI)        │
│                       │         │                       │
│  В БРАУЗЕРЕ           │  HTTP   │  НА СЕРВЕРЕ           │
│  ПОЛЬЗОВАТЕЛЯ         │  API    │  (Railway)            │
│                       │         │                       │
│  • Интерфейс          │◄───────►│  • Бизнес-логика      │
│  • Формы ввода        │  JSON   │  • Математика (core/) │
│  • Графики            │         │  • Аутентификация     │
│  • Визуализация       │         │  • API endpoints      │
│  • React компоненты   │         │  • Валидация данных   │
│                       │         │                       │
│  (Vercel)             │         │  (Railway)            │
└───────────────────────┘         └───────────────────────┘
                                            │
                                            │ SQL
                                            ▼
                                  ┌───────────────────────┐
                                  │     DATABASE          │
                                  │    (Supabase)         │
                                  │                       │
                                  │  • Проекты            │
                                  │  • Кулачки            │
                                  │  • Пользователи       │
                                  │  • Результаты         │
                                  │                       │
                                  └───────────────────────┘
```

**Преимущества Client-Server:**

✅ **Чёткое разделение ответственности**
- Frontend - только UI/UX
- Backend - только бизнес-логика
- База данных - только хранение

✅ **API для всех платформ**
- Можешь создать мобильное приложение
- Можешь интегрироваться с другими сервисами
- Можешь дать доступ к API партнёрам

✅ **Монетизация из коробки**
- Clerk для аутентификации
- Stripe для подписок
- Разные тарифы для разных пользователей

✅ **Масштабируемость**
- Frontend на CDN (быстро по всему миру)
- Backend масштабируется независимо
- База данных оптимизирована для нагрузки

---

## 🔗 Применение к EngineCamPro

### Текущий Streamlit (монолит)

**Что происходит когда пользователь открывает приложение:**

```python
# main.py (Streamlit)
import streamlit as st
from core import calculate_profile  # Математика здесь же!

# UI и бизнес-логика вместе ❌
st.title("EngineCamPro")
lift = st.number_input("Lift")
duration = st.number_input("Duration")

if st.button("Calculate"):
    # Расчёт прямо здесь ❌
    profile = calculate_profile(lift, duration)
    st.line_chart(profile)
```

**Проблема:** Всё в одном файле. UI, математика, отображение - всё смешано.

---

### Будущий Client-Server (EngineCamPro v2)

**Backend (FastAPI):**
```python
# backend/main.py
from fastapi import FastAPI

app = FastAPI()

@app.post("/api/calculate")
async def calculate(data: CamInput):
    # Только бизнес-логика ✅
    profile = calculate_profile(data.lift, data.duration)
    return {"profile": profile}
```

**Frontend (Next.js):**
```javascript
// frontend/components/CamCalculator.jsx
function CamCalculator() {
  // Только UI ✅
  const handleCalculate = async () => {
    const response = await fetch('/api/calculate', {
      method: 'POST',
      body: JSON.stringify({ lift, duration })
    })
    const data = await response.json()
    setProfile(data.profile)
  }
  
  return <form>...</form>
}
```

**Преимущества:**
- ✅ Чистое разделение
- ✅ Backend можно использовать из мобильного приложения
- ✅ Frontend можно менять без касания Backend
- ✅ Можно добавить систему подписок

---

## 🎯 Ключевые термины

### Client (Клиент)
**Что:** Программа, которая **запрашивает** услуги  
**Где:** Обычно в браузере пользователя  
**Пример:** React приложение, мобильное приложение  
**В EngineCamPro:** Next.js приложение с формами и графиками

### Server (Сервер)
**Что:** Программа, которая **предоставляет** услуги  
**Где:** На удалённом компьютере (хостинг)  
**Пример:** FastAPI, Django, Node.js  
**В EngineCamPro:** FastAPI с математическим ядром

### HTTP (HyperText Transfer Protocol)
**Что:** "Язык общения" между клиентом и сервером  
**Зачем:** Стандартный способ передачи данных в интернете  
**Пример:** GET запрос на получение данных, POST для отправки

### API (Application Programming Interface)
**Что:** Набор "правил общения" - что можно запросить и что получишь  
**Зачем:** Позволяет программам общаться друг с другом  
**Пример:** `/api/calculate` - адрес для расчёта профиля

### JSON (JavaScript Object Notation)
**Что:** Формат для передачи структурированных данных  
**Зачем:** Удобно для программ (не для человека читать)  
**Пример:** `{"lift": 11.5, "duration": 280}`

---

## 🛠️ Практическое задание

### Задача
Создать **простейший FastAPI сервер** с одним endpoint, который возвращает информацию о EngineCamPro API.

### Цель задания
- Понять как работает Backend сервер
- Увидеть что такое endpoint
- Попробовать обратиться к API

### Что нужно создать

**Структура:**
```
practice-client-server/
├── main.py          # FastAPI приложение
└── requirements.txt # Зависимости
```

**main.py должен:**
1. Импортировать FastAPI
2. Создать экземпляр приложения
3. Иметь один GET endpoint `/api/info`
4. Возвращать JSON с информацией:
   - name: "EngineCamPro API"
   - version: "2.0"
   - description: "REST API for cam profile calculations"

**requirements.txt должен содержать:**
```
fastapi
uvicorn
```

---

## 🤖 Промпт для Claude Code

Скопируй этот промпт и отправь Claude Code в Cursor:

```
Создай простейший FastAPI сервер для изучения Client-Server архитектуры.

СТРУКТУРА ПРОЕКТА:
practice-client-server/
├── main.py
└── requirements.txt

ТРЕБОВАНИЯ К main.py:
1. Импортируй FastAPI
2. Создай экземпляр приложения app = FastAPI()
3. Создай GET endpoint `/api/info` который возвращает JSON:
   {
     "name": "EngineCamPro API",
     "version": "2.0",
     "description": "REST API for cam profile calculations"
   }

ТРЕБОВАНИЯ К requirements.txt:
fastapi
uvicorn

ДОПОЛНИТЕЛЬНО:
- Добавь комментарии в коде объясняющие что делает каждая строка
- Добавь инструкцию как запустить сервер в комментарии

Цель: понять базовую структуру Backend сервера.
```

---

## 🧪 Тестирование

### Запуск сервера

```bash
# Установи зависимости
pip install -r requirements.txt

# Запусти сервер
uvicorn main:app --reload
```

Увидишь:
```
INFO:     Uvicorn running on http://127.0.0.1:8000
```

### Проверка работы

**Вариант 1: Браузер**
Открой в браузере: `http://127.0.0.1:8000/api/info`

Должен увидеть JSON:
```json
{
  "name": "EngineCamPro API",
  "version": "2.0",
  "description": "REST API for cam profile calculations"
}
```

**Вариант 2: Терминал**
```bash
curl http://127.0.0.1:8000/api/info
```

**Вариант 3: Автодокументация**
Открой в браузере: `http://127.0.0.1:8000/docs`

Увидишь Swagger UI - автоматическую документацию API!

---

## ✅ Критерии завершения урока

Отметь когда выполнено:

- [ ] **Понимание концепции**
  - Могу объяснить своими словами что такое Client-Server
  - Понимаю разницу между монолитом (Streamlit) и Client-Server
  - Понимаю зачем нужно разделять Frontend и Backend

- [ ] **Практическое задание**
  - Создан FastAPI сервер через Claude Code
  - Сервер запускается без ошибок
  - Endpoint `/api/info` возвращает правильный JSON
  - Проверил через браузер или curl

- [ ] **Документирование**
  - Записал промпт который использовал в `prompts/lesson-01.md`
  - Записал своё понимание в `notes/insights.md`
  - Если были проблемы - записал в `notes/problems.md`

- [ ] **Связь с проектом**
  - Понимаю как будет устроен EngineCamPro v2
  - Могу нарисовать схему архитектуры

---

## 📝 Вопросы для самопроверки

Ответь на эти вопросы (устно или письменно):

1. **Что такое Client-Server архитектура?**
   - Что делает клиент?
   - Что делает сервер?
   - Как они общаются?

2. **В чём разница между Streamlit (монолит) и Client-Server?**
   - Где работает код в монолите?
   - Где работает код в Client-Server?
   - Какие преимущества даёт разделение?

3. **Что происходит когда я открываю сайт?**
   - Какой запрос отправляется?
   - Что получает браузер?
   - Когда нужны дополнительные запросы?

4. **Для EngineCamPro v2:**
   - Что будет делать Frontend?
   - Что будет делать Backend?
   - Зачем нужна отдельная база данных?

5. **Что такое API и endpoint?**
   - Что такое endpoint?
   - Зачем нужен API?
   - Что означает `/api/info`?

---

## 🔗 Связь с другими уроками

**Следующий урок:** 1.2 HTTP протокол основы
- Узнаешь про HTTP методы (GET, POST, PUT, DELETE)
- Поймёшь что такое HTTP статус коды (200, 404, 500)
- Научишься правильно проектировать API запросы

**Подготовка к проекту:**
Этот урок закладывает фундамент для понимания архитектуры EngineCamPro v2:
- Backend: FastAPI (изучаешь в Модуле 2)
- Frontend: Next.js (изучаешь в Модуле 4)
- Интеграция: HTTP/JSON (изучаешь в Модуле 5)

---

## 📚 Дополнительные материалы (опционально)

**Если хочешь углубиться:**

- [REST API Tutorial](https://restfulapi.net/) - подробно про REST
- [FastAPI документация](https://fastapi.tiangolo.com/) - официальная документация
- [Что такое API - видео](https://www.youtube.com/watch?v=s7wmiS2mSXY) - визуальное объяснение

**НО!** Это не обязательно. Главное - понять концепцию из этого урока.

---

## 💡 Итоговые выводы

**Что я понял из этого урока:**

1. **Client-Server** - это про разделение ролей:
   - Client запрашивает
   - Server отвечает
   - Общаются по HTTP через JSON

2. **Монолит vs Client-Server**:
   - Streamlit - всё в одном (монолит)
   - EngineCamPro v2 - разделённая архитектура
   - Разделение даёт гибкость и масштабируемость

3. **FastAPI** - это Backend фреймворк:
   - Создаёт API endpoints
   - Обрабатывает запросы
   - Возвращает JSON ответы

4. **Для моего проекта**:
   - Backend будет хранить математику (core/)
   - Frontend будет красивый интерфейс
   - Общение через HTTP API

---

**Статус урока:** ⏳ Не начат / 🔄 В процессе / ✅ Завершён  
**Дата начала:** _________  
**Дата завершения:** _________  
**Время изучения:** _________ минут

---

*Версия урока: 1.0*  
*Дата создания: 10 октября 2025*
