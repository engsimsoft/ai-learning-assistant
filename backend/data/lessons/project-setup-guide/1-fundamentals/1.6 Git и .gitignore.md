# 1.6 Git и .gitignore

#### 🎯 Зачем это нужно

**Проблема без Git:**
- Потерял код после неудачного изменения
- Не можешь вернуться к рабочей версии
- Секретные API ключи случайно залил в публичный GitHub
- `venv/` папка с тысячами файлов попала в репозиторий
- Не понимаешь что изменилось между версиями

**Git даёт:**
- ✅ История всех изменений (time machine для кода)
- ✅ Откат к любой рабочей версии
- ✅ Резервное копирование на GitHub
- ✅ Совместная работа (если нужна в будущем)
- ✅ Защита от случайной заливки секретов

**`.gitignore` защищает от:**
- ❌ Секреты не попадут в Git (.env файлы)
- ❌ Тысячи временных файлов не замусорят репозиторий
- ❌ Зависимости не будут в Git (venv/, node_modules/)
- ❌ IDE файлы не будут конфликтовать

---

#### 🏪 Аналогия

**Git - это как Google Docs с версиями:**
- Каждое сохранение (commit) - это snapshot проекта
- Можешь посмотреть "Version History" и вернуться назад
- Комментарий к версии (commit message) объясняет что изменил

**.gitignore - это как "не бэкапить" для файлов:**
- Указываешь файлы/папки которые не нужно отслеживать
- Как сказать Google Drive: "эти временные файлы не синхронизируй"

---

#### 📐 Жизненный цикл файлов в Git

```
┌─────────────────────────────────────────────────────────┐
│                    WORKING DIRECTORY                     │
│                   (твои файлы на диске)                  │
│                                                          │
│  app/                                                    │
│  ├── main.py        ← изменяешь код здесь               │
│  └── config.py                                          │
│  .env               ← НЕ должен попасть в Git!          │
│  venv/              ← НЕ должна попасть в Git!          │
│                                                          │
└─────────────────────────────────────────────────────────┘
                            ↓
                    git add app/main.py
                            ↓
┌─────────────────────────────────────────────────────────┐
│                    STAGING AREA                          │
│              (файлы готовые к commit)                    │
│                                                          │
│  ✓ app/main.py      ← подготовлен к сохранению         │
│                                                          │
└─────────────────────────────────────────────────────────┘
                            ↓
              git commit -m "Add main endpoint"
                            ↓
┌─────────────────────────────────────────────────────────┐
│                    REPOSITORY                            │
│                  (история commits)                       │
│                                                          │
│  Commit #3: "Add main endpoint" ← текущая версия        │
│  Commit #2: "Setup project structure"                   │
│  Commit #1: "Initial commit"                            │
│                                                          │
└─────────────────────────────────────────────────────────┘
                            ↓
                      git push origin main
                            ↓
┌─────────────────────────────────────────────────────────┐
│                    GITHUB / REMOTE                       │
│                  (облачное хранилище)                    │
│                                                          │
│  Твой код в безопасности, доступен с любого устройства  │
│                                                          │
└─────────────────────────────────────────────────────────┘

                    .gitignore БЛОКИРУЕТ:
                    
    .env ─────────────────X───────────→ НЕ попадёт в Git
    venv/ ────────────────X───────────→ НЕ попадёт в Git
    __pycache__/ ─────────X───────────→ НЕ попадёт в Git
    node_modules/ ────────X───────────→ НЕ попадёт в Git
    .DS_Store ────────────X───────────→ НЕ попадёт в Git
```

---

#### 💡 Как это работает

**Инициализация Git:**
```bash
# В корне проекта
git init

# Создаётся скрытая папка .git/
# Там хранится вся история изменений
```

**Первый коммит (snapshot проекта):**
```bash
# 1. Добавить файлы в staging
git add .

# 2. Создать commit (сохранить snapshot)
git commit -m "Initial commit: project structure"

# 3. (Опционально) Залить на GitHub
git remote add origin https://github.com/username/repo.git
git push -u origin main
```

**Работа с изменениями:**
```bash
# Посмотреть что изменилось
git status

# Добавить конкретные файлы
git add app/main.py app/config.py

# Или добавить всё
git add .

# Сделать commit
git commit -m "Add FastAPI endpoints"

# Залить на GitHub
git push
```

---

#### ✅ Best Practices: Что ВСЕГДА добавлять в .gitignore

**Для Python проектов (FastAPI):**
```gitignore
# Virtual Environment (КРИТИЧНО!)
venv/
env/
ENV/
.venv/

# Секреты (КРИТИЧНО!)
.env
.env.local
*.env

# Python кэш (временные файлы)
__pycache__/
*.py[cod]
*$py.class
*.so

# База данных (локальная)
*.db
*.sqlite3
*.sqlite

# IDE файлы
.vscode/
.idea/
*.swp
*.swo
.DS_Store

# Логи
*.log
logs/

# Pytest кэш
.pytest_cache/
.coverage
htmlcov/
```

**Для Node.js проектов (React/Next.js):**
```gitignore
# Dependencies (КРИТИЧНО!)
node_modules/

# Секреты (КРИТИЧНО!)
.env
.env.local
.env*.local

# Build файлы
.next/
out/
build/
dist/

# IDE файлы
.vscode/
.idea/
.DS_Store

# Логи
npm-debug.log*
yarn-debug.log*
yarn-error.log*
```

**Почему это критично:**

- **venv/, node_modules/** - тысячи файлов, занимают много места, легко восстановить из requirements.txt / package.json
- **.env** - API ключи, пароли БД, секреты → НИКОГДА в Git!
- **__pycache__, .pytest_cache** - временные файлы, автоматически создаются
- **.db, *.sqlite** - локальная БД для разработки, у каждого своя

---

#### 📋 Структура коммитов (как правильно)

**Принцип:** Один commit = одна логическая единица работы

**✅ Хорошие commit messages:**
```bash
git commit -m "Add user authentication endpoint"
git commit -m "Fix: validation error in cam calculation"
git commit -m "Refactor: extract database logic to service layer"
git commit -m "Update: dependencies for security patch"
git commit -m "Docs: add API usage examples to README"
```

**❌ Плохие commit messages:**
```bash
git commit -m "fix"
git commit -m "updates"
git commit -m "stuff"
git commit -m "asdasd"
git commit -m "work in progress"
```

**Формат хорошего commit message:**
```
<тип>: <краткое описание что сделано>

Примеры типов:
- Add: новая функциональность
- Fix: исправление бага
- Refactor: изменение структуры кода
- Update: обновление зависимостей
- Docs: документация
- Test: добавление тестов
- Style: форматирование кода
```

**Частота коммитов:**
- ✅ После завершения логической части работы (endpoint готов, бага исправлен)
- ✅ Перед переключением на другую задачу
- ✅ Перед экспериментами (чтобы было куда откатиться)
- ❌ Не делать commit "на всякий случай" каждые 5 минут

---

#### 🔄 Roadmap и Git

**Связь Roadmap с commits:**

Roadmap говорит ЧТО делать:
```markdown
- [ ] Create CRUD endpoints for cams
- [ ] Add validation for input data
- [ ] Setup CORS middleware
```

Git сохраняет РЕЗУЛЬТАТ:
```bash
git commit -m "Add: CRUD endpoints for cams"
# Roadmap: - [X] Create CRUD endpoints for cams

git commit -m "Add: Pydantic validation for cam parameters"
# Roadmap: - [X] Add validation for input data

git commit -m "Add: CORS middleware for React frontend"
# Roadmap: - [X] Setup CORS middleware
```

**Workflow:**
1. Смотришь roadmap.md → выбираешь задачу
2. Работаешь над задачей
3. Делаешь commit с описанием что сделано
4. Обновляешь roadmap (отмечаешь [X])
5. Push на GitHub

---

#### 🤖 Диалог с Claude Code

**❌ Плохой диалог:**
```
Ты: Настрой Git

Claude Code: [создаёт только git init]
```

**Проблемы:**
- Нет .gitignore → секреты попадут в Git
- Нет первого коммита
- Не понятно что игнорировать

---

**✅ Хороший диалог (Python проект):**
```
Ты: Настрой Git для FastAPI проекта.

Создай .gitignore со следующими правилами:

КРИТИЧНЫЕ (ОБЯЗАТЕЛЬНО):
- venv/ (виртуальное окружение - тысячи файлов)
  ЗАЧЕМ: не замусоривать репозиторий, легко восстановить из requirements.txt
  
- .env (секреты: API ключи, пароли)
  ЗАЧЕМ: защита от утечки секретов в публичный GitHub
  
- *.db, *.sqlite (локальная БД)
  ЗАЧЕМ: у каждого разработчика своя БД для тестов

ВРЕМЕННЫЕ ФАЙЛЫ:
- __pycache__/ (Python кэш)
- .pytest_cache/ (pytest временные)
- *.log (логи)
  ЗАЧЕМ: автоматически создаются, засоряют Git

IDE ФАЙЛЫ:
- .vscode/ (настройки VS Code)
- .idea/ (настройки PyCharm)
- .DS_Store (macOS мусор)
  ЗАЧЕМ: у каждого свои настройки IDE

После создания .gitignore:
- git init
- git add .
- git commit -m "Initial commit: project structure with FastAPI"

Создай также .env.example с шаблоном переменных (без реальных значений).

Claude Code: [создаёт .gitignore, делает git init, первый commit, создаёт .env.example]
```

**Почему хороший:**
- Детальный .gitignore с объяснениями
- Понятно ЗАЧЕМ каждая строка
- Первый commit сразу
- .env.example как шаблон

---

**✅ Хороший диалог (Node.js проект):**
```
Ты: Настрой Git для React проекта (Vite).

Создай .gitignore со следующими правилами:

КРИТИЧНЫЕ (ОБЯЗАТЕЛЬНО):
- node_modules/ (зависимости - десятки тысяч файлов)
  ЗАЧЕМ: не замусоривать репозиторий, легко восстановить через npm install
  
- .env, .env.local (секреты: API ключи)
  ЗАЧЕМ: защита от утечки секретов
  
- dist/, build/ (скомпилированный код)
  ЗАЧЕМ: автоматически создаётся при сборке

ВРЕМЕННЫЕ ФАЙЛЫ:
- .vite/ (Vite кэш)
- *.log (логи)
  ЗАЧЕМ: временные файлы, не нужны в Git

IDE ФАЙЛЫ:
- .vscode/
- .idea/
- .DS_Store

После создания .gitignore:
- git init
- git add .
- git commit -m "Initial commit: React + Vite project structure"

Создай также .env.example с VITE_ переменными (шаблон).

Claude Code: [создаёт .gitignore, git init, первый commit, .env.example]
```

---

#### ⚠️ Что делать если случайно залил секреты в Git

**Если только что сделал commit (НЕ push):**
```bash
# Отменить последний commit (файлы вернутся в working directory)
git reset HEAD~1

# Добавить .env в .gitignore
echo ".env" >> .gitignore

# Сделать commit заново (теперь без .env)
git add .
git commit -m "Initial commit: project structure"
```

**Если уже сделал push на GitHub:**
1. ❌ **НЕ достаточно:** просто удалить файл и закоммитить
   - Секреты остались в истории Git!
   
2. ✅ **Правильно:** СРАЗУ сменить все секреты
   - Новый API ключ
   - Новый пароль БД
   - Все секреты из .env

3. ✅ Удалить из истории Git (advanced):
   ```bash
   git filter-branch --force --index-filter \
     "git rm --cached --ignore-unmatch .env" \
     --prune-empty --tag-name-filter cat -- --all
   
   git push --force
   ```

**Важно:** GitHub сканирует все commits на наличие секретов. Если найдёт API ключ - пришлёт уведомление.

---

#### ✅ Чек-лист: Git настроен правильно

**Инициализация:**
- [ ] `git init` выполнен в корне проекта
- [ ] `.git/` папка создана (скрытая)

**.gitignore настроен:**
- [ ] venv/ или node_modules/ добавлены
- [ ] .env добавлен
- [ ] Временные файлы добавлены (__pycache__, *.log)
- [ ] IDE файлы добавлены (.vscode/, .idea/)
- [ ] Локальная БД добавлена (*.db, *.sqlite)

**Первый commit сделан:**
- [ ] `git status` показывает только нужные файлы
- [ ] .env НЕ в списке файлов для commit
- [ ] venv/ НЕ в списке файлов для commit
- [ ] Commit message осмысленный ("Initial commit: project structure")

**Безопасность:**
- [ ] .env.example создан (шаблон без реальных значений)
- [ ] README.md упоминает как настроить .env
- [ ] Нет секретов в коде (только в .env)

**GitHub (опционально):**
- [ ] Репозиторий создан на GitHub
- [ ] `git remote add origin` выполнен
- [ ] `git push` выполнен успешно
- [ ] На GitHub видны все файлы КРОМЕ .env, venv/, node_modules/

**Проверка:**
```bash
# Посмотри что в Git
git status

# Должно быть "nothing to commit, working tree clean"
# Если видишь .env или venv/ → добавь в .gitignore

# Посмотри историю
git log --oneline

# Должны видеть все commits с понятными сообщениями
```

---

#### 🎯 Когда делать commits в процессе работы

**Хороший ритм:**

1. **Начало дня:** 
   ```bash
   git pull  # получить последние изменения
   ```

2. **Работа над задачей из roadmap:**
   - Реализовал endpoint → commit
   - Исправил бага → commit
   - Добавил тесты → commit

3. **Конец дня:**
   ```bash
   git push  # залить на GitHub (резервная копия)
   ```

**Примерный workflow:**
```bash
# Утро: смотришь roadmap.md
# Задача: "Create CRUD endpoints for cams"

# Работаешь...
# Endpoint готов, тесты прошли

git add app/routers/cams.py app/services/cam_service.py
git commit -m "Add: CRUD endpoints for cam calculations"
git push

# Обновляешь roadmap.md:
# - [X] Create CRUD endpoints for cams

# Следующая задача...
```

---

**Следующий раздел:** 1.7 Документация: правильная организация