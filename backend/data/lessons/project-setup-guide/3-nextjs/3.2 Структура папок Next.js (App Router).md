# 3.2 Структура папок Next.js (App Router)

#### 🎯 Зачем нужна правильная структура

**Проблема плоской структуры:**
- Все страницы вперемешку с компонентами
- API routes разбросаны
- Непонятно где искать код
- ИИ путается

**Правильная структура даёт:**
- ✅ File-based routing (папка = route)
- ✅ Colocation (компоненты рядом со страницами)
- ✅ API routes организованы
- ✅ Легко масштабировать

---

#### 📐 Структура Next.js проекта (App Router)

```
my-nextjs-app/
│
├── public/                       # 🌐 СТАТИЧНЫЕ ФАЙЛЫ
│   ├── images/                  • Картинки, иконки
│   ├── favicon.ico              • Доступны по /filename
│   └── robots.txt               ЗАЧЕМ: SEO, статика
│
├── src/                          # 📦 ИСХОДНИКИ
│   │
│   ├── app/                      # 🚀 APP ROUTER
│   │   │
│   │   ├── layout.tsx            • Root layout (общий для всех)
│   │   │                          ЗАЧЕМ: Navbar, Footer, fonts
│   │   │
│   │   ├── page.tsx              • Главная страница (/)
│   │   │                          ЗАЧЕМ: route /
│   │   │
│   │   ├── globals.css           • Глобальные стили
│   │   │                          ЗАЧЕМ: Tailwind, CSS reset
│   │   │
│   │   ├── about/                • /about route
│   │   │   └── page.tsx          ЗАЧЕМ: страница /about
│   │   │
│   │   ├── blog/                 • /blog routes
│   │   │   ├── page.tsx          • /blog (список)
│   │   │   └── [slug]/           • /blog/post-1 (динамический)
│   │   │       └── page.tsx      ЗАЧЕМ: параметры в URL
│   │   │
│   │   └── api/                  • 🔌 API ROUTES
│   │       ├── hello/
│   │       │   └── route.ts      • GET /api/hello
│   │       └── posts/
│   │           └── route.ts      • /api/posts endpoints
│   │                              ЗАЧЕМ: backend в Next.js
│   │
│   ├── components/                # 🧩 ПЕРЕИСПОЛЬЗУЕМЫЕ КОМПОНЕНТЫ
│   │   ├── ui/                   
│   │   │   ├── Button.tsx        • Базовые UI элементы
│   │   │   └── Card.tsx          
│   │   └── features/             
│   │       └── PostCard.tsx      • Бизнес-компоненты
│   │                              ЗАЧЕМ: DRY, переиспользование
│   │
│   ├── lib/                       # 🔧 УТИЛИТЫ И HELPERS
│   │   ├── db.ts                 • Database connection (Prisma)
│   │   ├── utils.ts              • Общие функции
│   │   └── validations.ts        • Валидация
│   │                              ЗАЧЕМ: переиспользуемые функции
│   │
│   └── types/                     # 📝 TYPESCRIPT TYPES (если TS)
│       └── index.ts              • Общие типы
│                                  ЗАЧЕМ: типизация
│
├── prisma/                        # 💾 DATABASE SCHEMA (если Prisma)
│   └── schema.prisma             • Модели БД
│                                  ЗАЧЕМ: описание таблиц
│
├── .env.local                     # 🔐 ПЕРЕМЕННЫЕ (в .gitignore)
├── .env.example                   # 📝 Шаблон переменных
├── .gitignore                     # 🚫 Git исключения
├── next.config.js                 # ⚙️ Next.js конфигурация
├── tailwind.config.ts             # 🎨 Tailwind конфигурация
├── package.json                   # 📦 Зависимости
└── README.md                      # 📖 Документация
```

---

#### 💡 App Router - File-based Routing

**Концепция:** Папка = Route

```
app/
├── page.tsx                # Route: /
├── about/
│   └── page.tsx           # Route: /about
├── blog/
│   ├── page.tsx           # Route: /blog
│   └── [slug]/
│       └── page.tsx       # Route: /blog/:slug (динамический)
└── dashboard/
    ├── layout.tsx         # Layout для /dashboard/*
    ├── page.tsx           # Route: /dashboard
    └── settings/
        └── page.tsx       # Route: /dashboard/settings
```

**Правила:**
- `page.tsx` - создаёт route (доступную по URL)
- `layout.tsx` - общий layout для всех вложенных страниц
- `[slug]/` - динамический параметр (параметр в URL)
- `api/` - API routes (backend endpoints)

---

#### 📄 Типы файлов в App Router

**page.tsx - Страница (route)**

```tsx
// app/page.tsx
export default function HomePage() {
  return (
    <div>
      <h1>Welcome to Next.js!</h1>
    </div>
  )
}
```

Route: `/`

---

**layout.tsx - Layout (обёртка)**

```tsx
// app/layout.tsx
export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body>
        <nav>Navbar</nav>
        {children}
        <footer>Footer</footer>
      </body>
    </html>
  )
}
```

Применяется ко ВСЕМ страницам.

---

**route.ts - API Route (backend)**

```tsx
// app/api/hello/route.ts
export async function GET() {
  return Response.json({ message: 'Hello from API!' })
}

export async function POST(request: Request) {
  const body = await request.json()
  return Response.json({ received: body })
}
```

API: `GET /api/hello`, `POST /api/hello`

---

**[param]/ - Динамические routes**

```tsx
// app/blog/[slug]/page.tsx
export default function BlogPost({ 
  params 
}: { 
  params: { slug: string } 
}) {
  return <h1>Post: {params.slug}</h1>
}
```

Route: `/blog/my-first-post` → params.slug = "my-first-post"

---

#### 🧩 src/components/ - Компоненты

**components/ui/ - Базовые UI**

```tsx
// src/components/ui/Button.tsx
export default function Button({ 
  children, 
  onClick 
}: { 
  children: React.ReactNode
  onClick?: () => void
}) {
  return (
    <button
      onClick={onClick}
      className="px-4 py-2 bg-blue-600 text-white rounded"
    >
      {children}
    </button>
  )
}
```

**Использование:**
```tsx
import Button from '@/components/ui/Button'

<Button onClick={() => alert('Clicked!')}>
  Click me
</Button>
```

---

**components/features/ - Бизнес-компоненты**

```tsx
// src/components/features/PostCard.tsx
export default function PostCard({ 
  title, 
  excerpt 
}: { 
  title: string
  excerpt: string
}) {
  return (
    <div className="border p-4 rounded">
      <h3 className="font-bold">{title}</h3>
      <p className="text-gray-600">{excerpt}</p>
    </div>
  )
}
```

---

#### 🔧 src/lib/ - Утилиты

**lib/db.ts - Database (Prisma)**

```tsx
import { PrismaClient } from '@prisma/client'

const globalForPrisma = global as unknown as { prisma: PrismaClient }

export const prisma =
  globalForPrisma.prisma ||
  new PrismaClient()

if (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma
```

**Использование:**
```tsx
import { prisma } from '@/lib/db'

const posts = await prisma.post.findMany()
```

---

**lib/utils.ts - Общие функции**

```tsx
export function formatDate(date: Date): string {
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(date)
}

export function truncate(text: string, length: number): string {
  return text.length > length 
    ? text.slice(0, length) + '...' 
    : text
}
```

---

#### 🔌 API Routes в Next.js

**Пример CRUD API:**

```tsx
// app/api/posts/route.ts
import { prisma } from '@/lib/db'
import { NextResponse } from 'next/server'

// GET /api/posts - Список постов
export async function GET() {
  try {
    const posts = await prisma.post.findMany()
    return NextResponse.json(posts)
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to fetch posts' },
      { status: 500 }
    )
  }
}

// POST /api/posts - Создать пост
export async function POST(request: Request) {
  try {
    const body = await request.json()
    
    const post = await prisma.post.create({
      data: {
        title: body.title,
        content: body.content,
      },
    })
    
    return NextResponse.json(post, { status: 201 })
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to create post' },
      { status: 500 }
    )
  }
}
```

**Динамический API route:**

```tsx
// app/api/posts/[id]/route.ts
import { prisma } from '@/lib/db'
import { NextResponse } from 'next/server'

// GET /api/posts/123
export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  const post = await prisma.post.findUnique({
    where: { id: parseInt(params.id) },
  })
  
  if (!post) {
    return NextResponse.json(
      { error: 'Post not found' },
      { status: 404 }
    )
  }
  
  return NextResponse.json(post)
}

// PUT /api/posts/123
export async function PUT(
  request: Request,
  { params }: { params: { id: string } }
) {
  const body = await request.json()
  
  const post = await prisma.post.update({
    where: { id: parseInt(params.id) },
    data: body,
  })
  
  return NextResponse.json(post)
}

// DELETE /api/posts/123
export async function DELETE(
  request: Request,
  { params }: { params: { id: string } }
) {
  await prisma.post.delete({
    where: { id: parseInt(params.id) },
  })
  
  return NextResponse.json({ success: true })
}
```

---

#### ✅ Чек-лист правильной структуры

**App Router:**
- [ ] app/ папка создана
- [ ] app/layout.tsx существует (Root Layout)
- [ ] app/page.tsx существует (главная страница)
- [ ] app/globals.css существует (стили)

**API Routes:**
- [ ] app/api/ создана
- [ ] Хотя бы один route.ts создан
- [ ] API routes возвращают Response.json()

**Компоненты:**
- [ ] src/components/ui/ создана (базовые UI)
- [ ] src/components/features/ создана (бизнес-компоненты)

**Utilities:**
- [ ] src/lib/ создана
- [ ] src/lib/utils.ts создан (общие функции)
- [ ] src/lib/db.ts создан (если Prisma)

**Routing:**
- [ ] Понятно как создавать routes (папка + page.tsx)
- [ ] Понятно как создавать API (app/api/*/route.ts)
- [ ] Понятно как использовать динамические routes ([param])

**Проверка:**
- [ ] ИИ понимает структуру
- [ ] Легко найти любой файл
- [ ] Понятно куда добавлять новые страницы

---

#### 🤖 Диалог с Claude Code

**✅ Хороший диалог:**
```
Ты: Создай структуру для Next.js App Router проекта.

СТРУКТУРА:
src/
├── app/
│   ├── layout.tsx        # Root Layout
│   ├── page.tsx          # Главная (/)
│   ├── about/
│   │   └── page.tsx     # /about
│   └── api/
│       └── posts/
│           └── route.ts  # API /api/posts
├── components/
│   ├── ui/               # Button, Card, Input
│   └── features/         # PostCard, etc
├── lib/
│   ├── db.ts            # Prisma client
│   └── utils.ts         # Helpers
└── types/
    └── index.ts         # TypeScript types

ТРЕБОВАНИЯ:
- App Router (не Pages Router)
- API routes в app/api/
- Компоненты переиспользуемые
- lib/ для утилит и DB

Создай базовую структуру с примерами.

Claude Code: [создаёт правильную структуру]
```

---

**Следующий урок:** 3.3 Environment Variables в Next.js