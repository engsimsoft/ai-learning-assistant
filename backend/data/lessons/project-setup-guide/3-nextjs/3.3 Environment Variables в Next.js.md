# 3.3 Environment Variables ะฒ Next.js

#### ๐ฏ ะะฐัะตะผ ะฝัะถะฝั ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

**ะัะพะฑะปะตะผะฐ ะฑะตะท .env:**
- API ะบะปััะธ ะฒ ะบะพะดะต (ัะตะบัะตัั ะฒ Git!)
- ะะฐะทะฝัะต ะฝะฐัััะพะนะบะธ ะดะปั dev/production ัะฐัะดะบะพะดะพะผ
- ะะตะปัะทั ะผะตะฝััั ะฝะฐัััะพะนะบะธ ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ

**Environment Variables ัะตัะฐัั:**
- โ ะกะตะบัะตัั ะฒะฝะต ะบะพะดะฐ (.env.local ะฝะต ะฒ Git)
- โ ะะฐะทะฝัะต ะฝะฐัััะพะนะบะธ ะดะปั dev/production
- โ ะะตะณะบะพ ะผะตะฝััั ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะบะพะดะฐ

---

#### ๐ ะขะธะฟั ะฟะตัะตะผะตะฝะฝัั ะฒ Next.js

**ะะะะขะะงะะ ะฟะพะฝะธะผะฐัั:**

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะกะะะะะะะซะ ะะะะะะะะะซะ                                    โ
โ  (ัะพะปัะบะพ ะฝะฐ ัะตัะฒะตัะต, ะบะปะธะตะฝั ะะ ะฒะธะดะธั)                   โ
โ                                                          โ
โ  DATABASE_URL=postgresql://...                          โ
โ  API_SECRET_KEY=sk_...                                  โ
โ  STRIPE_SECRET_KEY=sk_...                               โ
โ                                                          โ
โ  โ ะะตะทะพะฟะฐัะฝะพ (ัะตะบัะตัั)                                  โ
โ  โ ะะ ะดะพัััะฟะฝั ะฒ browser                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะะะะะขะกะะะ ะะะะะะะะะซะ                                   โ
โ  (ะดะพัััะฟะฝั ะฒ browser, ะฟัะตัะธะบั NEXT_PUBLIC_)             โ
โ                                                          โ
โ  NEXT_PUBLIC_API_URL=https://api.example.com            โ
โ  NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_...              โ
โ                                                          โ
โ  โ๏ธ ะะธะดะฝั ะฒ browser (ะฝะต ะดะปั ัะตะบัะตัะพะฒ!)                  โ
โ  โ ะัะถะฝั ะดะปั frontend ะปะพะณะธะบะธ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะัะฐะฒะธะปะพ:**
- ะะตะท `NEXT_PUBLIC_` โ ัะพะปัะบะพ ัะตัะฒะตั
- ะก `NEXT_PUBLIC_` โ ัะตัะฒะตั + ะบะปะธะตะฝั (browser)

---

#### ๐ ะคะฐะนะปั .env

**Next.js ะฟะพะดะดะตัะถะธะฒะฐะตั ะฝะตัะบะพะปัะบะพ .env ัะฐะนะปะพะฒ:**

```
.env                  # ะะปั ะฒัะตั ะพะบััะถะตะฝะธะน (common)
.env.local            # ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ (ะฒ .gitignore)
.env.development      # npm run dev
.env.production       # npm run build + npm start
```

**ะัะธะพัะธัะตั (ะพั ะฒัััะตะณะพ ะบ ะฝะธะทัะตะผั):**
1. `.env.local` (highest priority)
2. `.env.development` ะธะปะธ `.env.production`
3. `.env`

**ะงัะพ ะธัะฟะพะปัะทะพะฒะฐัั:**
- `.env.local` - ะดะปั ัะฐะทัะฐะฑะพัะบะธ (ัะตะบัะตัั, ะปะพะบะฐะปัะฝัะต ะฝะฐัััะพะนะบะธ)
- `.env.example` - ัะฐะฑะปะพะฝ (ะะะ ัะตะฐะปัะฝัั ะทะฝะฐัะตะฝะธะน, ะฒ Git)

---

#### ๐ ะัะธะผะตั .env.local

```env
# Database (ัะพะปัะบะพ ัะตัะฒะตั)
DATABASE_URL=postgresql://user:password@localhost:5432/mydb

# Authentication (Clerk)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Stripe
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# OpenAI (ัะพะปัะบะพ ัะตัะฒะตั)
OPENAI_API_KEY=sk-...

# App URL (ะบะปะธะตะฝั)
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

---

#### ๐ ะัะธะผะตั .env.example

```env
# Database
DATABASE_URL=postgresql://user:password@localhost:5432/mydb

# Authentication (get from: https://clerk.com)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Stripe (get from: https://stripe.com/dashboard)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# OpenAI
OPENAI_API_KEY=sk-...

# App URL
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

---

#### ๐ป ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฟะตัะตะผะตะฝะฝัั

**ะ Server Components / API Routes (ัะตัะฒะตั):**

```tsx
// app/api/posts/route.ts
export async function GET() {
  // ะกะตัะฒะตัะฝะฐั ะฟะตัะตะผะตะฝะฝะฐั (ะะะ NEXT_PUBLIC_)
  const dbUrl = process.env.DATABASE_URL
  const apiKey = process.env.OPENAI_API_KEY
  
  // ะะฐะฑะพัะฐะตั โ
  return Response.json({ connected: true })
}
```

---

**ะ Client Components (ะฑัะฐัะทะตั):**

```tsx
// app/components/SomeComponent.tsx
'use client'

export default function SomeComponent() {
  // ะะปะธะตะฝััะบะฐั ะฟะตัะตะผะตะฝะฝะฐั (ะก NEXT_PUBLIC_)
  const apiUrl = process.env.NEXT_PUBLIC_APP_URL
  
  // โ ะะฐะฑะพัะฐะตั
  console.log('API URL:', apiUrl)
  
  // โ ะะ ัะฐะฑะพัะฐะตั (undefined)
  const dbUrl = process.env.DATABASE_URL
  console.log('DB URL:', dbUrl) // undefined
  
  return <div>Component</div>
}
```

**โ๏ธ ะะะะะ:** ะกะตัะฒะตัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ะฝะตะดะพัััะฟะฝั ะฒ Client Components!

---

#### ๐ง Type Safety (TypeScript)

**ะกะพะทะดะฐะน ัะธะฟั ะดะปั ะฟะตัะตะผะตะฝะฝัั:**

```tsx
// src/lib/env.ts
export const env = {
  // ะกะตัะฒะตัะฝัะต
  DATABASE_URL: process.env.DATABASE_URL!,
  OPENAI_API_KEY: process.env.OPENAI_API_KEY!,
  CLERK_SECRET_KEY: process.env.CLERK_SECRET_KEY!,
  
  // ะะปะธะตะฝััะบะธะต
  NEXT_PUBLIC_APP_URL: process.env.NEXT_PUBLIC_APP_URL!,
  NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY: process.env.NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY!,
}

// ะะฐะปะธะดะฐัะธั ะฟัะธ ััะฐััะต
if (!env.DATABASE_URL) {
  throw new Error('DATABASE_URL is not defined')
}
```

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**

```tsx
import { env } from '@/lib/env'

const dbUrl = env.DATABASE_URL // Type-safe โ
```

---

#### โ๏ธ ะะตะทะพะฟะฐัะฝะพััั

**DO (ะดะตะปะฐะน ัะฐะบ):**

โ **ะกะตะบัะตัั ะฒ .env.local (ะฝะต ะฒ ะบะพะดะต)**
```tsx
// โ ะัะฐะฒะธะปัะฝะพ
const apiKey = process.env.OPENAI_API_KEY

// โ ะะตะฟัะฐะฒะธะปัะฝะพ (ัะฐัะดะบะพะด)
const apiKey = 'sk-abc123...'
```

โ **ะะปะธะตะฝััะบะธะต ะฟะตัะตะผะตะฝะฝัะต ะขะะะฌะะ ะดะปั ะฟัะฑะปะธัะฝะพะน ะธะฝัะพัะผะฐัะธะธ**
```env
# โ OK ะดะปั NEXT_PUBLIC_
NEXT_PUBLIC_APP_URL=https://myapp.com
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...

# โ ะะะะะะะ ะฝะต ะดะตะปะฐะน NEXT_PUBLIC_ ะดะปั ัะตะบัะตัะพะฒ
NEXT_PUBLIC_DATABASE_PASSWORD=...  # โ ะะฟะฐัะฝะพ!
```

โ **.env.local ะฒ .gitignore**
```gitignore
.env*.local
```

---

**DON'T (ะฝะต ะดะตะปะฐะน ัะฐะบ):**

โ **ะกะตัะฒะตัะฝัะต ัะตะบัะตัั ั NEXT_PUBLIC_**
```env
# โ ะะะะกะะ - ัะตะบัะตั ะฑัะดะตั ะฒ ะฑัะฐัะทะตัะต!
NEXT_PUBLIC_DATABASE_URL=postgresql://...
NEXT_PUBLIC_API_SECRET=sk-...
```

โ **.env.local ะฒ Git**
```bash
# โ ะะ ะดะตะปะฐะน
git add .env.local
```

โ **ะฅะฐัะดะบะพะด ัะตะบัะตัะพะฒ ะฒ ะบะพะดะต**
```tsx
// โ ะกะตะบัะตั ะฒ ะบะพะดะต (ะฟะพะฟะฐะดัั ะฒ Git)
const apiKey = 'sk-abc123xyz'
```

---

#### ๐ ะะตัะตะทะฐะฟััะบ ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธะน

**โ๏ธ ะะะะะ:** Next.js ััะตะฑัะตั ะฟะตัะตะทะฐะฟััะบะฐ ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธั .env!

```bash
# ะะทะผะตะฝะธะป .env.local
# ะััะฐะฝะพะฒะธ ัะตัะฒะตั (Ctrl+C)
# ะะฐะฟัััะธ ะทะฐะฝะพะฒะพ
npm run dev
```

**ะะต ัะฐะฑะพัะฐะตั Hot Reload ะดะปั .env ัะฐะนะปะพะฒ!**

---

#### โ ะงะตะบ-ะปะธัั: Variables ะฝะฐัััะพะตะฝั

**ะคะฐะนะปั ัะพะทะดะฐะฝั:**
- [ ] .env.local ัะพะทะดะฐะฝ (ะดะปั ัะฐะทัะฐะฑะพัะบะธ)
- [ ] .env.example ัะพะทะดะฐะฝ (ัะฐะฑะปะพะฝ ะดะปั Git)
- [ ] .gitignore ัะพะดะตัะถะธั .env*.local

**ะะตัะตะผะตะฝะฝัะต ะฟัะฐะฒะธะปัะฝะพ ะฝะฐะทะฒะฐะฝั:**
- [ ] ะกะตัะฒะตัะฝัะต ะะะ NEXT_PUBLIC_
- [ ] ะะปะธะตะฝััะบะธะต ะก NEXT_PUBLIC_
- [ ] ะะตั ัะตะบัะตัะพะฒ ะฒ NEXT_PUBLIC_

**ะะตะทะพะฟะฐัะฝะพััั:**
- [ ] .env.local ะะ ะฒ Git
- [ ] ะะตั ัะฐัะดะบะพะดะฐ ัะตะบัะตัะพะฒ ะฒ ะบะพะดะต
- [ ] .env.example ะะะ ัะตะฐะปัะฝัั ะทะฝะฐัะตะฝะธะน

**ะัะพะฒะตัะบะฐ:**
- [ ] ะกะตัะฒะตัะฝัะต ะฟะตัะตะผะตะฝะฝัะต ัะฐะฑะพัะฐัั ะฒ API routes
- [ ] ะะปะธะตะฝััะบะธะต ะฟะตัะตะผะตะฝะฝัะต ัะฐะฑะพัะฐัั ะฒ Client Components
- [ ] ะะพัะปะต ะธะทะผะตะฝะตะฝะธั .env ะฟะตัะตะทะฐะฟััะบะฐะตัั ัะตัะฒะตั

---

**ะกะปะตะดัััะธะน ััะพะบ:** 3.4 ะงะตะบ-ะปะธัั: Next.js ะฟัะพะตะบั ะณะพัะพะฒ