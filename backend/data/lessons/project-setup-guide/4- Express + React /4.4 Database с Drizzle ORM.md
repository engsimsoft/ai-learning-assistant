# 4.4 Database —Å Drizzle ORM

> **–í—Ä–µ–º—è –∏–∑—É—á–µ–Ω–∏—è:** 50-60 –º–∏–Ω—É—Ç  
> **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** ‚≠ê‚≠ê –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π —É—Ä–æ–∫  
> **Prerequisite:** –£—Ä–æ–∫ 1.7 (SSOT), –£—Ä–æ–∫ 4.3 (–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫), AI Web Learning Module 3 (Database basics)

---

## üéØ –¶–µ–ª—å —É—Ä–æ–∫–∞

–ù–∞—É—á–∏—Ç—å—Å—è **–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å** —Å PostgreSQL —á–µ—Ä–µ–∑ Drizzle ORM –≤ Express –ø—Ä–æ–µ–∫—Ç–µ. –ú—ã —Ä–∞–∑–±–µ—Ä—ë–º –ø–æ—á–µ–º—É shared/schema.ts –≤ 527 ShortCut - –æ—Ç–ª–∏—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `db:push` –≤–º–µ—Å—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–π - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è production.

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:**  
`db:push` –º–æ–∂–µ—Ç –£–î–ê–õ–ò–¢–¨ –¥–∞–Ω–Ω—ã–µ –≤ production –ë–î. –ú–∏–≥—Ä–∞—Ü–∏–∏ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–ø–æ—Å–æ–± –∏–∑–º–µ–Ω—è—Ç—å —Å—Ö–µ–º—É –ë–î.

---

## ü§î –ß—Ç–æ —Ç–∞–∫–æ–µ ORM –∏ –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω?

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–±–æ—Ç–∞ —Å –ë–î –Ω–∞ —á–∏—Å—Ç–æ–º SQL —Å–ª–æ–∂–Ω–∞

```typescript
// ‚ùå –ë–µ–∑ ORM - –ø–∏—à–µ–º SQL –≤—Ä—É—á–Ω—É—é
const result = await db.query(`
  SELECT * FROM races 
  WHERE id = $1 
  AND status = $2
`, [raceId, 'completed']);

// –ü—Ä–æ–±–ª–µ–º—ã:
// - SQL —Å—Ç—Ä–æ–∫–∏ (–ª–µ–≥–∫–æ –æ—à–∏–±–∏—Ç—å—Å—è)
// - –ù–µ—Ç —Ç–∏–ø–æ–≤ (TypeScript –Ω–µ –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
// - SQL injection —Ä–∏—Å–∫
// - –°–ª–æ–∂–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å
```

### –†–µ—à–µ–Ω–∏–µ: ORM (Object-Relational Mapping)

```typescript
// ‚úÖ –° Drizzle ORM
const result = await db
  .select()
  .from(races)
  .where(eq(races.id, raceId))
  .where(eq(races.status, 'completed'));

// –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
// - TypeScript —Ç–∏–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// - SQL injection –∑–∞—â–∏—Ç–∞
// - Autocomplete –≤ IDE
// - –õ–µ–≥–∫–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å
```

**–ê–Ω–∞–ª–æ–≥–∏—è:**  
ORM - —ç—Ç–æ –∫–∞–∫ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫ –º–µ–∂–¥—É –º–∏—Ä–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ (TypeScript) –∏ –º–∏—Ä–æ–º —Ç–∞–±–ª–∏—Ü (PostgreSQL). –¢—ã –≥–æ–≤–æ—Ä–∏—à—å –Ω–∞ TypeScript, –∞ ORM –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–æ –≤ SQL.

---

## üîß Drizzle ORM - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –≤—ã–±–æ—Ä

### –ü–æ—á–µ–º—É Drizzle, –∞ –Ω–µ Prisma –∏–ª–∏ TypeORM?

| –§–∏—á–∞ | Drizzle ORM | Prisma | TypeORM |
|------|-------------|--------|---------|
| **TypeScript-first** | ‚úÖ –†–æ–¥–Ω–æ–π TS | ‚úÖ –î–∞ | ‚ö†Ô∏è Decorators |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ‚úÖ‚úÖ –û—Ç–ª–∏—á–Ω–æ | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–µ–µ |
| **SQL –∫–æ–Ω—Ç—Ä–æ–ª—å** | ‚úÖ‚úÖ –ü–æ–ª–Ω—ã–π | ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π | ‚ö†Ô∏è –°—Ä–µ–¥–Ω–∏–π |
| **–†–∞–∑–º–µ—Ä bundle** | ‚úÖ –ú–∞–ª–µ–Ω—å–∫–∏–π | ‚ùå –ë–æ–ª—å—à–æ–π | ‚ùå –û–≥—Ä–æ–º–Ω—ã–π |
| **–ú–∏–≥—Ä–∞—Ü–∏–∏** | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å | ‚úÖ –ï—Å—Ç—å |
| **Relational queries** | ‚úÖ –£–¥–æ–±–Ω–æ | ‚úÖ –£–¥–æ–±–Ω–æ | ‚ö†Ô∏è –°–ª–æ–∂–Ω–æ |

**Drizzle ORM –∏–¥–µ–∞–ª–µ–Ω –∫–æ–≥–¥–∞:**
- –ù—É–∂–µ–Ω TypeScript-first –ø–æ–¥—Ö–æ–¥
- –•–æ—á–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ SQL
- –í–∞–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- PostgreSQL, MySQL –∏–ª–∏ SQLite

**527 ShortCut –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Drizzle** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä! ‚úÖ

---

## üìÅ Schema –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è: SSOT –ø—Ä–∏–Ω—Ü–∏–ø

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≤ 527 ShortCut (–û–¢–õ–ò–ß–ù–û!)

```
project/
‚îÇ
‚îú‚îÄ‚îÄ shared/
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts          # ‚úÖ Single Source of Truth!
‚îÇ
‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îî‚îÄ‚îÄ postgres-storage.ts    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç schema
‚îÇ
‚îî‚îÄ‚îÄ client/
    ‚îî‚îÄ‚îÄ src/
        ‚îî‚îÄ‚îÄ types/          # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø—ã –∏–∑ schema
```

**–ì–ª–∞–≤–Ω–∞—è –∏–¥–µ—è:**  
Database schema –∂–∏–≤—ë—Ç –≤ –û–î–ù–û–ú —Ñ–∞–π–ª–µ, –∫–æ—Ç–æ—Ä—ã–π –≤–∏–¥—è—Ç –∏ backend –∏ frontend.

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û –û–¢–õ–ò–ß–ù–û: shared/schema.ts

### –ü—Ä–∏–º–µ—Ä –∏–∑ 527 ShortCut

```typescript
// shared/schema.ts - –û–î–ò–ù —Ñ–∞–π–ª –¥–ª—è –í–°–ï–ì–û –ø—Ä–æ–µ–∫—Ç–∞!

import { pgTable, serial, varchar, integer, date, boolean, text, timestamp } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

// –¢–∞–±–ª–∏—Ü–∞ –≥–æ–Ω–æ–∫
export const races = pgTable('races', {
  id: serial('id').primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  trackId: integer('track_id').references(() => tracks.id),
  startDate: date('start_date').notNull(),
  endDate: date('end_date').notNull(),
  status: varchar('status', { length: 50 }).notNull().default('upcoming'),
  season: varchar('season', { length: 10 }).notNull(),
  stageNumber: integer('stage_number').notNull(),
  imageUrl: text('image_url'),
  race1VideoUrl: text('race1_video_url'),
  race2VideoUrl: text('race2_video_url'),
});

// –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
export const results = pgTable('results', {
  id: serial('id').primaryKey(),
  raceId: integer('race_id').references(() => races.id).notNull(),
  sessionType: varchar('session_type', { length: 50 }).notNull(),
  position: integer('position').notNull(),
  carNumber: integer('car_number').notNull(),
  driverName: varchar('driver_name', { length: 255 }).notNull(),
  teamName: varchar('team_name', { length: 255 }),
  time: varchar('time', { length: 50 }),
  bestLapTime: varchar('best_lap_time', { length: 50 }),
  totalLaps: integer('total_laps'),
  gapToLeader: varchar('gap_to_leader', { length: 50 }),
  points: integer('points').default(0),
  notClassified: boolean('not_classified').default(false),
  notClassifiedReason: varchar('not_classified_reason', { length: 255 }),
});

// Relations (—Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏)
export const racesRelations = relations(races, ({ one, many }) => ({
  track: one(tracks, {
    fields: [races.trackId],
    references: [tracks.id],
  }),
  results: many(results),
}));

export const resultsRelations = relations(results, ({ one }) => ({
  race: one(races, {
    fields: [results.raceId],
    references: [races.id],
  }),
}));

// TypeScript —Ç–∏–ø—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
export type Race = typeof races.$inferSelect;
export type NewRace = typeof races.$inferInsert;
export type Result = typeof results.$inferSelect;
export type NewResult = typeof results.$inferInsert;
```

### –ü–æ—á–µ–º—É —ç—Ç–æ –ì–ï–ù–ò–ê–õ–¨–ù–û? ‚úÖ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê shared/schema.ts                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

1. SSOT (Single Source of Truth)
   ‚îú‚îÄ‚îÄ –°—Ö–µ–º–∞ –ë–î –æ–ø–∏—Å–∞–Ω–∞ –≤ –û–î–ù–û–ú –º–µ—Å—Ç–µ
   ‚îú‚îÄ‚îÄ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É backend –∏ frontend
   ‚îî‚îÄ‚îÄ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ = –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–µ–∑–¥–µ

2. TypeScript —Ç–∏–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   ‚îú‚îÄ‚îÄ Drizzle –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–∏–ø—ã –∏–∑ schema
   ‚îú‚îÄ‚îÄ Backend –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
   ‚îú‚îÄ‚îÄ Frontend –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
   ‚îî‚îÄ‚îÄ –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –≤ IDE —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ!

3. Refactoring –±–µ–∑–æ–ø–∞—Å–Ω—ã–π
   ‚îú‚îÄ‚îÄ –ò–∑–º–µ–Ω–∏–ª –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–ª—è –≤ schema
   ‚îú‚îÄ‚îÄ TypeScript –ø–æ–∫–∞–∂–µ—Ç –í–°–ï –º–µ—Å—Ç–∞ –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
   ‚îî‚îÄ‚îÄ –ù–µ –º–æ–∂–µ—à—å –∑–∞–±—ã—Ç—å –æ–±–Ω–æ–≤–∏—Ç—å –≥–¥–µ-—Ç–æ

4. Relations –≤—Å—Ç—Ä–æ–µ–Ω—ã
   ‚îú‚îÄ‚îÄ –û–ø–∏—Å–∞–ª —Å–≤—è–∑–∏ –æ–¥–∏–Ω —Ä–∞–∑
   ‚îú‚îÄ‚îÄ Drizzle –ø–æ–Ω–∏–º–∞–µ—Ç –∫–∞–∫ –¥–µ–ª–∞—Ç—å JOIN
   ‚îî‚îÄ‚îÄ –õ–µ–≥–∫–æ –ø–æ–ª—É—á–∞—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

5. Shared –º–µ–∂–¥—É –ø—Ä–æ–µ–∫—Ç–∞–º–∏
   ‚îú‚îÄ‚îÄ Backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: import { races } from '@/shared/schema'
   ‚îú‚îÄ‚îÄ Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç: import { Race } from '@/shared/schema'
   ‚îî‚îÄ‚îÄ –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –¥–ª—è –≤—Å–µ—Ö
```

**–≠—Ç–æ –û–ë–†–ê–ó–ï–¶ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏!** üëè

---

## üîç –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å schema –≤ –∫–æ–¥–µ

### Backend: Queries —Å —Ç–∏–ø–∞–º–∏

```typescript
// server/postgres-storage.ts
import { db } from './db';
import { races, results, eq } from '@/shared/schema';

export class Storage {
  
  // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≥–æ–Ω–∫–∏ (—Ç–∏–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!)
  async getAllRaces(): Promise<Race[]> {
    return await db.select().from(races);
  }
  
  // –ü–æ–ª—É—á–∏—Ç—å –≥–æ–Ω–∫—É –ø–æ ID
  async getRaceById(id: number): Promise<Race | null> {
    const [race] = await db
      .select()
      .from(races)
      .where(eq(races.id, id))
      .limit(1);
    
    return race || null;
  }
  
  // –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥–æ–Ω–∫–µ (JOIN)
  async getResultsWithRace(raceId: number) {
    return await db
      .select()
      .from(results)
      .leftJoin(races, eq(results.raceId, races.id))
      .where(eq(results.raceId, raceId));
  }
}
```

**–ú–∞–≥–∏—è TypeScript:**
```typescript
const races = await storage.getAllRaces();

// TypeScript –∑–Ω–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É!
races[0].name        // ‚úÖ –ê–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
races[0].trackId     // ‚úÖ –ó–Ω–∞–µ—Ç —á—Ç–æ —ç—Ç–æ number
races[0].wrongField  // ‚ùå TypeScript –æ—à–∏–±–∫–∞: –Ω–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è
```

### Frontend: –¢–∏–ø—ã –∏–∑ schema

```typescript
// client/src/pages/Results.tsx
import { Race, Result } from '@/shared/schema';
import { useState, useEffect } from 'react';

function ResultsPage() {
  const [races, setRaces] = useState<Race[]>([]);
  const [results, setResults] = useState<Result[]>([]);
  
  useEffect(() => {
    // Fetch data from API
    fetch('/api/races')
      .then(res => res.json())
      .then((data: Race[]) => setRaces(data));
  }, []);
  
  return (
    <div>
      {races.map(race => (
        <div key={race.id}>
          <h2>{race.name}</h2>
          {/* TypeScript –∑–Ω–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è! */}
          <p>Stage: {race.stageNumber}</p>
          <p>Status: {race.status}</p>
        </div>
      ))}
    </div>
  );
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Frontend –∏ Backend –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ç–∏–ø—ã
- ‚úÖ –ò–∑–º–µ–Ω–∏–ª schema ‚Üí –æ–±–∞ –ø—Ä–æ–µ–∫—Ç–∞ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- ‚úÖ –ù–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É API –∏ UI

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: db:push –≤–º–µ—Å—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–π

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ 527 ShortCut –°–ï–ô–ß–ê–°

```json
// package.json
{
  "scripts": {
    "db:push": "drizzle-kit push",      // ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!
    "db:generate": "drizzle-kit generate", // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    "db:migrate": "drizzle-kit migrate"    // –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
  }
}
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å:**
```bash
# –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–∏–ª schema.ts
# –î–æ–±–∞–≤–∏–ª –Ω–æ–≤–æ–µ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü—É

npm run db:push  # ‚ùå –ü—Ä—è–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ë–î –±–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏!
```

### –ß—Ç–æ —Ç–∞–∫–æ–µ db:push –∏ –ø–æ—á–µ–º—É —ç—Ç–æ –û–ü–ê–°–ù–û?

**db:push:**
- –ß–∏—Ç–∞–µ—Ç `schema.ts`
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å —Ç–µ–∫—É—â–µ–π –ë–î
- **–°–†–ê–ó–£ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è** –∫ –ë–î (–±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          ‚ùå –ü–†–û–ë–õ–ï–ú–´ db:push –í PRODUCTION                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–†–û–ë–õ–ï–ú–ê 1: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ db:push –º–æ–∂–µ—Ç –£–î–ê–õ–ò–¢–¨ —Å—Ç–æ–ª–±–µ—Ü
‚îú‚îÄ‚îÄ –î–∞–Ω–Ω—ã–µ –≤ —ç—Ç–æ–º —Å—Ç–æ–ª–±—Ü–µ –ü–†–û–ü–ê–î–£–¢ –Ω–∞–≤—Å–µ–≥–¥–∞
‚îî‚îÄ‚îÄ üíÄ –ù–ï–í–û–ó–ú–û–ñ–ù–û –æ—Ç–∫–∞—Ç–∏—Ç—å!

–ü–†–û–ë–õ–ï–ú–ê 2: –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ –ù–µ –ø–æ–Ω—è—Ç–Ω–æ –ö–¢–û –∏ –ö–û–ì–î–ê –∏–∑–º–µ–Ω–∏–ª —Å—Ö–µ–º—É
‚îú‚îÄ‚îÄ –ù–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –¥–ª—è –ë–î
‚îî‚îÄ‚îÄ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å —á—Ç–æ –±—ã–ª–æ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ü–†–û–ë–õ–ï–ú–ê 3: –ü—Ä–æ–±–ª–µ–º—ã –≤ –∫–æ–º–∞–Ω–¥–µ
‚îú‚îÄ‚îÄ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ A –∑–∞–ø—É—Å—Ç–∏–ª db:push –ª–æ–∫–∞–ª—å–Ω–æ
‚îú‚îÄ‚îÄ –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ B –∑–∞–ø—É—Å—Ç–∏–ª db:push —Å –¥—Ä—É–≥–æ–π —Å—Ö–µ–º–æ–π
‚îú‚îÄ‚îÄ Production –ë–î: –∫—Ç–æ-—Ç–æ –∑–∞–ø—É—Å—Ç–∏–ª db:push
‚îî‚îÄ‚îÄ üí• –í—Å–µ –ë–î —Ä–∞–∑–Ω—ã–µ! –•–∞–æ—Å!

–ü–†–û–ë–õ–ï–ú–ê 4: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å
‚îú‚îÄ‚îÄ db:push –∏–∑–º–µ–Ω–∏–ª –ë–î
‚îú‚îÄ‚îÄ –ß—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å
‚îú‚îÄ‚îÄ –ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å –Ω–∞–∑–∞–¥?
‚îî‚îÄ‚îÄ ‚ùå –ù–ò–ö–ê–ö! –î–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è–Ω—ã

–ü–†–û–ë–õ–ï–ú–ê 5: CI/CD –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω
‚îú‚îÄ‚îÄ Automated deployments –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
‚îú‚îÄ‚îÄ –ù—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∑–∞–ø—É—Å–∫–∞—Ç—å db:push
‚îî‚îÄ‚îÄ Human error —Ä–∏—Å–∫
```

---

### –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ö–ê–¢–ê–°–¢–†–û–§–´

**–î–µ–Ω—å 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏—á–∏**
```typescript
// –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–∏–ª –ø–æ–ª–µ –≤ schema.ts
export const races = pgTable('races', {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  newFeatureData: text('new_feature_data'),  // –ù–æ–≤–æ–µ –ø–æ–ª–µ
});
```

```bash
npm run db:push  # –õ–æ–∫–∞–ª—å–Ω–æ –¥–æ–±–∞–≤–∏–ª –ø–æ–ª–µ - —Ä–∞–±–æ—Ç–∞–µ—Ç!
```

**–î–µ–Ω—å 2: –§–∏—á–∞ –Ω–µ –Ω—É–∂–Ω–∞**
```typescript
// –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –£–î–ê–õ–ò–õ –ø–æ–ª–µ –∏–∑ schema.ts
export const races = pgTable('races', {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  // newFeatureData —É–¥–∞–ª–µ–Ω–æ
});
```

```bash
npm run db:push  # ‚ùå –û–ü–ê–°–ù–û–°–¢–¨!
```

**–ß–¢–û –ü–†–û–ò–ó–û–®–õ–û:**
```
Drizzle –≤–∏–¥–∏—Ç: –ø–æ–ª–µ newFeatureData –Ω–µ—Ç –≤ schema.ts
Drizzle –¥–µ–ª–∞–µ—Ç: DROP COLUMN newFeatureData
–†–µ–∑—É–ª—å—Ç–∞—Ç: üíÄ –í–°–ï –î–ê–ù–ù–´–ï –≤ —ç—Ç–æ–º —Å—Ç–æ–ª–±—Ü–µ –£–î–ê–õ–ï–ù–´ –Ω–∞–≤—Å–µ–≥–¥–∞!
```

**–ê –µ—Å–ª–∏ —ç—Ç–æ production –ë–î:**
```
–ü–æ—Ç–µ—Ä—è–Ω—ã –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (–Ω–µ—Ç backup —Ç–æ—á–∫–∏)
–ë–∏–∑–Ω–µ—Å —É–±—ã—Ç–∫–∏
–†–µ–ø—É—Ç–∞—Ü–∏—è –ø–æ—Ç–µ—Ä—è–Ω–∞
```

---

### –ß–ï–ú –ì–†–û–ó–ò–¢ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ db:push –≤ production?

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          üí∞ –¶–ï–ù–ê –û–®–ò–ë–ö–ò "db:push –≤ production"              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–°–ï–ô–ß–ê–° (–º–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–æ–µ–∫—Ç, dev —Ñ–∞–∑–∞):
‚îú‚îÄ‚îÄ –ë—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ
‚îú‚îÄ‚îÄ –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ë–î, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ
‚îî‚îÄ‚îÄ ‚ö†Ô∏è –ò–≥—Ä–∞–µ—Ç–µ —Å –æ–≥–Ω—ë–º

–ü–ï–†–í–´–ô –ò–ù–¶–ò–î–ï–ù–¢ (—Å–ª—É—á–∞–π–Ω–æ —É–¥–∞–ª–∏–ª–∏ —Å—Ç–æ–ª–±–µ—Ü):
‚îú‚îÄ‚îÄ –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ –ü–∞–Ω–∏–∫–∞ –≤ –∫–æ–º–∞–Ω–¥–µ
‚îú‚îÄ‚îÄ –ü–æ–ø—ã—Ç–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (–µ—Å–ª–∏ –µ—Å—Ç—å backup)
‚îî‚îÄ‚îÄ üí∏ –ú–∏–Ω–∏–º—É–º 1 –¥–µ–Ω—å –ø—Ä–æ—Å—Ç–æ—è + —Ä–µ–ø—É—Ç–∞—Ü–∏—è

PRODUCTION –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò:
‚îú‚îÄ‚îÄ üíÄ –£–¥–∞–ª–∏–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Å—Ç–æ–ª–±–µ—Ü
‚îú‚îÄ‚îÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ—Å—Ç–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å
‚îú‚îÄ‚îÄ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ—Ç–µ—Ä—è–Ω—ã
‚îú‚îÄ‚îÄ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å (–Ω–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–π!)
‚îî‚îÄ‚îÄ üí∏üí∏üí∏ –ö–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞:
    ‚îú‚îÄ‚îÄ –ü—Ä–æ—Å—Ç–æ–π –±–∏–∑–Ω–µ—Å–∞
    ‚îú‚îÄ‚îÄ –ü–æ—Ç–µ—Ä—è –∫–ª–∏–µ–Ω—Ç–æ–≤
    ‚îú‚îÄ‚îÄ –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (GDPR)
    ‚îî‚îÄ‚îÄ –†–µ–ø—É—Ç–∞—Ü–∏—è —É–±–∏—Ç–∞

–ö–û–ú–ê–ù–î–ê > 1 –ß–ï–õ–û–í–ï–ö–ê:
‚îú‚îÄ‚îÄ –†–∞–∑–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å—Ö–µ–º—ã —É —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îú‚îÄ‚îÄ Production –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤—Å–µ—Ö
‚îú‚îÄ‚îÄ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
‚îî‚îÄ‚îÄ üí∏ –ù–µ–¥–µ–ª–∏ –Ω–∞ —Ä–∞–∑–±–æ—Ä –ø—Ä–æ–±–ª–µ–º

–¶–ï–ù–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:
‚îú‚îÄ‚îÄ –°–ï–ô–ß–ê–°: 1 –¥–µ–Ω—å (–≤–Ω–µ–¥—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏)
‚îú‚îÄ‚îÄ –ü–û–°–õ–ï –ò–ù–¶–ò–î–ï–ù–¢–ê: –Ω–µ–¥–µ–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ –ú–ù–û–ñ–ò–¢–ï–õ–¨: 50x-100x —É—â–µ—Ä–±–∞
```

**–í–µ—Ä–¥–∏–∫—Ç:**  
`db:push` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û –¥–ª—è **–ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** –≤ **–æ–¥–∏–Ω–æ—á–∫—É**. –í production - **–ù–ò–ö–û–ì–î–ê!**

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ú–∏–≥—Ä–∞—Ü–∏–∏

### –ß—Ç–æ —Ç–∞–∫–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏?

**–ú–∏–≥—Ä–∞—Ü–∏—è** - —ç—Ç–æ —Ñ–∞–π–ª —Å SQL –∫–æ–º–∞–Ω–¥–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–π:
- –û–ø–∏—Å—ã–≤–∞–µ—Ç –ö–ê–ö –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ö–µ–º—É –ë–î
- –ò–º–µ–µ—Ç –≤–µ—Ä—Å–∏—é (timestamp)
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–∫–∞—á–µ–Ω (rollback)
- –•—Ä–∞–Ω–∏—Ç—Å—è –≤ git (–∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)

**–ê–Ω–∞–ª–æ–≥–∏—è:**  
–ú–∏–≥—Ä–∞—Ü–∏–∏ - —ç—Ç–æ –∫–∞–∫ git commits –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ —Ñ–∞–π–ª, –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é, –æ—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞–∑–∞–¥.

---

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ Drizzle

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Workflow —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–®–ê–ì 1: –ò–∑–º–µ–Ω—è–µ–º schema.ts
‚îú‚îÄ‚îÄ –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤–æ–µ –ø–æ–ª–µ, —Ç–∞–±–ª–∏—Ü—É, –∏–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏ —á—Ç–æ-—Ç–æ
‚îî‚îÄ‚îÄ –§–∞–π–ª: shared/schema.ts

–®–ê–ì 2: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
‚îú‚îÄ‚îÄ –ö–æ–º–∞–Ω–¥–∞: npm run db:generate
‚îú‚îÄ‚îÄ Drizzle —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç schema.ts —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ –°–æ–∑–¥–∞—ë—Ç SQL —Ñ–∞–π–ª —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
‚îî‚îÄ‚îÄ –§–∞–π–ª: drizzle/0001_add_new_field.sql

–®–ê–ì 3: –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
‚îú‚îÄ‚îÄ –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL
‚îú‚îÄ‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
‚îî‚îÄ‚îÄ –ú–æ–∂–µ–º –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–®–ê–ì 4: –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
‚îú‚îÄ‚îÄ –õ–æ–∫–∞–ª—å–Ω–æ: npm run db:migrate
‚îú‚îÄ‚îÄ Production: npm run db:migrate (–≤ CI/CD)
‚îî‚îÄ‚îÄ Drizzle –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

–®–ê–ì 5: –ö–æ–º–º–∏—Ç–∏–º –≤ git
‚îú‚îÄ‚îÄ schema.ts + –º–∏–≥—Ä–∞—Ü–∏—è –≤ –æ–¥–Ω–æ–º commit
‚îú‚îÄ‚îÄ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ë–î –≤ git
‚îî‚îÄ‚îÄ –ö–æ–º–∞–Ω–¥–∞ –≤–∏–¥–∏—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
```

---

### –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –≤ 527 ShortCut

#### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Drizzle Kit

```typescript
// drizzle.config.ts
import { defineConfig } from 'drizzle-kit';
import dotenv from 'dotenv';

dotenv.config();

export default defineConfig({
  schema: './shared/schema.ts',
  out: './drizzle',
  dialect: 'postgresql',
  dbCredentials: {
    url: process.env.DATABASE_URL!,
  },
});
```

#### 2. –ò–∑–º–µ–Ω—è–µ–º schema.ts

```typescript
// shared/schema.ts - –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ –ø–æ–ª–µ
export const races = pgTable('races', {
  id: serial('id').primaryKey(),
  name: varchar('name', { length: 255 }).notNull(),
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  // ‚úÖ –ù–æ–≤–æ–µ –ø–æ–ª–µ
  sponsorName: varchar('sponsor_name', { length: 255 }),
});
```

#### 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–∏–≥—Ä–∞—Ü–∏—é

```bash
npm run db:generate
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
```
drizzle/
‚îú‚îÄ‚îÄ 0000_initial_schema.sql          # –ü—Ä–µ–¥—ã–¥—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ 0001_add_sponsor_name.sql        # ‚úÖ –ù–û–í–ê–Ø –º–∏–≥—Ä–∞—Ü–∏—è!
‚îî‚îÄ‚îÄ meta/
    ‚îî‚îÄ‚îÄ _journal.json                # –ò—Å—Ç–æ—Ä–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```sql
-- drizzle/0001_add_sponsor_name.sql
ALTER TABLE "races" ADD COLUMN "sponsor_name" varchar(255);
```

#### 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ SQL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
cat drizzle/0001_add_sponsor_name.sql

# –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é –∫ –ë–î
npm run db:migrate
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ:**
- Drizzle –≤—ã–ø–æ–ª–Ω–∏–ª SQL –∏–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ó–∞–ø–æ–º–Ω–∏–ª —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è `0001` –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º `db:migrate` —ç—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—Å—è

#### 5. –ö–æ–º–º–∏—Ç–∏–º –≤ git

```bash
git add shared/schema.ts
git add drizzle/0001_add_sponsor_name.sql
git commit -m "feat: add sponsor name to races"
```

**–¢–µ–ø–µ—Ä—å:**
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≤–∏–¥–∏—Ç —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
- ‚úÖ CI/CD –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (Rollback)

**–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:**

```bash
# –°–æ–∑–¥–∞—ë–º –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –æ—Ç–∫–∞—Ç–∞
# (Drizzle –Ω–µ –∏–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ rollback, –Ω–æ –º–æ–∂–Ω–æ –≤—Ä—É—á–Ω—É—é)
```

```sql
-- drizzle/0002_rollback_sponsor_name.sql
ALTER TABLE "races" DROP COLUMN "sponsor_name";
```

```bash
npm run db:migrate  # –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—Ç–∫–∞—Ç
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ (–≤–∏–¥–Ω–æ —á—Ç–æ –±—ã–ª–æ –æ—Ç–∫–∞—á–µ–Ω–æ)
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è production

---

## üõ†Ô∏è –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π workflow –¥–ª—è 527 ShortCut

### –¢–µ–∫—É—â–∏–π (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π):

```bash
# ‚ùå –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–µ–Ω—è–µ—Ç schema.ts
npm run db:push  # –ü—Ä—è–º–æ –≤ –ë–î, –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π:

```bash
# 1. –ú–µ–Ω—è–µ—à—å schema.ts
vim shared/schema.ts

# 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –º–∏–≥—Ä–∞—Ü–∏—é
npm run db:generate

# 3. –ü—Ä–æ–≤–µ—Ä—è–µ—à—å SQL
cat drizzle/XXXX_migration_name.sql

# 4. –ü—Ä–∏–º–µ–Ω—è–µ—à—å –ª–æ–∫–∞–ª—å–Ω–æ
npm run db:migrate

# 5. –¢–µ—Å—Ç–∏—Ä—É–µ—à—å —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
npm run dev

# 6. –ö–æ–º–º–∏—Ç–∏—à—å –≤ git
git add shared/schema.ts drizzle/
git commit -m "migration: add new field"

# 7. Push –≤ GitHub
git push

# 8. Railway auto-deploy –ø—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏—é
# (–≤ build command –¥–æ–±–∞–≤–∏—Ç—å: npm run db:migrate)
```

---

## üîÑ Migration –≤ CI/CD (Railway)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

**Railway Build Settings:**
```json
{
  "buildCommand": "npm run build && npm run db:migrate",
  "startCommand": "npm start"
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Railway –ø–æ–ª—É—á–∞–µ—Ç –Ω–æ–≤—ã–π commit
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç build (–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç –∫–æ–¥)
3. **–ó–∞–ø—É—Å–∫–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏** (`npm run db:migrate`)
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ –í –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–ø–æ timestamp)
- ‚úÖ –ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å ‚Üí deploy –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
- ‚úÖ Production –∑–∞—â–∏—â—ë–Ω –æ—Ç –æ—à–∏–±–æ–∫

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç Database setup

### Schema –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è ‚úÖ
- [ ] Schema –≤ `shared/schema.ts` (SSOT!)
- [ ] TypeScript —Ç–∏–ø—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- [ ] Relations –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏ –æ–ø–∏—Å–∞–Ω—ã
- [ ] Backend –∏ Frontend –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ç–∏–ø—ã

### Drizzle ORM setup ‚úÖ
- [ ] `drizzle-orm` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] `drizzle-kit` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (dev dependency)
- [ ] `drizzle.config.ts` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Connection –∫ –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ú–∏–≥—Ä–∞—Ü–∏–∏ (–ö–†–ò–¢–ò–ß–ù–û!) ‚úÖ
- [ ] –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `db:push` –≤ production
- [ ] `npm run db:generate` —Å–æ–∑–¥–∞—ë—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ `drizzle/` –ø–∞–ø–∫–µ
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤ git (–∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- [ ] CI/CD –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### Production safety ‚úÖ
- [ ] Local –∏ Production –ë–î —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
- [ ] Environment variables –¥–ª—è DATABASE_URL
- [ ] Backups –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (Railway –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
- [ ] Rollback –ø–ª–∞–Ω –µ—Å—Ç—å

---

## üéì –ò—Ç–æ–≥–∏ —É—Ä–æ–∫–∞

### –ì–ª–∞–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã

1. **Drizzle ORM** - –æ—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è TypeScript –ø—Ä–æ–µ–∫—Ç–æ–≤

2. **shared/schema.ts –≤ 527 ShortCut - –ì–ï–ù–ò–ê–õ–¨–ù–û!** ‚úÖ
   - SSOT –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±–ª—é–¥—ë–Ω
   - –¢–∏–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ–∑–¥–µ
   - Refactoring –±–µ–∑–æ–ø–∞—Å–Ω—ã–π

3. **db:push - –û–ü–ê–°–ù–û –¥–ª—è production!** ‚ùå
   - –ú–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
   - –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–±:**
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git
   - ‚úÖ –ú–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å
   - ‚úÖ CI/CD friendly
   - ‚úÖ Team friendly

5. **–¶–µ–Ω–∞ –æ—à–∏–±–∫–∏:**
   - –í–Ω–µ–¥—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –°–ï–ô–ß–ê–°: 1 –¥–µ–Ω—å
   - –õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç —Å –¥–∞–Ω–Ω—ã–º–∏: –Ω–µ–¥–µ–ª–∏ + —Ä–µ–ø—É—Ç–∞—Ü–∏—è

### –ß—Ç–æ –¥–∞–ª—å—à–µ?

–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ:
- Frontend setup (React + Vite)
- –°–≤—è–∑–∫–∞ —Å backend —á–µ—Ä–µ–∑ API
- TypeScript —Ç–∏–ø—ã –∏–∑ shared/

---

## üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –¥—Ä—É–≥–∏–µ —É—Ä–æ–∫–∏

### Project Setup Guide
- ‚Üí **–£—Ä–æ–∫ 1.7** (SSOT –ø—Ä–∏–Ω—Ü–∏–ø) - –æ—Å–Ω–æ–≤–∞ shared/schema.ts
- ‚Üí **–£—Ä–æ–∫ 4.3** (–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫) - –ø—Ä–µ–¥—ã–¥—É—â–∏–π —É—Ä–æ–∫
- ‚Üí **–£—Ä–æ–∫ 4.5** (Frontend React) - —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–∫

### AI Web Learning
- ‚Üí **Module 3** (Database basics) - SQL vs NoSQL, –æ—Å–Ω–æ–≤—ã –ë–î
- ‚Üí **Module 3.3** (Migrations) - –¥–µ—Ç–∞–ª–∏ –º–∏–≥—Ä–∞—Ü–∏–π

---

## üí° –ó–∞–¥–∞–Ω–∏–µ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

**–ó–∞–¥–∞—á–∞:** –ù–∞—Å—Ç—Ä–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Å–≤–æ—ë–º Express –ø—Ä–æ–µ–∫—Ç–µ.

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞–π `drizzle.config.ts`
2. –î–æ–±–∞–≤—å scripts –≤ `package.json`:
   - `"db:generate": "drizzle-kit generate"`
   - `"db:migrate": "drizzle-kit migrate"`
3. –ò–∑–º–µ–Ω–∏ schema.ts (–¥–æ–±–∞–≤—å –ø–æ–ª–µ)
4. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π –º–∏–≥—Ä–∞—Ü–∏—é: `npm run db:generate`
5. –ü—Ä–æ–≤–µ—Ä—å SQL —Ñ–∞–π–ª
6. –ü—Ä–∏–º–µ–Ω–∏: `npm run db:migrate`
7. –ó–∞–∫–æ–º–º–∏—Ç—å schema + –º–∏–≥—Ä–∞—Ü–∏—é –≤ git

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**  
–í `drizzle/` –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è SQL —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π.

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ

**–î–ª—è 527 ShortCut —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**

```
–°–ï–ô–ß–ê–° –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: npm run db:push

–ü–†–û–ë–õ–ï–ú–ê:
‚îú‚îÄ‚îÄ ‚ùå Production –¥–∞–Ω–Ω—ã–µ –ø–æ–¥ —Ä–∏—Å–∫–æ–º
‚îú‚îÄ‚îÄ ‚ùå –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

–†–ï–®–ï–ù–ò–ï:
‚îú‚îÄ‚îÄ ‚úÖ –í–Ω–µ–¥—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (1 –¥–µ–Ω—å —Ä–∞–±–æ—Ç—ã)
‚îú‚îÄ‚îÄ ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Railway build command
‚îî‚îÄ‚îÄ ‚úÖ –°–ø–∞—Ç—å —Å–ø–æ–∫–æ–π–Ω–æ (–¥–∞–Ω–Ω—ã–µ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)

–¶–ï–ù–ê –û–®–ò–ë–ö–ò:
‚îú‚îÄ‚îÄ –ù–µ –≤–Ω–µ–¥—Ä–∏—Ç—å: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ –í–Ω–µ–¥—Ä–∏—Ç—å: 1 –¥–µ–Ω—å —Ä–∞–±–æ—Ç—ã + –∑–∞—â–∏—Ç–∞
‚îî‚îÄ‚îÄ –í—ã–±–æ—Ä –æ—á–µ–≤–∏–¥–µ–Ω
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-29  
**–ê–≤—Ç–æ—Ä:** AI Web Learning Course
