# 4.1 Когда использовать Express vs FastAPI vs Next.js

> **Время изучения:** 50-60 минут  
> **Сложность:** ⭐⭐ Ключевой урок  
> **Prerequisite:** AI Web Learning Module 8 (Node.js fundamentals)

---

## 🎯 Цель урока

Научиться **осознанно выбирать** технологический стек для веб-приложения. Понимать когда использовать Express + React, когда FastAPI + React, а когда Next.js.

**Почему это критично:**  
Неправильный выбор стека = месяцы переписывания проекта. Мы разберём это на реальном примере проекта 527 ShortCut.

---

## 🤔 Проблема выбора

Ты хочешь создать веб-приложение. Перед тобой три подхода:

1. **Express + React** (JavaScript/TypeScript везде)
2. **FastAPI + React** (Python backend, JavaScript frontend)
3. **Next.js** (JavaScript full-stack монолит)

**Вопрос:** Какой выбрать?

**Неправильный ответ:**  
_"Тот, что мне больше нравится"_ или _"Тот, что я знаю"_

**Правильный ответ:**  
_"Тот, который ЛУЧШЕ ВСЕГО подходит для МОЕЙ ЗАДАЧИ"_

---

## 🏗️ Три подхода к full-stack разработке

### Визуализация архитектур

```
┌─────────────────────────────────────────────────────────────────┐
│                    1. Express + React                           │
│                   (Разделённый JavaScript)                      │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────┐                    ┌──────────────────────┐
│   React Frontend     │◄────── HTTP ──────►│   Express Backend    │
│   (JavaScript)       │     (REST API)     │   (JavaScript)       │
│                      │                    │                      │
│  - Vite dev server   │                    │  - Node.js runtime   │
│  - Components        │                    │  - API routes        │
│  - State management  │                    │  - Business logic    │
│  - UI logic          │                    │  - Database access   │
└──────────────────────┘                    └──────────────────────┘
                                                       │
                                                       ▼
                                            ┌──────────────────────┐
                                            │   PostgreSQL / DB    │
                                            └──────────────────────┘

Deployment: 
- Frontend: Vercel, Netlify (статика работает везде)
- Backend: Railway, Render, Fly.io (⚠️ НЕ Vercel! Express требует long-running server)
- Database: Railway, Supabase, Neon


┌─────────────────────────────────────────────────────────────────┐
│                    2. FastAPI + React                           │
│                   (Python backend, JS frontend)                 │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────┐                    ┌──────────────────────┐
│   React Frontend     │◄────── HTTP ──────►│   FastAPI Backend    │
│   (JavaScript)       │     (REST API)     │   (Python)           │
│                      │                    │                      │
│  - Vite dev server   │                    │  - Uvicorn server    │
│  - Components        │                    │  - Pydantic models   │
│  - State management  │                    │  - Business logic    │
│  - UI logic          │                    │  - ML/Data Science   │
└──────────────────────┘                    └──────────────────────┘
                                                       │
                                                       ▼
                                            ┌──────────────────────┐
                                            │   PostgreSQL / DB    │
                                            └──────────────────────┘

Deployment:
- Frontend: Vercel, Netlify (статика)
- Backend: Railway, Render (FastAPI тоже long-running server)
- Database: Railway, Supabase, Neon


┌─────────────────────────────────────────────────────────────────┐
│                         3. Next.js                              │
│                    (Full-stack монолит)                         │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│                     Next.js Application                        │
│                                                                │
│  ┌────────────────────────┐    ┌────────────────────────┐    │
│  │   Frontend (React)     │    │   Backend (API Routes) │    │
│  │                        │    │                        │    │
│  │  - Pages               │    │  - API endpoints       │    │
│  │  - Components          │    │  - Server Actions      │    │
│  │  - UI logic            │    │  - Business logic      │    │
│  └────────────────────────┘    └────────────────────────┘    │
│                                            │                   │
│                                            ▼                   │
│                                 ┌────────────────────────┐    │
│                                 │   Database access      │    │
│                                 └────────────────────────┘    │
└──────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                         ┌──────────────────────┐
                         │   PostgreSQL / DB    │
                         └──────────────────────┘

Deployment:
- Всё вместе: Vercel (1 клик)
- Database: Vercel Postgres, Supabase
```

---

## 📊 Детальное сравнение

### Таблица сравнения (читай внимательно!)

| Критерий | Express + React | FastAPI + React | Next.js |
|----------|----------------|-----------------|---------|
| **Язык программирования** | JavaScript/TypeScript везде | Python (backend) + JS (frontend) | JavaScript/TypeScript везде |
| **Архитектура** | Разделённая (2 проекта) | Разделённая (2 проекта) | Монолит (1 проект) |
| **Сложность setup** | Средняя (2 проекта, CORS) | Средняя (2 языка, 2 проекта) | Низкая (1 проект) |
| **Deployment** | 2 отдельных deploy | 2 отдельных deploy | 1 deploy (Vercel за 1 клик) |
| **⚠️ Vercel support** | ❌ Backend НЕ работает (нужен Railway/Render) | ❌ Backend НЕ работает | ✅ Работает идеально |
| **Типизация** | TypeScript везде | Python Type Hints + TS | TypeScript везде |
| **Экосистема** | npm (огромная) | pip + npm | npm |
| **ML/Data Science** | ❌ Слабо | ✅ Отлично (NumPy, Pandas, scikit-learn) | ❌ Слабо |
| **Desktop apps (Electron)** | ✅ Да | ❌ Нет | ⚠️ Сложно |
| **Real-time (WebSocket)** | ✅ Отлично (Socket.io) | ✅ Хорошо (WebSockets) | ✅ Хорошо |
| **Инженерные расчёты** | ❌ Слабо | ✅ Отлично (NumPy, SciPy) | ❌ Слабо |
| **SEO** | ⚠️ Нужна настройка | ⚠️ Нужна настройка | ✅ Из коробки (SSR) |
| **API документация** | ⚠️ Вручную (Swagger) | ✅ Автоматически (OpenAPI) | ⚠️ Вручную |
| **Скорость разработки** | Средняя | Средняя | Высокая (меньше boilerplate) |
| **Масштабирование** | ✅ Отлично (микросервисы) | ✅ Отлично | ⚠️ Сложнее (монолит) |
| **Когда использовать** | Сложная JS логика, Node.js экосистема | Python ML/расчёты + веб UI | Простые full-stack проекты, SEO |

---

## ⚠️ КРИТИЧЕСКИ ВАЖНО: Express НЕ работает на Vercel!

**Почему это важно знать:**

Многие разработчики пытаются задеплоить Express на Vercel и получают ошибки. **Vercel оптимизирован для:**
- ✅ Next.js (их собственный фреймворк)
- ✅ Serverless functions (короткий lifetime)
- ✅ Статические сайты (React, Vue после build)

**Express требует:**
- ❌ Long-running server (постоянно работающий процесс)
- ❌ Постоянное соединение с БД
- ❌ WebSocket connections (для real-time)

### Правильные платформы для Express Backend:

| Платформа | Плюсы | Минусы | Цена |
|-----------|-------|--------|------|
| **Railway** | Простой deploy, PostgreSQL из коробки, auto-deploy from GitHub | Меньше бесплатного tier | $5/месяц+ |
| **Render** | Бесплатный tier, простой UI | Медленный cold start на free tier | Free → $7/месяц |
| **Fly.io** | Быстрый, global CDN, Docker | Сложнее настройка | Free tier → платно |
| **DigitalOcean App Platform** | Стабильный, предсказуемая цена | Дороже | $5/месяц+ |

**Проект 527 ShortCut использует Railway** - правильный выбор для Express!

---

## 🎯 Когда использовать Express + React

### ✅ Используй Express + React если:

1. **Backend на JavaScript/TypeScript обязателен**
   - Нужна Node.js экосистема (npm packages)
   - Shared types между backend и frontend (TypeScript везде)
   - Работа с JSON, API интеграции

2. **Сложная backend логика**
   - Расчёты результатов (как в 527 ShortCut: championship standings)
   - Real-time функции (чаты, уведомления, live updates)
   - WebSocket connections

3. **Desktop приложения в будущем**
   - Можешь обернуть в Electron
   - Node.js код переиспользуется

4. **Микросервисная архитектура**
   - Легко разделить на сервисы
   - Каждый сервис независимый

5. **Команда знает JavaScript/TypeScript**
   - Один язык для всей команды
   - Проще hiring

### ❌ НЕ используй Express + React если:

- Нужна Python логика (ML, инженерные расчёты)
- Простой CRUD проект (Next.js проще)
- SEO критичен (Next.js лучше из коробки)
- Нет опыта с Node.js
- **Хочешь deploy на Vercel** (Express там НЕ работает!)

---

## 🎯 Когда использовать FastAPI + React

### ✅ Используй FastAPI + React если:

1. **Python логика критична**
   - Machine Learning модели (TensorFlow, PyTorch)
   - Data Science (NumPy, Pandas)
   - Инженерные расчёты (SciPy)
   - Computer Vision (OpenCV)

2. **Нужна автодокументация API**
   - FastAPI создаёт OpenAPI/Swagger автоматически
   - Interactive API docs из коробки

3. **Команда Python разработчиков**
   - Backend пишут на Python
   - Frontend отдельная команда

4. **Проект типа EngineCamPro**
   - Сложные расчёты на Python
   - Веб UI для визуализации

### ❌ НЕ используй FastAPI + React если:

- Не нужна Python логика
- Desktop приложения планируются (Electron работает с Node.js)
- Простой CRUD (Next.js проще)
- Команда только JS разработчики

---

## 🎯 Когда использовать Next.js

### ✅ Используй Next.js если:

1. **Простой/средний full-stack проект**
   - CRUD приложение
   - Блог, лендинг, каталог
   - Админ-панель

2. **SEO критичен**
   - Сайт должен индексироваться Google
   - Server-Side Rendering нужен

3. **Быстрый старт важен**
   - 1 проект вместо 2
   - Меньше конфигурации
   - 1 deploy вместо 2

4. **Простая архитектура**
   - Не планируется микросервисы
   - Монолит достаточен

### ❌ НЕ используй Next.js если:

- Сложная backend логика (лучше разделить)
- Нужны микросервисы
- Desktop приложения (Electron)
- Python backend логика нужна

---

## 💼 Практический пример: 527 ShortCut

### Проект 527 ShortCut - почему Express + React?

**О проекте:**  
Сайт команды ShortCut для чемпионата СМП РСКГ 2025. Результаты гонок, новости, блог, комментарии.

**Технологии:**
- Backend: Express + TypeScript
- Frontend: React + TypeScript + Vite
- Database: PostgreSQL (Drizzle ORM)
- **Hosting: Railway** (⚠️ НЕ Vercel! Express требует long-running server)

### Почему Railway, а не Vercel?

**Ключевое ограничение Vercel:**  
Vercel НЕ поддерживает Express и другие traditional web frameworks, требующие долгоживущих серверов.

**Railway подходит идеально:**
- ✅ Long-running Node.js процесс (Express работает!)
- ✅ PostgreSQL из коробки (managed database)
- ✅ Auto-deploy from GitHub (push → автоматический deploy)
- ✅ Environment variables управление
- ✅ Logs и monitoring

**Это важный урок:**  
Когда выбираешь Express + React, сразу планируй deployment на Railway/Render/Fly.io, НЕ на Vercel!

### Почему НЕ FastAPI?

❌ **Не подходит потому что:**
- Нет Python логики (нет ML, нет сложных расчётов)
- Championship standings расчёты простые (JavaScript справляется)
- Команда знает JavaScript/TypeScript

### Почему НЕ Next.js?

❌ **Не подходит потому что:**

1. **Сложная backend логика**
   - 9 таблиц в БД с отношениями
   - Расчёт championship standings (drop worst stage rule)
   - Система комментариев с модерацией
   - Sync workflow между local и production БД

2. **Real-time функции**
   - Комментарии пользователей
   - Потенциально live results в будущем

3. **Разделение ответственности**
   - Backend API может использоваться мобильным приложением
   - Frontend можно заменить без изменения backend

4. **Масштабирование и deployment**
   - Легко добавить микросервисы (например, отдельный сервис для статистики)
   - Можно разделить нагрузку между backend и frontend
   - **Railway идеален для Express** (Vercel не поддерживает!)
   - Frontend статику можно положить куда угодно (Vercel, Netlify)

### Правильное решение: Express + React ✅

**Почему это правильный выбор:**

✅ **TypeScript везде** - shared types между backend и frontend  
✅ **Гибкая архитектура** - легко добавлять модули  
✅ **Node.js экосистема** - Drizzle ORM, множество npm пакетов  
✅ **Разделённый deployment** - backend и frontend независимы  
✅ **Потенциал для Electron** - можно сделать desktop версию  

---

## 🧠 Как принимать решение: Алгоритм

### Шаг 1: Определи требования backend

```
┌─────────────────────────────────────────────────────────────┐
│          Какая логика нужна на backend?                     │
└─────────────────────────────────────────────────────────────┘
                         │
                         ▼
        ┌────────────────┴────────────────┐
        │                                 │
        ▼                                 ▼
┌──────────────────┐           ┌──────────────────┐
│  Python логика   │           │  JavaScript      │
│  - ML модели     │           │  логика          │
│  - Data Science  │           │  - CRUD          │
│  - Инженерные    │           │  - API           │
│    расчёты       │           │  - Real-time     │
└──────────────────┘           └──────────────────┘
        │                                 │
        ▼                                 ▼
  FastAPI + React              Express + React или Next.js
```

### Шаг 2: Определи сложность проекта

```
┌─────────────────────────────────────────────────────────────┐
│          Насколько сложный backend?                         │
└─────────────────────────────────────────────────────────────┘
                         │
                         ▼
        ┌────────────────┴────────────────┐
        │                                 │
        ▼                                 ▼
┌──────────────────┐           ┌──────────────────┐
│  Сложный         │           │  Простой/Средний │
│  - Много таблиц  │           │  - CRUD          │
│  - Сложная       │           │  - Простой API   │
│    логика        │           │  - Базовые       │
│  - Микросервисы  │           │    операции      │
│  - Real-time     │           │                  │
└──────────────────┘           └──────────────────┘
        │                                 │
        ▼                                 ▼
  Express + React                    Next.js
  (Разделённый stack)           (Full-stack монолит)
```

### Шаг 3: Учти дополнительные факторы

**SEO критичен?**
- Да → Next.js (SSR из коробки)
- Нет → Express + React или FastAPI + React

**Desktop приложения в будущем?**
- Да → Express + React (Electron)
- Нет → Любой подход

**Команда знает только один язык?**
- Python → FastAPI + React
- JavaScript → Express + React или Next.js

**Быстрый старт важен?**
- Да → Next.js (1 проект, 1 deploy)
- Нет → Express + React (больше контроля)

---

## 🤖 Как формулировать для ИИ (Claude Code)

### ❌ Плохой промпт (без контекста)

```
Создай веб-приложение для гонок
```

**Проблема:** ИИ не знает какой stack использовать и сделает наугад.

---

### ✅ Хороший промпт (с обоснованием выбора)

```
Создай веб-приложение для гонок на Express + React.

ОБОСНОВАНИЕ ВЫБОРА СТЕКА:
- Express + React вместо Next.js потому что:
  * Сложная backend логика (9 таблиц БД, championship calculations)
  * Real-time функции (комментарии пользователей)
  * Разделённый deployment (backend и frontend независимы)
  
СТРУКТУРА:
backend/
├── server/
│   ├── index.ts          # Express setup
│   ├── routes/           # API endpoints (модули)
│   ├── services/         # Business logic
│   └── storage/          # Database access
├── shared/
│   └── schema.ts         # Database schema (SSOT!)
└── client/
    ├── src/
    │   ├── components/   # React компоненты
    │   ├── pages/        # Страницы
    │   └── App.tsx       # Main app
    └── public/           # Static files

ТЕХНОЛОГИИ:
- Backend: Express + TypeScript
- Frontend: React + TypeScript + Vite
- Database: PostgreSQL + Drizzle ORM
- **Deployment: Railway** (Express НЕ работает на Vercel!)
- ОБЯЗАТЕЛЬНО: Layered Architecture (routes → services → storage)

ТРЕБОВАНИЯ:
- TypeScript с strict mode
- Shared types между backend и frontend
- CORS настроен правильно
- Environment variables (.env)
- Миграции для БД (не db:push!)

Создай минимальную работающую структуру с примером API endpoint.
```

**Результат:** ИИ создаст правильную структуру с обоснованными решениями.

---

## 📋 Чек-лист выбора стека

Пройди по этому чек-листу перед началом проекта:

### Backend требования

- [ ] Определил какая логика нужна (Python ML или JavaScript)
- [ ] Оценил сложность backend (простой CRUD или сложная логика)
- [ ] Понял нужны ли микросервисы
- [ ] Проверил нужны ли real-time функции

### Frontend требования

- [ ] SEO критичен? (Next.js лучше)
- [ ] Desktop приложения планируются? (Express + Electron)
- [ ] Сложный UI с кучей состояния? (Разделённый stack лучше)

### Команда и инфраструктура

- [ ] Определил знания команды (Python vs JavaScript)
- [ ] Оценил время на setup (Next.js быстрее стартует)
- [ ] Понял deployment требования (1 сервис или 2 отдельных)
- [ ] **⚠️ Проверил совместимость с Vercel** (Express НЕ работает!)
- [ ] Выбрал правильную платформу (Railway/Render для Express)

### Финальное решение

- [ ] Выбрал стек осознанно (не наугад!)
- [ ] Обосновал выбор (записал в документацию)
- [ ] Сформулировал промпт для ИИ с обоснованием

---

## 🎓 Итоги урока

### Главные выводы

1. **Нет "лучшего" стека** - есть подходящий для ТВОЕЙ задачи

2. **Express + React** → сложная JS логика, Node.js экосистема, микросервисы

3. **FastAPI + React** → Python ML/расчёты, автодокументация API

4. **Next.js** → простые full-stack проекты, SEO, быстрый старт

5. **⚠️ КРИТИЧНО: Express НЕ работает на Vercel!** Используй Railway, Render, Fly.io

6. **527 ShortCut** правильно выбрал Express + React + Railway для сложного backend

7. **Формулируй для ИИ с обоснованием** - получишь правильную структуру

### Что дальше?

В следующих уроках мы:
- Создадим правильную структуру Express + React проекта
- Настроим Drizzle ORM для PostgreSQL
- Разберём ошибки в 527 ShortCut и исправим их
- Научимся рефакторить неправильную архитектуру

---

## 🔗 Ссылки на другие уроки

### Project Setup Guide
- → **Урок 1.1** (Layered Architecture) - основа правильной структуры
- → **Часть 2** (FastAPI + React setup) - для сравнения
- → **Часть 3** (Next.js setup) - для сравнения
- → **Урок 4.2** (Express setup) - следующий урок

### AI Web Learning
- → **Module 8** (Node.js fundamentals) - ОБЯЗАТЕЛЬНО перед Express!
- → **Module 8.3** (Express basics) - детали Express
- → **Module 2** (FastAPI backend) - для сравнения
- → **Module 9** (Next.js full-stack) - для сравнения

---

## 💡 Задание для самопроверки

**Задача:** Определи какой стек использовать для этих проектов:

1. **Интернет-магазин** с SEO, простой корзиной, оплатой Stripe
   - Ответ: `Next.js` (SEO + простой full-stack + Stripe интеграция простая)

2. **Платформа для ML моделей** - пользователи загружают данные, модель обрабатывает, выдаёт результат
   - Ответ: `FastAPI + React` (Python ML логика + веб UI)

3. **EngineCamPro** - инженерные расчёты профилей кулачков, графики, монетизация
   - Ответ: `FastAPI + React` (Python для расчётов + React для графиков)

4. **Чат-приложение** с real-time сообщениями, комнатами, уведомлениями
   - Ответ: `Express + React` (WebSocket, real-time, сложная логика)

5. **Блог** с авторами, статьями, комментариями, SEO
   - Ответ: `Next.js` (SEO критичен + простой CRUD + быстрый старт)

6. **Desktop приложение** для анализа логов сервера с веб UI
   - Ответ: `Express + React` → обернуть в Electron (Node.js код переиспользуется)

---

**Последнее обновление:** 2025-10-29  
**Автор:** AI Web Learning Course
