# 1.8 Создание артефактов через AI

## Философия

**До сих пор** мы изучали готовые артефакты из уроков (Static mode).

**Теперь** научимся создавать артефакты динамически через AI (Dynamic mode).

---

## Два режима работы

### Static Mode (из уроков)
```
Урок → Ссылка artifact:plot:line → Split View
       ├─ Слева: текст урока
       └─ Справа: готовый артефакт
```

**Применение:**
- ✅ Демонстрация примеров
- ✅ Обучение (видишь код + результат)
- ✅ Готовые шаблоны для копирования

### Dynamic Mode (через AI)
```
Чат → Запрос к AI → Fullscreen View
      ├─ AI генерирует JSON конфигурацию
      └─ Артефакт открывается на весь экран
```

**Применение:**
- ✅ Создание уникальных графиков
- ✅ Быстрые расчёты (калькуляторы)
- ✅ Визуализация твоих данных

---

## Как это работает

### 1. AI генерирует JSON

**Пример промпта:**
```
Создай график зависимости температуры двигателя от оборотов:
- Обороты: 1000, 2000, 3000, 4000, 5000 RPM
- Температура: 70, 85, 95, 105, 115 °C
```

**AI возвращает:**
```json
{
  "type": "plot",
  "display": "plotly",
  "title": "Температура двигателя",
  "data": [{
    "x": [1000, 2000, 3000, 4000, 5000],
    "y": [70, 85, 95, 105, 115],
    "type": "scatter",
    "mode": "lines+markers",
    "name": "T двигателя"
  }],
  "layout": {
    "xaxis": {"title": "Обороты (RPM)"},
    "yaxis": {"title": "Температура (°C)"}
  }
}
```

### 2. Frontend отправляет событие

```javascript
// AI отправляет событие с конфигурацией
window.dispatchEvent(new CustomEvent('artifact:open', {
  detail: {
    type: 'plot',
    config: { /* JSON выше */ },
    mode: 'dynamic'  // ← полноэкранный режим
  }
}));
```

### 3. ArtifactModal открывает артефакт

```javascript
// ArtifactModal.jsx слушает события
useEffect(() => {
  const handleArtifact = (event) => {
    setArtifactConfig(event.detail.config);
    setIsOpen(true);  // Открываем модальное окно
  };

  window.addEventListener('artifact:open', handleArtifact);
  return () => window.removeEventListener('artifact:open', handleArtifact);
}, []);
```

---

## Примеры промптов

### Уровень 1: Простые графики (Plotly)

**Промпт 1: Линейный график**
```
Создай график изменения давления в цилиндре за один цикл (720°):
- Угол: 0, 180, 360, 540, 720°
- Давление: 1, 8, 15, 8, 1 bar
```

**Промпт 2: Гистограмма**
```
Создай гистограмму расхода топлива разных типов двигателей:
- Бензиновый: 8 л/100км
- Дизельный: 6 л/100км
- Гибрид: 4 л/100км
- Электро: 0 л/100км
```

**Промпт 3: Scatter plot**
```
Создай scatter plot зависимости мощности от массы автомобиля:
Марка | Масса (кг) | Мощность (л.с.)
Sedan | 1500 | 150
SUV   | 2000 | 200
Sport | 1200 | 300
Truck | 2500 | 180
```

### Уровень 2: Калькуляторы (Math.js)

**Промпт 4: Формула мощности**
```
Создай калькулятор мощности двигателя:
- Входы: крутящий момент (50-500 Нм), обороты (1000-8000 RPM)
- Формула: P = (M × n) / 9549 (где P в кВт)
```

**Промпт 5: Расход топлива**
```
Создай калькулятор расхода топлива на 100 км:
- Входы: расстояние (км), израсходовано топлива (литры)
- Формула: Расход = (литры / км) × 100
```

**Промпт 6: Компрессия**
```
Создай калькулятор степени сжатия:
- Входы: объём цилиндра (400-600 см³), объём камеры сгорания (40-80 см³)
- Формула: CR = (V_цил + V_камеры) / V_камеры
```

### Уровень 3: Сложные конфигурации

**Промпт 7: Множество линий**
```
Создай график сравнения мощности 3 двигателей:
- V6 2.5L: при 2000, 4000, 6000 RPM → 100, 180, 220 HP
- V8 4.0L: при 2000, 4000, 6000 RPM → 150, 280, 350 HP
- I4 1.5T: при 2000, 4000, 6000 RPM → 80, 150, 180 HP

Все три линии на одном графике с легендой.
```

**Промпт 8: Калькулятор с единицами измерения**
```
Создай конвертер скорости:
- Вход: скорость (0-300)
- Выход: км/ч, м/с, миль/ч, узлы
Используй Math.js units для автоматической конвертации.
```

---

## Структура AI промптов

### Хороший промпт содержит:

1. **Тип артефакта** (явно или неявно)
   - "Создай график" → plot
   - "Создай калькулятор" → calculator

2. **Данные** (значения для графика)
   ```
   x: [1, 2, 3, 4, 5]
   y: [10, 20, 15, 25, 30]
   ```

3. **Параметры** (для калькулятора)
   ```
   Входы: радиус (min: 0, max: 100, default: 50)
   ```

4. **Формулы** (для калькулятора)
   ```
   Площадь = PI × radius²
   Периметр = 2 × PI × radius
   ```

5. **Оформление** (опционально)
   ```
   Цвет линии: синий
   Заголовок: "Мощность двигателя"
   Единицы: л.с., Нм
   ```

---

## Примеры плохих промптов

### ❌ Плохо: Слишком общий запрос
```
Создай график про двигатель.
```
**Проблема:** AI не знает, какие данные использовать.

### ❌ Плохо: Нет данных
```
Создай график температуры двигателя.
```
**Проблема:** Нет конкретных значений для x и y.

### ❌ Плохо: Нет параметров для калькулятора
```
Создай калькулятор мощности.
```
**Проблема:** Не указаны входные параметры и формула.

---

## Примеры хороших промптов

### ✅ Хорошо: Все данные на месте
```
Создай линейный график зависимости мощности от оборотов:
- x: 1000, 2000, 3000, 4000, 5000, 6000 RPM
- y: 80, 120, 160, 200, 220, 210 HP
Цвет линии: красный, заголовок "Power Curve"
```

### ✅ Хорошо: Чёткие параметры
```
Создай калькулятор крутящего момента:
- Вход: мощность (50-500 кВт, default: 200)
- Вход: обороты (1000-8000 RPM, default: 4000)
- Формула: M = (P × 9549) / n
- Результат в Нм с точностью до 1 знака
```

### ✅ Хорошо: Контекст + данные + оформление
```
Создай гистограмму сравнения расхода топлива для разных режимов движения:
Режим       | Расход (л/100км)
Город       | 10.5
Трасса      | 6.8
Смешанный   | 8.2

Цвета: город - красный, трасса - зелёный, смешанный - синий
Заголовок: "Расход топлива по режимам"
```

---

## Технические детали

### JSON структура для графика (Plotly)

```json
{
  "type": "plot",
  "display": "plotly",
  "title": "Заголовок графика",
  "data": [
    {
      "x": [значения по оси X],
      "y": [значения по оси Y],
      "type": "scatter",  // или "bar", "pie", и т.д.
      "mode": "lines+markers",
      "name": "Название линии",
      "marker": {
        "color": "rgb(255,0,0)",
        "size": 8
      }
    }
  ],
  "layout": {
    "xaxis": {
      "title": "Подпись оси X",
      "gridcolor": "#444"
    },
    "yaxis": {
      "title": "Подпись оси Y",
      "gridcolor": "#444"
    },
    "plot_bgcolor": "#1a1a1a",
    "paper_bgcolor": "#0a0a0a"
  }
}
```

### JSON структура для калькулятора (Math.js)

```json
{
  "type": "calculator",
  "display": "mathjs",
  "title": "Название калькулятора",
  "inputs": [
    {
      "name": "radius",
      "label": "Радиус",
      "unit": "м",
      "min": 0,
      "max": 100,
      "step": 1,
      "default": 50
    }
  ],
  "formulas": [
    {
      "name": "area",
      "label": "Площадь",
      "expression": "PI * radius^2",
      "unit": "м²",
      "precision": 2,
      "showFormula": true
    }
  ]
}
```

---

## Workflow создания артефакта

```
1. Пользователь → Промпт в чат
                  ↓
2. AI анализирует запрос
   ├─ Определяет тип (plot/calculator)
   ├─ Извлекает данные
   └─ Формирует JSON конфигурацию
                  ↓
3. AI возвращает сообщение с JSON
                  ↓
4. Frontend парсит JSON
   └─ Отправляет событие artifact:open
                  ↓
5. ArtifactModal открывает артефакт
   ├─ Рендерит Plot.jsx или Calculator.jsx
   └─ Полноэкранный режим (Dynamic mode)
                  ↓
6. Пользователь видит результат
   ├─ Может взаимодействовать
   └─ Может закрыть (Escape / кнопка Close)
```

---

## Отличия Static vs Dynamic mode

| Характеристика | Static Mode | Dynamic Mode |
|---------------|-------------|--------------|
| **Источник** | Из урока (файл .md) | Из AI (JSON) |
| **Отображение** | Split View (урок + артефакт) | Fullscreen (только артефакт) |
| **Редактирование** | Нельзя редактировать | Нельзя редактировать (пока) |
| **Применение** | Обучение, примеры | Визуализация своих данных |
| **Переключение** | Нет (фиксированный режим) | Можно закрыть и попросить AI пересоздать |

---

## Примеры использования в чате

### Сценарий 1: Быстрая визуализация

**Пользователь:**
> У меня есть данные замеров температуры двигателя:
> 1000 RPM → 75°C
> 2000 RPM → 82°C
> 3000 RPM → 91°C
> 4000 RPM → 98°C
> Покажи график.

**AI создаёт артефакт:**
- Парсит данные из сообщения
- Генерирует JSON с type: "plot"
- Отправляет событие artifact:open
- График открывается на весь экран

---

### Сценарий 2: Калькулятор на лету

**Пользователь:**
> Мне нужно быстро посчитать степень сжатия.
> Объём цилиндра: 500 см³
> Объём камеры сгорания: 50 см³
> Создай калькулятор с формулой CR = (V_cyl + V_cc) / V_cc

**AI создаёт артефакт:**
- Генерирует JSON с type: "calculator"
- Задаёт inputs (V_cyl, V_cc)
- Задаёт formula
- Калькулятор открывается, можно сразу экспериментировать

---

### Сценарий 3: Сравнение нескольких вариантов

**Пользователь:**
> Сравни мощность трёх двигателей:
> - 1.5T: 80, 150, 180 HP на 2k, 4k, 6k RPM
> - 2.5 V6: 100, 180, 220 HP
> - 4.0 V8: 150, 280, 350 HP

**AI создаёт артефакт:**
- Генерирует JSON с тремя traces
- Каждый trace = одна линия на графике
- Легенда автоматически создаётся
- Пользователь видит наглядное сравнение

---

## Ограничения и будущее

### Текущие ограничения:
- ❌ Нельзя редактировать артефакт после создания (нужно попросить AI пересоздать)
- ❌ Нет сохранения истории артефактов (артефакт живёт только в сессии чата)
- ❌ Нет экспорта в PNG/SVG (только скриншот руками)

### Планы на будущее:
- ✅ Редактирование артефактов (edit mode)
- ✅ История артефактов (gallery в чате)
- ✅ Экспорт в форматы (PNG, SVG, PDF)
- ✅ Более сложные типы (Recharts, анимации, 3D)

---

## Чек-лист для AI-генерации артефактов

Перед тем как попросить AI создать артефакт, убедись:

- [ ] Я знаю **тип артефакта** (график / калькулятор)?
- [ ] У меня есть **конкретные данные** (числа для графика / параметры для калькулятора)?
- [ ] Я указал **оси/подписи** (что по X, что по Y)?
- [ ] Я указал **единицы измерения** (RPM, °C, л.с., Нм)?
- [ ] (опционально) Я указал **оформление** (цвета, заголовок)?

Если на все вопросы ответ "Да" → промпт готов! 🚀

---

## Резюме

### Что мы узнали:

1. **Два режима:** Static (из уроков) и Dynamic (через AI)
2. **Workflow:** Промпт → AI генерирует JSON → Frontend открывает артефакт
3. **Хорошие промпты:** конкретные данные + параметры + формулы
4. **Применение:** быстрая визуализация, расчёты, сравнение вариантов

### Следующий шаг:

→ Переходи к **Уроку 1.9: Галерея всех артефактов** — полный справочник с шаблонами!

---

## Практика

Попробуй создать артефакт через чат:

**Задание 1:**
> Создай график зависимости расхода топлива от скорости:
> 50, 90, 130, 170 км/ч → 6, 5.5, 7, 10 л/100км

**Задание 2:**
> Создай калькулятор скорости поршня:
> Формула: V = (2 × S × n) / 60
> Где S = ход поршня (60-100 мм), n = обороты (1000-8000 RPM)
> Результат в м/с

**Задание 3:**
> Создай гистограмму выбросов CO₂ для разных типов двигателей:
> Бензин: 180 г/км, Дизель: 150 г/км, Гибрид: 80 г/км, Электро: 0 г/км

---

*Артефакты — это мост между твоими идеями и их визуализацией. AI — твой инструмент для создания этого моста за секунды. 🚀*
